# Software Requirements Specification (SRS)
## UniPDF Studio – The Complete Online PDF Workspace

**Version:** 1.0  
**Date:** November 2, 2025  
**Project:** UniPDF Studio  
**Repository:** pdf-god  

---

## Table of Contents

1. [Introduction](#1-introduction)
   - 1.1 Purpose
   - 1.2 Scope
   - 1.3 Definitions, Acronyms, and Abbreviations
   - 1.4 References
   - 1.5 Overview

2. [Overall Description](#2-overall-description)
   - 2.1 Product Perspective
   - 2.2 Product Functions
   - 2.3 User Classes and Characteristics
   - 2.4 Operating Environment
   - 2.5 Design and Implementation Constraints
   - 2.6 Assumptions and Dependencies

3. [System Features and Requirements](#3-system-features-and-requirements)
   - 3.1 Universal File Support
   - 3.2 Advanced PDF Editing
   - 3.3 AI-Powered Enhancements
   - 3.4 OCR and Image-to-Text Extraction
   - 3.5 File Management and Document Operations
   - 3.6 Data Visualization and Metadata Tools
   - 3.7 Collaboration and Cloud Features
   - 3.8 User Interface Requirements
   - 3.9 Export and Sharing Options

4. [External Interface Requirements](#4-external-interface-requirements)
   - 4.1 User Interfaces
   - 4.2 Hardware Interfaces
   - 4.3 Software Interfaces
   - 4.4 Communication Interfaces

5. [Non-Functional Requirements](#5-non-functional-requirements)
   - 5.1 Performance Requirements
   - 5.2 Security Requirements
   - 5.3 Privacy Requirements
   - 5.4 Reliability Requirements
   - 5.5 Availability Requirements
   - 5.6 Maintainability Requirements
   - 5.7 Portability Requirements
   - 5.8 Usability Requirements

6. [Technical Architecture](#6-technical-architecture)
   - 6.1 Technology Stack
   - 6.2 Backend Architecture
   - 6.3 Frontend Architecture
   - 6.4 Database Design
   - 6.5 API Design

7. [Data Requirements](#7-data-requirements)
   - 7.1 Data Models
   - 7.2 Data Storage
   - 7.3 Data Processing
   - 7.4 Data Retention

8. [Future Enhancements](#8-future-enhancements)

9. [Appendices](#9-appendices)
   - 9.1 Glossary
   - 9.2 Use Case Diagrams
   - 9.3 Workflow Diagrams

---

## 1. Introduction

### 1.1 Purpose

This Software Requirements Specification (SRS) document provides a comprehensive description of the requirements for **UniPDF Studio**, an advanced web-based PDF management and editing platform. This document is intended for:

- **Development Team**: To understand the technical specifications and implementation requirements
- **Project Stakeholders**: To review and approve the functional and non-functional requirements
- **Quality Assurance Team**: To design test cases and validation criteria
- **End Users**: To understand the system capabilities and expected functionality
- **Maintenance Team**: To support future updates and enhancements

The SRS defines the complete functionality, constraints, and interfaces of the UniPDF Studio system, serving as the primary reference throughout the software development lifecycle.

### 1.2 Scope

**UniPDF Studio** is an all-in-one, browser-based PDF workspace that enables users to perform comprehensive document operations without requiring desktop software installation. The system encompasses:

**In Scope:**
- Universal file format support (PDF, DOCX, images, TXT, HTML)
- Complete PDF editing capabilities with visual toolbar interface
- AI-powered document intelligence (summarization, chat, rewrite)
- OCR technology for scanned document processing
- Advanced file management operations (merge, split, compress, encrypt)
- Cloud storage integration and collaborative features
- Real-time editing with modern, intuitive UI
- Cross-format conversion and export capabilities
- User authentication and document security features
- Metadata extraction and visualization tools

**Out of Scope (Phase 1):**
- Mobile native applications (iOS/Android)
- Offline desktop application
- Advanced vector graphic design tools
- Video or audio file processing
- Blockchain-based document verification
- Enterprise-level role-based access control (RBAC)

**Key Benefits:**
- Eliminates need for multiple PDF tools
- Accessible from any device with a web browser
- Combines traditional PDF utilities with modern AI capabilities
- Secure, privacy-focused document processing
- Cost-effective alternative to premium desktop software

### 1.3 Definitions, Acronyms, and Abbreviations

| Term | Definition |
|------|------------|
| **AI** | Artificial Intelligence - Machine learning models used for text processing and analysis |
| **API** | Application Programming Interface - Set of protocols for software communication |
| **DOCX** | Microsoft Word document format (.docx) |
| **HTML** | HyperText Markup Language - Standard web page format |
| **HTTPS** | HyperText Transfer Protocol Secure - Encrypted data transfer protocol |
| **JWT** | JSON Web Token - Standard for secure authentication |
| **OCR** | Optical Character Recognition - Technology to extract text from images |
| **PDF** | Portable Document Format - Standard document format by Adobe |
| **REST** | Representational State Transfer - Architectural style for web services |
| **SRS** | Software Requirements Specification - Formal document describing system requirements |
| **UI/UX** | User Interface / User Experience - Design and interaction aspects |
| **URL** | Uniform Resource Locator - Web address |
| **WebSocket** | Protocol for real-time bidirectional communication |
| **Canvas** | HTML5 element for rendering graphics and PDF content |
| **Metadata** | Data that describes other data (author, date, tags, etc.) |
| **Vector Rendering** | High-quality scalable graphics rendering technique |
| **Firebase** | Google's backend-as-a-service platform for authentication and storage |
| **MongoDB** | NoSQL document-oriented database system |
| **Node.js** | JavaScript runtime for server-side applications |
| **Express** | Web application framework for Node.js |
| **TailwindCSS** | Utility-first CSS framework for styling |

### 1.4 References

The following documents and resources are referenced in this SRS:

1. **PDF Specification (ISO 32000-2:2020)** - Official PDF format standards
2. **Web Content Accessibility Guidelines (WCAG) 2.1** - Accessibility standards
3. **OWASP Security Guidelines** - Web application security best practices
4. **IEEE 830-1998** - IEEE Recommended Practice for Software Requirements Specifications
5. **OpenAI API Documentation** - AI model integration reference
6. **Tesseract OCR Documentation** - OCR engine implementation guide
7. **pdf-lib Documentation** - PDF manipulation library reference
8. **Firebase Documentation** - Authentication and storage implementation
9. **MongoDB Documentation** - Database design and querying
10. **REST API Design Best Practices** - API architecture guidelines
11. **Google Drive API Documentation** - Cloud storage integration
12. **HTML5 Canvas API** - Document rendering specifications

### 1.5 Overview

This SRS document is organized into nine major sections:

**Section 2 - Overall Description**: Provides a high-level overview of the product, including its context within the market, primary functions, target user groups, operating environment, and key constraints.

**Section 3 - System Features and Requirements**: Details all functional requirements organized by feature modules, including universal file support, editing tools, AI capabilities, OCR processing, file operations, collaboration features, and export options.

**Section 4 - External Interface Requirements**: Specifies the interaction requirements between the system and external entities, including user interfaces, hardware, third-party software, and communication protocols.

**Section 5 - Non-Functional Requirements**: Defines quality attributes such as performance benchmarks, security measures, reliability standards, usability criteria, and maintainability guidelines.

**Section 6 - Technical Architecture**: Describes the technology stack, system architecture, backend/frontend design patterns, database structure, and API specifications.

**Section 7 - Data Requirements**: Outlines data models, storage strategies, processing workflows, and retention policies for user and document data.

**Section 8 - Future Enhancements**: Lists potential features and improvements planned for subsequent development phases.

**Section 9 - Appendices**: Contains supplementary materials including glossary, use case diagrams, workflow charts, and technical reference materials.

This document follows IEEE 830-1998 standards for software requirements specification and serves as the contractual agreement between stakeholders and the development team regarding system functionality and behavior.

---

## 2. Overall Description

### 2.1 Product Perspective

UniPDF Studio is a standalone, cloud-based web application that serves as a comprehensive alternative to traditional desktop PDF software like Adobe Acrobat, Foxit Reader, and PDFelement. The system operates entirely within modern web browsers, eliminating the need for software installation while maintaining professional-grade functionality.

**System Context:**

```
┌─────────────────────────────────────────────────────────────┐
│                        End Users                            │
│              (Students, Professionals, Teams)               │
└────────────────────┬────────────────────────────────────────┘
                     │ HTTPS
                     ▼
┌─────────────────────────────────────────────────────────────┐
│                   UniPDF Studio Web App                     │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐     │
│  │   Frontend   │  │   Backend    │  │   Database   │     │
│  │  (React/UI)  │◄─┤ (Node.js API)│◄─┤  (MongoDB)   │     │
│  └──────────────┘  └──────────────┘  └──────────────┘     │
└────────────┬────────────┬────────────┬────────────────────┘
             │            │            │
             ▼            ▼            ▼
    ┌────────────┐ ┌────────────┐ ┌────────────┐
    │  Firebase  │ │  OpenAI    │ │  Tesseract │
    │   Auth     │ │    API     │ │    OCR     │
    └────────────┘ └────────────┘ └────────────┘
```

**Key Architectural Characteristics:**

- **Browser-Based**: Fully functional within Chrome, Firefox, Safari, Edge (no plugins required)
- **Cloud-First**: User data and documents stored in cloud infrastructure with local caching
- **API-Driven**: RESTful backend architecture enabling future mobile app integration
- **Microservices Ready**: Modular design allowing independent scaling of PDF processing, OCR, and AI services
- **Real-Time Capable**: WebSocket support for collaborative editing features
- **Platform Independent**: Accessible from Windows, macOS, Linux, and tablets

**Integration Points:**

- Google Drive API for cloud storage synchronization
- Firebase Authentication for user management
- OpenAI/Hugging Face APIs for AI-powered features
- Tesseract.js or Google Vision API for OCR processing
- Third-party payment gateway (future) for premium features

### 2.2 Product Functions

UniPDF Studio provides nine major functional categories:

#### **F1. Universal File Support and Conversion**
- Upload and process PDF, DOCX, TXT, HTML, and image files (JPG, PNG, TIFF, BMP)
- Automatic format detection and conversion to editable PDF layers
- Bidirectional conversion: PDF ↔ Word, PDF ↔ Image, PDF ↔ Text, PDF ↔ HTML
- Batch file upload and processing (up to 50 files simultaneously)

#### **F2. Advanced Visual PDF Editing**
- Text editing directly within PDF documents
- Text formatting (font family, size, color, alignment, bold, italic, underline)
- Text highlighting, underlining, and strikethrough tools
- Freehand drawing with pen tool (multiple colors and thicknesses)
- Shape insertion (rectangles, circles, arrows, lines)
- Image insertion, resizing, and positioning
- Text box creation with customizable styling
- Hyperlink embedding and management
- Form field creation (text input, checkboxes, radio buttons, dropdowns)
- Multi-layer management with undo/redo (50-step history)

#### **F3. AI-Powered Document Intelligence**
- **Summarization**: Generate concise summaries of lengthy documents
- **Conversational Query**: Chat interface to ask questions about document content
- **Smart Rewrite**: Rephrase or simplify selected text sections
- **OCR Error Correction**: AI-assisted cleanup of scanned text artifacts
- **Content Extraction**: Automatically identify and extract tables, lists, key points

#### **F4. OCR and Text Extraction**
- Automatic OCR processing for scanned PDFs and uploaded images
- Multi-language text recognition (English, Spanish, French, German, Chinese, etc.)
- Selectable and searchable text generation from visual content
- Export extracted text as TXT, DOCX, or Markdown
- Confidence scoring for OCR results with manual correction interface

#### **F5. Document Management Operations**
- **Merge**: Combine multiple PDFs into single document with custom ordering
- **Split**: Separate PDF by page ranges, bookmarks, or custom splits
- **Rearrange**: Drag-and-drop page reordering with visual thumbnails
- **Delete**: Remove unwanted pages with preview confirmation
- **Compress**: Reduce file size using adjustable quality settings
- **Encrypt**: Password protection with AES-256 encryption
- **Watermark**: Add text or image watermarks with positioning controls
- **Page Numbering**: Insert headers, footers, and page numbers with templates

#### **F6. Metadata and Analytics**
- Display document metadata (author, title, subject, keywords, creation date)
- Editable metadata fields with save functionality
- Document analytics: word count, page count, text density analysis
- Reading time estimation
- Font usage report
- Color palette extraction

#### **F7. Collaboration and Cloud Features**
- User account creation and authentication via email or Google OAuth
- Cloud storage with 5GB free tier (expandable to 100GB premium)
- Document sharing with permission controls (view-only, comment, edit)
- Real-time multi-user annotation and commenting
- Version history with 30-day rollback capability
- Shared workspace for team document review
- Comment threads and reply system

#### **F8. Intuitive User Interface**
- Adobe Acrobat-inspired toolbar layout
- Sidebar navigation with thumbnails, bookmarks, comments, layers
- Zoomable canvas with pan and fit-to-width controls
- Keyboard shortcuts for power users
- Dark/light theme support
- Responsive design for desktop and tablet devices
- Drag-and-drop file upload
- Progress indicators for long operations

#### **F9. Export and Sharing**
- Download edited PDFs with original or new filename
- Export to multiple formats (TXT, DOCX, PNG, JPG, HTML, Markdown)
- Shareable link generation with expiration settings
- Email integration for direct document sending
- QR code generation for mobile access
- Print-optimized PDF output

### 2.3 User Classes and Characteristics

UniPDF Studio serves four primary user classes:

#### **UC1. Individual Users (Students, Researchers, Personal Use)**

**Characteristics:**
- Age range: 18-65
- Technical proficiency: Basic to Intermediate
- Frequency of use: Occasional to Regular (2-10 times/week)
- Primary needs: Basic editing, format conversion, OCR for scanned documents

**Key Use Cases:**
- Edit assignment PDFs before submission
- Convert scanned notes to searchable text
- Merge research papers into single document
- Annotate and highlight study materials
- Fill out forms and applications

**Priority Features:** Text editing, OCR, merge/split, highlighting, export to DOCX

#### **UC2. Business Professionals (Corporate, Freelancers, Consultants)**

**Characteristics:**
- Age range: 25-55
- Technical proficiency: Intermediate to Advanced
- Frequency of use: Daily to Weekly
- Primary needs: Document review, contract editing, secure sharing, professional formatting

**Key Use Cases:**
- Review and annotate contracts
- Add electronic signatures and form fields
- Create professional reports with watermarks
- Compress large files for email distribution
- Secure confidential documents with encryption

**Priority Features:** Advanced editing, encryption, watermarking, compression, collaboration tools

#### **UC3. Creative and Content Teams (Marketing, Publishing, Design)**

**Characteristics:**
- Age range: 22-45
- Technical proficiency: Intermediate to Expert
- Frequency of use: Daily (20+ times/week)
- Primary needs: Team collaboration, visual editing, brand consistency

**Key Use Cases:**
- Collaborative review of marketing materials
- Insert images and branding elements into documents
- Create template documents with form fields
- Real-time team annotations during review cycles
- Version control for published content

**Priority Features:** Real-time collaboration, image insertion, comment threads, version history, cloud storage

#### **UC4. Educators and Administrators (Schools, Universities, Non-profits)**

**Characteristics:**
- Age range: 28-60
- Technical proficiency: Basic to Intermediate
- Frequency of use: Regular (5-15 times/week)
- Primary needs: Document organization, form creation, accessibility, batch processing

**Key Use Cases:**
- Grade and annotate student submissions
- Create fillable forms for applications
- Merge multiple student reports
- Ensure document accessibility compliance
- Organize curriculum materials

**Priority Features:** Annotation tools, form creation, merge operations, metadata management, accessibility features

### 2.4 Operating Environment

#### **Client-Side Requirements**

**Supported Web Browsers:**
- Google Chrome 100+ (recommended)
- Mozilla Firefox 95+
- Safari 15+ (macOS/iOS)
- Microsoft Edge 100+
- Opera 85+

**Minimum Browser Requirements:**
- JavaScript enabled
- HTML5 Canvas support
- WebSocket support (for real-time collaboration)
- Local Storage (minimum 50MB available)
- Cookies enabled for authentication

**Device Requirements:**
- **Desktop/Laptop**: 
  - Screen resolution: 1280×720 minimum (1920×1080 recommended)
  - RAM: 4GB minimum (8GB recommended)
  - CPU: Dual-core 2.0GHz minimum
  - Internet speed: 5 Mbps minimum (20 Mbps recommended)
  
- **Tablet**:
  - Screen resolution: 1024×768 minimum
  - RAM: 3GB minimum
  - Internet speed: 10 Mbps minimum

#### **Server-Side Environment**

**Production Hosting:**
- Cloud Platform: AWS, Google Cloud, or Azure
- Container Orchestration: Docker + Kubernetes
- CDN: CloudFlare or AWS CloudFront
- Geographic regions: Multi-region deployment (US, EU, Asia)

**Server Specifications (per instance):**
- CPU: 4 cores minimum (8 cores recommended)
- RAM: 16GB minimum (32GB recommended)
- Storage: 100GB SSD minimum
- Network: 1Gbps connection

**Required Services:**
- Node.js runtime v18+ (LTS)
- MongoDB v6.0+ or Firebase Firestore
- Redis v7.0+ (for session management and caching)
- NGINX or Apache (reverse proxy)
- SSL/TLS certificates (Let's Encrypt or commercial)

#### **Third-Party Dependencies**

- Firebase Authentication and Storage
- OpenAI API or Hugging Face Inference API
- Tesseract.js or Google Cloud Vision API
- SendGrid or AWS SES (email service)
- Stripe or PayPal (payment processing - future)
- Google Drive API (cloud storage integration)

### 2.5 Design and Implementation Constraints

#### **C1. Technical Constraints**

- **Browser Limitations**: 
  - Maximum file upload size: 100MB per file (browser memory constraints)
  - Canvas rendering limited to 4096×4096 pixels per page
  - Local storage quota: 50-100MB depending on browser
  
- **Performance Constraints**:
  - PDF processing must complete within 30 seconds for files up to 50 pages
  - OCR processing time: 2-5 seconds per page
  - AI summarization: 10-30 seconds depending on document length
  - Real-time collaboration limited to 10 concurrent users per document

- **Technology Stack**:
  - Must use JavaScript/TypeScript ecosystem (Node.js backend, React frontend)
  - Database must be NoSQL (MongoDB) for flexible document schema
  - Must support REST API architecture for future mobile integration

#### **C2. Security and Privacy Constraints**

- All data transmission must use HTTPS/TLS 1.3
- User passwords must be hashed using bcrypt (minimum 12 rounds)
- Uploaded files must be automatically deleted after 24 hours (configurable for authenticated users)
- No persistent storage of unencrypted sensitive data
- Must comply with GDPR, CCPA, and HIPAA data protection standards
- Third-party API keys must be stored in environment variables (never in source code)

#### **C3. Regulatory and Legal Constraints**

- Must include Terms of Service and Privacy Policy
- DMCA compliance for copyright-protected content
- Accessibility compliance with WCAG 2.1 Level AA
- Age restriction: Users must be 13+ (COPPA compliance)
- Must provide data export and account deletion functionality (right to portability/erasure)

#### **C4. Business Constraints**

- **Budget**: Development must be completed within allocated open-source/free-tier resources initially
- **Timeline**: MVP (Minimum Viable Product) must be production-ready within 6 months
- **Resource Availability**: Development team size: 1-3 developers
- **Licensing**: Must use MIT or Apache 2.0 compatible open-source libraries only

#### **C5. Usability Constraints**

- Interface must be intuitive enough for non-technical users (no training required)
- Maximum 3 clicks to reach any major feature
- Loading indicators must appear within 100ms for any operation taking >1 second
- Error messages must be user-friendly (avoid technical jargon)
- Mobile/tablet version must maintain 80% of desktop functionality

#### **C6. Integration Constraints**

- Must support OAuth 2.0 for third-party authentication
- API rate limits from third-party services (OpenAI: 3 requests/minute for free tier)
- Google Drive API quota: 1000 requests per 100 seconds
- OCR API costs may require usage caps for free-tier users

### 2.6 Assumptions and Dependencies

#### **Assumptions**

**A1. User Assumptions**
- Users have reliable internet connectivity (minimum 5 Mbps)
- Users are using modern browsers updated within the last 12 months
- Users have basic computer literacy (can upload files, click buttons, fill forms)
- Users understand basic PDF concepts (pages, annotations, etc.)

**A2. Technical Assumptions**
- Third-party APIs (OpenAI, Google Vision) will maintain current pricing and availability
- Cloud hosting providers will maintain 99.9% uptime SLA
- Browser vendors will continue supporting HTML5 Canvas and modern JavaScript features
- MongoDB Atlas free tier remains available for development

**A3. Business Assumptions**
- Open-source PDF libraries will remain actively maintained
- Market demand for online PDF tools will continue to grow
- Freemium model will attract sufficient user base for sustainability
- Competition will not significantly undercut pricing before product launch

**A4. Content Assumptions**
- Most user uploads will be under 20MB
- Majority of documents will be in English (70%+)
- Scanned documents will have reasonable image quality (300 DPI+)
- Users will not attempt to upload malicious or corrupted files intentionally

#### **Dependencies**

**D1. External Service Dependencies**
- **Firebase**: User authentication, cloud storage, real-time database
  - *Risk*: Service outage or pricing changes
  - *Mitigation*: Implement fallback authentication system, consider self-hosted alternatives
  
- **OpenAI/Hugging Face**: AI summarization and chat features
  - *Risk*: API rate limits, cost increases, service deprecation
  - *Mitigation*: Implement usage quotas, cache common responses, explore open-source models
  
- **Tesseract.js/Google Vision**: OCR processing
  - *Risk*: Accuracy issues, processing delays, API quota limits
  - *Mitigation*: Hybrid approach (Tesseract.js for free tier, Google Vision for premium)
  
- **Google Drive API**: Cloud storage integration
  - *Risk*: API changes, quota limitations, OAuth complications
  - *Mitigation*: Make feature optional, provide native cloud storage alternative

**D2. Library Dependencies**
- **pdf-lib** (v1.17+): Core PDF manipulation
- **pdfkit** (v0.13+): PDF generation
- **React** (v18+): Frontend framework
- **Express** (v4.18+): Backend web framework
- **MongoDB Node Driver** (v5+): Database connectivity
- **TailwindCSS** (v3+): UI styling framework

*Risk*: Library vulnerabilities, breaking changes in updates, abandoned maintenance
*Mitigation*: Lock dependency versions, monitor security advisories, maintain forked copies of critical libraries

**D3. Infrastructure Dependencies**
- **Cloud Platform** (AWS/GCP/Azure): Hosting, storage, CDN
  - *Risk*: Service outages, cost overruns, vendor lock-in
  - *Mitigation*: Multi-cloud strategy, Docker containerization for portability
  
- **Domain and SSL**: DNS provider, SSL certificate authority
  - *Risk*: Domain expiration, certificate renewal failures
  - *Mitigation*: Auto-renewal setup, calendar reminders, backup registrar

**D4. Development Dependencies**
- **Version Control**: GitHub for source code repository
- **CI/CD Pipeline**: GitHub Actions or Jenkins for automated deployment
- **Monitoring**: LogRocket, Sentry, or similar for error tracking
- **Testing Framework**: Jest, Cypress for automated testing

**D5. Legal and Compliance Dependencies**
- Legal review of Terms of Service and Privacy Policy
- Accessibility audit for WCAG compliance
- Security audit before public launch
- GDPR/CCPA compliance certification (if handling EU/CA users)

**D6. User Acquisition Dependencies**
- Marketing channels for user growth
- Documentation and tutorial content
- Customer support infrastructure (email, chat, knowledge base)
- Community feedback loops (GitHub issues, Discord/Slack community)

---

## 3. System Features and Requirements

### 3.1 Universal File Support

**Description:**  
The system shall provide comprehensive file format support, enabling users to upload, process, and convert various document and image formats into editable PDF documents.

**Priority:** High  
**Risk:** Medium

#### Functional Requirements

**FR-3.1.1: File Upload Interface**
- **Requirement:** The system shall provide a drag-and-drop interface for file uploads
- **Input:** User drops files into designated upload zone
- **Processing:** File type validation, size check, virus scanning (optional)
- **Output:** Upload progress indicator, success/error message
- **Acceptance Criteria:**
  - Support drag-and-drop from file explorer
  - Support traditional file picker dialog
  - Display upload progress percentage
  - Show file preview thumbnails after upload
  - Maximum single file size: 100MB
  - Batch upload: up to 50 files simultaneously

**FR-3.1.2: Supported Input Formats**
- **Requirement:** The system shall accept the following file formats:
  - **PDF**: .pdf (all PDF versions up to PDF 2.0)
  - **Microsoft Word**: .docx, .doc
  - **Images**: .jpg, .jpeg, .png, .tiff, .tif, .bmp, .gif, .webp
  - **Text**: .txt
  - **Web**: .html, .htm
- **Processing:** Automatic format detection using file headers and MIME types
- **Output:** Format identification displayed to user
- **Acceptance Criteria:**
  - 99.9% accuracy in format detection
  - Reject unsupported formats with clear error message
  - Handle corrupted files gracefully without system crash

**FR-3.1.3: Automatic Format Conversion**
- **Requirement:** The system shall automatically convert uploaded files to PDF format for editing
- **Input:** Uploaded non-PDF file
- **Processing:** 
  - DOCX → PDF: Convert using mammoth.js or docx-pdf
  - Images → PDF: Embed images in PDF pages with appropriate scaling
  - TXT → PDF: Convert plain text with selectable font and formatting
  - HTML → PDF: Render HTML and convert to PDF with CSS styling preserved
- **Output:** Editable PDF document ready for manipulation
- **Acceptance Criteria:**
  - Conversion completes within 5 seconds for documents up to 20 pages
  - Preserve original formatting (fonts, colors, layout) with 95% accuracy
  - Maintain image quality during conversion (no compression unless specified)
  - Support Unicode characters and special symbols

**FR-3.1.4: Bidirectional Format Conversion**
- **Requirement:** The system shall enable users to convert PDFs to other formats
- **Supported Conversions:**
  - PDF → DOCX (editable Word document)
  - PDF → Images (one image per page: PNG, JPG)
  - PDF → TXT (plain text extraction)
  - PDF → HTML (web-ready format with CSS)
  - PDF → Markdown (for documentation)
- **Input:** PDF document, target format selection
- **Processing:** Format-specific conversion engine
- **Output:** Downloadable file in requested format
- **Acceptance Criteria:**
  - Text fidelity: 98%+ accuracy for digital PDFs
  - OCR-based conversion: 90%+ accuracy for scanned PDFs
  - Image quality options: Low (72 DPI), Medium (150 DPI), High (300 DPI)
  - Preserve tables, lists, and basic formatting in DOCX/HTML exports
  - Conversion time: <10 seconds for 50-page documents

**FR-3.1.5: Batch Processing**
- **Requirement:** Users shall be able to upload and convert multiple files simultaneously
- **Input:** Multiple files selected via upload interface
- **Processing:** Queue management system for sequential/parallel processing
- **Output:** Individual conversion status for each file, batch completion notification
- **Acceptance Criteria:**
  - Process up to 50 files per batch
  - Display real-time progress for each file
  - Allow cancellation of individual or all conversions
  - Download all converted files as ZIP archive

**FR-3.1.6: Format Validation and Error Handling**
- **Requirement:** The system shall validate file integrity and handle errors gracefully
- **Validation Checks:**
  - File size within limits
  - File not corrupted or password-protected (without password)
  - MIME type matches file extension
  - Content is readable and parsable
- **Error Handling:**
  - Display user-friendly error messages
  - Suggest corrective actions (e.g., "File is password-protected. Please remove password and try again.")
  - Log errors for debugging without exposing technical details to users
  - Provide option to retry or upload different file

### 3.2 Advanced PDF Editing

**Description:**  
The system shall provide a comprehensive visual editor with tools for modifying text, graphics, and layout within PDF documents, matching the functionality of professional desktop PDF editors.

**Priority:** Critical  
**Risk:** High

#### Functional Requirements

**FR-3.2.1: Text Editing Mode**
- **Requirement:** Users shall be able to edit existing text within PDF documents
- **Capabilities:**
  - Click-to-edit text blocks
  - Modify text content, font, size, color, alignment
  - Add new text boxes anywhere on the page
  - Delete or move text blocks
- **Input:** User clicks on text area, types or modifies content
- **Processing:** PDF content stream parsing and modification
- **Output:** Updated PDF with edited text
- **Acceptance Criteria:**
  - Text editing activates within 200ms of click
  - Support fonts: Standard PDF fonts + Google Fonts library (1000+ fonts)
  - Font sizes: 6pt to 144pt
  - Text colors: RGB color picker + common presets
  - Text alignment: Left, center, right, justify
  - Preserve original text positioning and spacing

**FR-3.2.2: Text Formatting Toolbar**
- **Requirement:** Provide a toolbar with comprehensive text formatting options
- **Toolbar Elements:**
  - Font family dropdown (with live preview)
  - Font size selector (numeric input + presets)
  - Bold, Italic, Underline toggle buttons
  - Text color picker
  - Text alignment buttons
  - Highlight color selector
  - Strikethrough option
- **Acceptance Criteria:**
  - All formatting changes apply in real-time
  - Toolbar appears contextually when text is selected
  - Keyboard shortcuts supported (Ctrl+B, Ctrl+I, Ctrl+U, etc.)
  - Responsive toolbar positioning (stays within viewport)

**FR-3.2.3: Annotation Tools**
- **Requirement:** Users shall be able to add visual annotations to PDFs
- **Annotation Types:**
  - **Highlight**: Semi-transparent color overlay on text
  - **Underline**: Line beneath selected text
  - **Strikethrough**: Line through text
  - **Sticky Notes**: Clickable comment icons
  - **Text Comments**: Inline comment boxes
- **Input:** User selects text, chooses annotation type and color
- **Processing:** Annotation layer creation (non-destructive)
- **Output:** Annotated PDF with preservable/removable annotations
- **Acceptance Criteria:**
  - 8 preset colors for highlights + custom color picker
  - Annotations are separate layer (can be toggled on/off)
  - Export options: Include or exclude annotations
  - Display author and timestamp for each annotation

**FR-3.2.4: Drawing and Shape Tools**
- **Requirement:** The system shall provide freehand drawing and shape insertion capabilities
- **Drawing Tools:**
  - **Pen Tool**: Freehand drawing with mouse/stylus
  - **Line Tool**: Straight lines with arrow options
  - **Rectangle**: Outlined or filled rectangles
  - **Circle/Ellipse**: Outlined or filled circles
  - **Arrow**: Directional arrows (single/double-headed)
  - **Eraser**: Remove drawn elements
- **Tool Properties:**
  - Color selection (border and fill)
  - Line thickness: 1px to 20px
  - Opacity: 0% to 100%
  - Line style: Solid, dashed, dotted
- **Acceptance Criteria:**
  - Smooth drawing experience (60 FPS rendering)
  - Shapes are resizable and repositionable after creation
  - Maintain aspect ratio with Shift key modifier
  - Snap-to-grid option for precise alignment
  - Undo/redo support for all drawing actions

**FR-3.2.5: Image Insertion and Manipulation**
- **Requirement:** Users shall be able to insert, resize, and position images within PDFs
- **Capabilities:**
  - Upload and insert images from local storage
  - Drag-and-drop image positioning
  - Resize with corner handles (maintain aspect ratio)
  - Rotate images (0-360 degrees)
  - Layer ordering (bring to front, send to back)
  - Image opacity adjustment
- **Supported Image Formats:** JPG, PNG, GIF, BMP, WebP, SVG
- **Acceptance Criteria:**
  - Image insertion completes within 2 seconds
  - Maximum image size: 10MB per image
  - Preserve image quality (no automatic compression unless specified)
  - Image context menu: Copy, paste, delete, properties
  - Crop and basic filter tools (brightness, contrast, saturation)

**FR-3.2.6: Form Field Creation**
- **Requirement:** The system shall allow creation of interactive PDF forms
- **Form Field Types:**
  - **Text Field**: Single-line or multi-line text input
  - **Checkbox**: Binary selection (checked/unchecked)
  - **Radio Button**: Multiple choice (single selection)
  - **Dropdown**: List of predefined options
  - **Button**: Clickable action button
- **Field Properties:**
  - Field name (unique identifier)
  - Default value
  - Required/optional flag
  - Validation rules (e.g., email format, number range)
  - Tooltip text
  - Read-only option
- **Acceptance Criteria:**
  - Drag-and-drop field placement
  - Field properties panel for configuration
  - Tab order customization
  - Test mode to preview form behavior
  - Export as fillable PDF with form data preservation

**FR-3.2.7: Hyperlink Management**
- **Requirement:** Users shall be able to add and manage hyperlinks within PDFs
- **Link Types:**
  - External URL (web links)
  - Internal page navigation (go to page X)
  - Email links (mailto:)
  - File attachments
- **Input:** User selects text or area, provides link destination
- **Processing:** Link annotation creation
- **Output:** Clickable link with visual indicator (underline, color change)
- **Acceptance Criteria:**
  - Links visually distinguishable from regular text
  - Hover tooltip shows destination
  - Link editor for modifying existing links
  - Bulk link management (view all links, remove all links)
  - Open links in new tab option

**FR-3.2.8: Multi-Layer Management**
- **Requirement:** The system shall manage multiple editing layers for non-destructive editing
- **Layer Capabilities:**
  - View layer hierarchy in sidebar panel
  - Show/hide individual layers
  - Rename layers
  - Lock/unlock layers (prevent accidental edits)
  - Merge layers
  - Adjust layer opacity
  - Change layer order (z-index)
- **Acceptance Criteria:**
  - Layers panel displays visual thumbnail previews
  - Drag-and-drop layer reordering
  - Layer changes update canvas in real-time
  - Export options: Flatten all layers or preserve layers

**FR-3.2.9: Undo/Redo System**
- **Requirement:** The system shall maintain an action history for reversible editing
- **Capabilities:**
  - Undo last action (Ctrl+Z)
  - Redo undone action (Ctrl+Y / Ctrl+Shift+Z)
  - History stack: Minimum 50 actions
  - History panel showing list of actions with timestamps
  - Selective undo (jump to specific action in history)
- **Acceptance Criteria:**
  - Undo/redo response time: <100ms
  - History persists during session (cleared on document close)
  - Visual indication of current position in history
  - Clear history option for memory management

**FR-3.2.10: Zoom and Navigation**
- **Requirement:** Provide smooth zoom and pan controls for precise editing
- **Zoom Options:**
  - Zoom levels: 10% to 500%
  - Preset zoom: Fit width, fit page, actual size
  - Zoom in/out buttons (+/-)
  - Mouse wheel zoom (Ctrl+scroll)
  - Pinch-to-zoom (touch devices)
- **Navigation:**
  - Pan mode (hand tool) for moving around zoomed canvas
  - Mini-map showing current viewport position
  - Jump to page via page number input
  - Previous/next page buttons
  - Thumbnail sidebar for quick page navigation
- **Acceptance Criteria:**
  - Smooth zoom animation (no jarring jumps)
  - Maintain focus point during zoom
  - Keyboard shortcuts: Ctrl+ (zoom in), Ctrl- (zoom out), Ctrl+0 (reset)

### 3.3 AI-Powered Enhancements

**Description:**  
Integration of artificial intelligence models to provide advanced document processing capabilities including summarization, conversational queries, text rewriting, and OCR error correction.

**Priority:** High  
**Risk:** High (depends on third-party API availability)

#### Functional Requirements

**FR-3.3.1: Document Summarization**
- **Requirement:** The system shall generate concise summaries of PDF documents using AI
- **Input:** PDF document (full text or selected pages)
- **Processing:** 
  - Extract text from PDF
  - Send to AI API (OpenAI GPT-4, Claude, or Hugging Face models)
  - Generate summary with configurable length
- **Output:** Summary text in sidebar panel or overlay
- **Summary Options:**
  - Short (2-3 sentences / ~50 words)
  - Medium (1 paragraph / ~150 words)
  - Long (multiple paragraphs / ~300 words)
  - Bullet points (key takeaways)
- **Acceptance Criteria:**
  - Summarization completes within 30 seconds for documents up to 100 pages
  - Summary accuracy: Captures main ideas and key points
  - Support for documents up to 50,000 words (API token limits)
  - Display word count reduction percentage
  - Copy summary to clipboard or export as TXT
  - Multi-language support (matches source document language)

**FR-3.3.2: Chat with PDF**
- **Requirement:** Users shall be able to ask questions about document content conversationally
- **Chat Interface:**
  - Chat panel in sidebar or modal window
  - Message history display (user questions + AI responses)
  - Text input field with send button
  - Clear conversation button
- **Input:** User types natural language question
- **Processing:**
  - Document embeddings generation (vector database)
  - Semantic search for relevant document sections
  - Context-aware response generation using AI
- **Output:** AI-generated answer with source page references
- **Example Questions:**
  - "What is the main conclusion of this paper?"
  - "Summarize section 3.2"
  - "What are the key findings?"
  - "Extract all dates mentioned"
- **Acceptance Criteria:**
  - Response time: 3-10 seconds per question
  - Cite specific page numbers in responses
  - Handle follow-up questions with context awareness
  - Support up to 20 questions per document session
  - Display "AI is typing..." indicator during processing
  - Error handling for ambiguous or unanswerable questions

**FR-3.3.3: Smart Text Rewrite**
- **Requirement:** The system shall rephrase or simplify selected text using AI
- **Rewrite Modes:**
  - **Simplify**: Convert complex text to simpler language
  - **Formalize**: Make casual text more professional
  - **Shorten**: Reduce word count while preserving meaning
  - **Expand**: Add detail and explanation to brief text
  - **Paraphrase**: Rewrite in different words (plagiarism prevention)
- **Input:** User selects text block, chooses rewrite mode
- **Processing:** AI model rewrites text according to selected mode
- **Output:** Rewritten text with option to accept or reject
- **Acceptance Criteria:**
  - Rewrite completes within 5 seconds for text up to 500 words
  - Show side-by-side comparison (original vs. rewritten)
  - Accept/reject buttons with preview
  - Undo rewrite if not satisfactory
  - Character count display (before/after)
  - Preserve formatting (bold, italic) in rewrite

**FR-3.3.4: OCR Error Correction**
- **Requirement:** The system shall use AI to detect and correct OCR errors in scanned documents
- **Error Types Detected:**
  - Character misrecognition (O vs. 0, l vs. 1, rn vs. m)
  - Broken words due to poor scanning
  - Missing spaces or extra spaces
  - Garbled special characters
- **Input:** OCR-processed text from scanned PDF
- **Processing:**
  - AI analyzes text for contextual errors
  - Suggests corrections based on language models
  - Confidence scoring for each correction
- **Output:** Corrected text with highlighted changes
- **Acceptance Criteria:**
  - Correction accuracy: 85%+ improvement over raw OCR
  - Highlight suggested corrections (accept/reject individually)
  - Batch accept all suggestions option
  - Preserve original text in revision history
  - Processing time: 2-5 seconds per page

**FR-3.3.5: Content Extraction**
- **Requirement:** The system shall automatically identify and extract structured content
- **Extractable Elements:**
  - Tables (convert to CSV or Excel format)
  - Lists (ordered and unordered)
  - Key points or highlights
  - Citations and references
  - Dates, names, locations (named entity recognition)
  - Email addresses and phone numbers
- **Input:** PDF document
- **Processing:** AI-powered content analysis and extraction
- **Output:** Structured data in exportable format
- **Acceptance Criteria:**
  - Table extraction accuracy: 90%+ for well-formatted tables
  - Export formats: CSV, JSON, Excel, Markdown
  - Display extracted content in dedicated panel
  - Click to highlight source location in document
  - Batch extraction for all tables/lists in document

**FR-3.3.6: AI Usage Limits and Quotas**
- **Requirement:** The system shall manage AI API usage to control costs
- **Free Tier Limits:**
  - 10 AI requests per day per user
  - Document size limit: 10,000 words per request
  - Rate limiting: 3 requests per minute
- **Premium Tier Limits:**
  - 100 AI requests per day
  - Document size limit: 50,000 words per request
  - Rate limiting: 10 requests per minute
- **Quota Display:**
  - Show remaining requests in UI
  - Warning when approaching limit
  - Clear explanation of quota reset time
- **Acceptance Criteria:**
  - Real-time quota tracking and updates
  - Graceful degradation when quota exceeded
  - Option to purchase additional requests
  - Queue requests if rate limit exceeded

### 3.4 OCR and Image-to-Text Extraction

**Description:**  
Optical Character Recognition system to convert scanned PDFs and images into editable, searchable text.

**Priority:** High  
**Risk:** Medium

#### Functional Requirements

**FR-3.4.1: Automatic OCR Detection**
- **Requirement:** The system shall automatically detect when a PDF contains scanned images instead of text
- **Detection Method:**
  - Analyze PDF content streams
  - If no text objects found but images present → Scanned PDF
  - Calculate text-to-image ratio
- **Input:** Uploaded PDF file
- **Processing:** Content analysis to determine if OCR is needed
- **Output:** Notification: "This appears to be a scanned document. Would you like to enable OCR?"
- **Acceptance Criteria:**
  - Detection accuracy: 98%+
  - Detection completes within 1 second
  - Option to manually trigger OCR even for text-based PDFs
  - Skip OCR option for image-only documents (diagrams, photos)

**FR-3.4.2: OCR Processing Engine**
- **Requirement:** The system shall extract text from images using OCR technology
- **OCR Engines:**
  - **Primary**: Tesseract.js (client-side, free)
  - **Secondary**: Google Cloud Vision API (server-side, premium accuracy)
- **Input:** Scanned PDF pages or uploaded images
- **Processing:**
  - Pre-process images (deskew, denoise, contrast enhancement)
  - Run OCR algorithm
  - Post-process text (spell check, formatting cleanup)
- **Output:** Extracted text overlaid on original image (searchable PDF)
- **Acceptance Criteria:**
  - OCR accuracy: 90%+ for clear scans (300 DPI)
  - Processing speed: 2-5 seconds per page
  - Support grayscale and color images
  - Handle rotated pages (auto-deskew)
  - Progress indicator for multi-page OCR

**FR-3.4.3: Multi-Language Support**
- **Requirement:** OCR shall support text recognition in multiple languages
- **Supported Languages (Primary):**
  - English, Spanish, French, German, Italian, Portuguese
  - Chinese (Simplified & Traditional), Japanese, Korean
  - Arabic, Russian, Hindi
- **Language Detection:**
  - Automatic language detection (default)
  - Manual language selection in settings
  - Multi-language documents (mixed text)
- **Acceptance Criteria:**
  - Language detection accuracy: 95%+
  - Support for 50+ languages via Tesseract
  - Right-to-left text support (Arabic, Hebrew)
  - Unicode character preservation

**FR-3.4.4: OCR Quality Control**
- **Requirement:** The system shall provide confidence scoring and manual correction interface
- **Confidence Scoring:**
  - Character-level confidence (0-100%)
  - Word-level confidence
  - Overall page confidence score
- **Visual Indicators:**
  - Highlight low-confidence words in yellow
  - Red highlight for very low confidence (<50%)
  - Green checkmark for high confidence (>95%)
- **Manual Correction Interface:**
  - Click on highlighted word to edit
  - Side-by-side view (original image vs. extracted text)
  - Accept/reject suggestions
- **Acceptance Criteria:**
  - Display confidence score prominently
  - Allow download of confidence report (JSON/CSV)
  - Quick edit mode for batch corrections
  - Compare before/after OCR results

**FR-3.4.5: Searchable PDF Generation**
- **Requirement:** The system shall create searchable PDFs from scanned documents
- **Process:**
  - Preserve original image as background layer
  - Overlay extracted text as invisible, selectable layer
  - Maintain exact position matching between image and text
- **Output:** Hybrid PDF (image + text layer)
- **Capabilities:**
  - Text is selectable and copyable
  - Ctrl+F search works across document
  - Screen readers can access text (accessibility)
  - Original visual appearance unchanged
- **Acceptance Criteria:**
  - Text position accuracy: 95%+ match to image
  - No visible artifacts or text overlap
  - File size increase: <20% from original
  - Preserve original PDF metadata

**FR-3.4.6: Text Export Options**
- **Requirement:** Users shall be able to export extracted text in multiple formats
- **Export Formats:**
  - Plain Text (.txt)
  - Microsoft Word (.docx)
  - Markdown (.md)
  - HTML (.html)
  - JSON (structured data with confidence scores)
- **Export Options:**
  - Include/exclude low-confidence words
  - Preserve formatting (bold, italic, headings)
  - Include page numbers and breaks
  - Optional metadata (timestamp, OCR engine version)
- **Acceptance Criteria:**
  - Export completes within 3 seconds for 50-page document
  - Formatting preservation: 85%+ accuracy for DOCX/HTML
  - Download or copy to clipboard options
  - Batch export for multiple documents

**FR-3.4.7: Image Pre-processing**
- **Requirement:** The system shall enhance image quality before OCR processing
- **Enhancement Options:**
  - **Auto-enhance**: Automatically apply best settings
  - **Manual controls**:
    - Brightness adjustment (-50 to +50)
    - Contrast adjustment (-50 to +50)
    - Sharpness (0 to 100)
    - Noise reduction (Low, Medium, High)
    - Deskew (auto-rotate to correct angle)
    - Crop (remove borders/margins)
- **Acceptance Criteria:**
  - Preview enhanced image before OCR
  - Apply/reset enhancements
  - Save enhancement settings as preset
  - Processing time: <2 seconds per image
  - Improve OCR accuracy by 10-30% for poor-quality scans

### 3.5 File Management and Document Operations

**Description:**  
Comprehensive suite of tools for manipulating PDF documents at the file and page level.

**Priority:** Critical  
**Risk:** Low

#### Functional Requirements

**FR-3.5.1: PDF Merge**
- **Requirement:** Users shall be able to combine multiple PDF files into a single document
- **Input:** 2 to 50 PDF files selected in desired order
- **Processing:**
  - Load all PDFs into memory
  - Concatenate pages in specified order
  - Merge document metadata and bookmarks
- **Output:** Single merged PDF file
- **Features:**
  - Drag-and-drop reordering before merge
  - Preview thumbnails for each PDF
  - Select specific page ranges from each PDF
  - Optional: Add blank pages between documents
  - Optional: Create table of contents
- **Acceptance Criteria:**
  - Merge completes within 10 seconds for 10 PDFs (500 total pages)
  - Preserve original page quality and formatting
  - Maintain hyperlinks and form fields
  - File size optimization option
  - Progress indicator for large merges

**FR-3.5.2: PDF Split**
- **Requirement:** Users shall be able to separate a PDF into multiple files
- **Split Methods:**
  - **By page range**: Pages 1-10, 11-20, etc.
  - **By bookmark**: Split at each bookmark location
  - **Every N pages**: Create new file every 5 pages
  - **Extract single pages**: Select specific pages to extract
  - **Custom splits**: User-defined split points
- **Input:** PDF file, split criteria
- **Processing:** Create separate PDF files based on criteria
- **Output:** Multiple PDF files, optionally packaged in ZIP
- **Acceptance Criteria:**
  - Split completes within 5 seconds for 100-page document
  - Preview split results before confirming
  - Auto-naming: original_name_part1.pdf, original_name_part2.pdf
  - Custom naming template option
  - Download all splits as ZIP archive

**FR-3.5.3: Page Rearrangement**
- **Requirement:** Users shall be able to reorder, duplicate, and delete pages visually
- **Interface:**
  - Thumbnail grid view of all pages
  - Drag-and-drop to reorder
  - Right-click context menu: Delete, Duplicate, Rotate, Move to position
- **Operations:**
  - Reorder pages (drag-and-drop)
  - Delete single or multiple pages (with undo)
  - Duplicate pages
  - Rotate pages (90°, 180°, 270°)
  - Move page to specific position (numeric input)
- **Acceptance Criteria:**
  - Real-time thumbnail updates during rearrangement
  - Multi-select pages (Ctrl+click, Shift+click)
  - Undo/redo for all operations
  - "Before" and "after" preview
  - Apply changes without re-uploading file

**FR-3.5.4: PDF Compression**
- **Requirement:** The system shall reduce PDF file size while maintaining acceptable quality
- **Compression Levels:**
  - **Low**: Minimal compression (~10-20% reduction), highest quality
  - **Medium**: Balanced compression (~30-50% reduction), good quality
  - **High**: Maximum compression (~50-70% reduction), acceptable quality
- **Compression Techniques:**
  - Image downsampling (reduce DPI)
  - Image quality reduction (JPEG compression)
  - Remove duplicate resources
  - Font subsetting
  - Remove metadata and embedded thumbnails
- **Input:** PDF file, compression level
- **Processing:** Apply compression algorithms
- **Output:** Compressed PDF with size comparison
- **Acceptance Criteria:**
  - Show file size before and after
  - Preview compressed version before download
  - Processing time: <5 seconds per MB
  - Option to compare side-by-side (quality check)
  - Revert to original if not satisfied

**FR-3.5.5: PDF Encryption and Security**
- **Requirement:** Users shall be able to password-protect and encrypt PDF files
- **Security Features:**
  - **User Password**: Required to open PDF
  - **Owner Password**: Required to modify permissions
  - **Encryption**: AES-256 bit encryption
- **Permission Controls:**
  - Prevent printing
  - Prevent copying text/images
  - Prevent editing/annotations
  - Prevent form filling
  - Prevent page extraction
- **Input:** PDF file, password(s), permission settings
- **Processing:** Apply encryption and restrictions
- **Output:** Secured PDF file
- **Acceptance Criteria:**
  - Password strength indicator (weak/medium/strong)
  - Optional: Generate random strong password
  - Encryption completes within 3 seconds for 50-page PDF
  - Compatible with all major PDF readers
  - Remove password feature (requires original password)

**FR-3.5.6: Watermark Application**
- **Requirement:** Users shall be able to add text or image watermarks to PDFs
- **Watermark Types:**
  - **Text Watermark**: Custom text with formatting
  - **Image Watermark**: Logo or graphic overlay
- **Customization Options:**
  - Position: Center, corners, custom coordinates
  - Rotation: 0-360 degrees
  - Opacity: 0-100%
  - Size: Adjustable scale
  - Color: For text watermarks
  - Font: For text watermarks
  - Layer: Background or foreground
- **Application:**
  - Apply to all pages or specific page range
  - Preview before applying
  - Batch watermarking for multiple PDFs
- **Acceptance Criteria:**
  - Real-time preview of watermark placement
  - Save watermark as template for reuse
  - Apply different watermarks to different pages
  - Processing time: <5 seconds for 50-page PDF
  - Non-destructive (original PDF preserved)

**FR-3.5.7: Header, Footer, and Page Numbers**
- **Requirement:** The system shall add customizable headers, footers, and page numbers
- **Elements:**
  - **Header**: Top of each page
  - **Footer**: Bottom of each page
  - **Page Numbers**: Customizable format and position
- **Customization:**
  - Text content (static text + dynamic variables)
  - Variables: {page}, {total_pages}, {date}, {title}, {author}
  - Font, size, color
  - Alignment: Left, center, right
  - Margin from edge
  - Exclude from specific pages (e.g., cover page)
- **Page Number Formats:**
  - Numeric: 1, 2, 3...
  - Roman: i, ii, iii... or I, II, III...
  - Custom: "Page 1 of 50"
- **Acceptance Criteria:**
  - Live preview of first/middle/last page
  - Different headers/footers for odd/even pages
  - Apply to page range or entire document
  - Processing time: <3 seconds for 100-page PDF
  - Template library (common formats)

**FR-3.5.8: PDF Repair**
- **Requirement:** The system shall attempt to repair corrupted or damaged PDF files
- **Repair Capabilities:**
  - Fix broken cross-reference tables
  - Rebuild missing object streams
  - Recover partial content from damaged files
  - Linearize PDF for web optimization
- **Input:** Corrupted PDF file
- **Processing:** Analyze and repair structural issues
- **Output:** Repaired PDF or detailed error report
- **Acceptance Criteria:**
  - Success rate: 60-80% for repairable files
  - Clear explanation when repair not possible
  - Preview repaired content before download
  - No data loss for repairable sections
  - Processing time: <10 seconds for standard PDFs

### 3.6 Data Visualization and Metadata Tools

**Description:**  
Tools for viewing, editing, and analyzing PDF metadata and document properties.

**Priority:** Medium  
**Risk:** Low

#### Functional Requirements

**FR-3.6.1: Metadata Display**
- **Requirement:** The system shall extract and display PDF metadata
- **Metadata Fields:**
  - Title
  - Author
  - Subject
  - Keywords/Tags
  - Creator application
  - Producer
  - Creation date
  - Modification date
  - PDF version
  - Page count
  - File size
  - Encryption status
- **Display Location:** Sidebar panel or modal dialog
- **Acceptance Criteria:**
  - Display all available metadata fields
  - Show "Not specified" for missing fields
  - Extraction completes instantly (<500ms)
  - Copy metadata to clipboard (JSON format)

**FR-3.6.2: Metadata Editing**
- **Requirement:** Users shall be able to edit and save PDF metadata
- **Editable Fields:**
  - Title, Author, Subject, Keywords
  - Custom properties (key-value pairs)
- **Input:** Text input fields for each property
- **Processing:** Update PDF metadata dictionary
- **Output:** PDF with modified metadata
- **Acceptance Criteria:**
  - Inline editing interface
  - Save/cancel buttons
  - Validation for required fields
  - Character limits displayed
  - Preserve read-only fields (creation date, PDF version)
  - Changes saved within 1 second

**FR-3.6.3: Document Analytics**
- **Requirement:** The system shall provide statistical analysis of PDF content
- **Analytics Metrics:**
  - **Text Statistics**:
    - Total word count
    - Character count (with/without spaces)
    - Sentence count
    - Paragraph count
    - Average words per sentence
  - **Page Statistics**:
    - Total pages
    - Average words per page
    - Pages with images
    - Blank pages detection
  - **Reading Metrics**:
    - Estimated reading time (based on 200-250 WPM)
    - Text density visualization
  - **Content Analysis**:
    - Most common words (word cloud)
    - Language distribution
    - Font usage report
- **Display:** Dashboard with charts and graphs
- **Acceptance Criteria:**
  - Analysis completes within 5 seconds for 100-page PDF
  - Visual representations (bar charts, pie charts, word cloud)
  - Export analytics as CSV or PDF report
  - Compare analytics across multiple documents

**FR-3.6.4: Font Analysis**
- **Requirement:** The system shall analyze and report font usage in PDFs
- **Font Information:**
  - Font names used in document
  - Font types (TrueType, Type1, CID)
  - Embedded vs. referenced fonts
  - Font size distribution
  - Pages where each font appears
- **Use Cases:**
  - Identify non-standard fonts before printing
  - Ensure consistent typography
  - Troubleshoot rendering issues
- **Acceptance Criteria:**
  - Display font family and variations
  - Highlight missing or substituted fonts
  - Option to replace fonts globally
  - Export font report as TXT/PDF

**FR-3.6.5: Color Palette Extraction**
- **Requirement:** The system shall extract and display color schemes used in PDF
- **Color Information:**
  - Dominant colors (top 10)
  - Color space (RGB, CMYK, Grayscale)
  - Color histogram
  - Hex/RGB/CMYK values for each color
- **Visual Display:**
  - Color swatches with percentages
  - Visual palette grid
  - Click to copy color codes
- **Use Cases:**
  - Brand compliance checking
  - Design consistency analysis
  - Print preparation (CMYK verification)
- **Acceptance Criteria:**
  - Extraction completes within 3 seconds
  - Export palette as CSS, JSON, or ASE (Adobe Swatch Exchange)
  - Filter colors by threshold (exclude very minor colors)

**FR-3.6.6: Document Properties Inspector**
- **Requirement:** Provide comprehensive technical details about PDF structure
- **Properties Displayed:**
  - PDF version (1.4, 1.7, 2.0, etc.)
  - Linearization status (web-optimized)
  - Encryption method and level
  - Permissions and restrictions
  - Number of bookmarks
  - Number of annotations
  - Embedded files count
  - JavaScript presence
  - Digital signatures
- **Acceptance Criteria:**
  - Organized in collapsible sections
  - Technical and user-friendly descriptions
  - Export as JSON for programmatic access
  - Warning indicators for security concerns

### 3.7 Collaboration and Cloud Features

**Description:**  
User account system, cloud storage, and real-time collaborative editing capabilities.

**Priority:** High  
**Risk:** High (requires backend infrastructure)

#### Functional Requirements

**FR-3.7.1: User Authentication**
- **Requirement:** The system shall provide secure user registration and login
- **Authentication Methods:**
  - Email + Password (with email verification)
  - Google OAuth 2.0
  - GitHub OAuth (optional)
  - Facebook Login (optional)
- **Password Requirements:**
  - Minimum 8 characters
  - At least one uppercase letter
  - At least one number
  - At least one special character
- **Security Features:**
  - Password hashing (bcrypt, 12+ rounds)
  - Email verification for new accounts
  - Password reset via email link
  - Session management with JWT tokens
  - Two-factor authentication (2FA) - optional
- **Acceptance Criteria:**
  - Registration completes within 3 seconds
  - Email verification link expires after 24 hours
  - OAuth login redirects within 2 seconds
  - Invalid credentials show clear error message
  - Account lockout after 5 failed login attempts (15-minute timeout)

**FR-3.7.2: Cloud Storage**
- **Requirement:** Authenticated users shall have cloud storage for their PDF documents
- **Storage Tiers:**
  - **Free Tier**: 5GB storage, 20 documents max
  - **Basic Tier**: 50GB storage, unlimited documents
  - **Premium Tier**: 100GB storage, unlimited documents, priority processing
- **File Management:**
  - Upload files to cloud storage
  - Organize files in folders
  - Search files by name, date, or tags
  - Sort by name, date, size, or type
  - Bulk operations (move, delete, download)
- **File Operations:**
  - Open and edit stored files directly
  - Create new files in cloud
  - Download files to local storage
  - Share files with other users
  - Restore deleted files (30-day trash)
- **Acceptance Criteria:**
  - Upload speed: >5 MB/s on 20 Mbps connection
  - File list loads within 1 second
  - Storage quota displayed prominently
  - Warning when approaching storage limit
  - Auto-sync edited files to cloud (save every 30 seconds)

**FR-3.7.3: Document Sharing**
- **Requirement:** Users shall be able to share documents with others
- **Sharing Methods:**
  - **Public Link**: Anyone with link can access
  - **Private Link**: Requires recipient email (access control)
  - **Email Invitation**: Send document via email
- **Permission Levels:**
  - **View Only**: Can view and download, cannot edit
  - **Comment**: Can view and add comments/annotations
  - **Edit**: Full editing permissions
- **Link Settings:**
  - Expiration date (1 day, 7 days, 30 days, never)
  - Password protection (optional)
  - Download enable/disable
  - View count tracking
  - Revoke access anytime
- **Acceptance Criteria:**
  - Share link generates within 1 second
  - Shareable link is short and memorable (or copyable)
  - QR code generation for mobile sharing
  - Email notification when document is shared
  - Activity log showing who accessed document and when

**FR-3.7.4: Real-Time Collaboration**
- **Requirement:** Multiple users shall be able to edit the same document simultaneously
- **Collaborative Features:**
  - Real-time cursor tracking (see where others are working)
  - Live updates as other users make changes
  - User presence indicators (avatar icons)
  - Change attribution (who made which edit)
  - Conflict resolution for simultaneous edits
- **Technical Implementation:**
  - WebSocket connection for real-time sync
  - Operational Transformation (OT) or CRDT for conflict-free edits
  - Maximum 10 concurrent users per document (free tier)
- **Acceptance Criteria:**
  - Changes propagate within 500ms to all users
  - User presence updates within 1 second
  - Smooth experience with no lag or jitter
  - Automatic reconnection if connection drops
  - Save state even during disconnection (merge on reconnect)

**FR-3.7.5: Comment and Annotation System**
- **Requirement:** Users shall be able to add comments and reply to others' annotations
- **Comment Features:**
  - Add comment to specific page or text selection
  - Reply to existing comments (threaded discussions)
  - Mention other users (@username)
  - Mark comments as resolved
  - Filter comments by status (open/resolved), author, or date
- **Comment Display:**
  - Comment sidebar panel listing all comments
  - In-document indicators (numbered comment icons)
  - Hover to preview comment content
  - Click to jump to comment location
- **Notifications:**
  - Email notification when mentioned in comment
  - In-app notification for new comments on shared documents
  - Daily digest option (summary of all activity)
- **Acceptance Criteria:**
  - Comment saves within 500ms
  - Real-time comment updates for collaborators
  - Rich text formatting in comments (bold, italic, links)
  - Attach images or files to comments
  - Export all comments as CSV or PDF report

**FR-3.7.6: Version History**
- **Requirement:** The system shall maintain version history for edited documents
- **Version Tracking:**
  - Automatic snapshots every 5 minutes during active editing
  - Manual "Create Version" button
  - Version naming/tagging
  - Store up to 50 versions (free tier) or unlimited (premium)
- **Version Information:**
  - Timestamp of each version
  - User who created the version
  - Brief change description (auto-generated or manual)
  - File size of each version
- **Version Operations:**
  - Preview any historical version
  - Restore previous version (with confirmation)
  - Compare two versions (visual diff)
  - Download specific version
  - Delete old versions to free storage
- **Acceptance Criteria:**
  - Version list loads within 1 second
  - Version preview opens within 2 seconds
  - Rollback completes within 3 seconds
  - Visual diff highlighting shows added/removed/changed content
  - No data loss during version restore

**FR-3.7.7: Google Drive Integration**
- **Requirement:** Users shall be able to connect their Google Drive account
- **Integration Features:**
  - OAuth authentication with Google Drive
  - Browse and open PDFs from Google Drive
  - Save edited PDFs back to Google Drive
  - Auto-sync option (keep Google Drive copy updated)
  - Two-way sync (changes in either location sync to other)
- **File Operations:**
  - Import from Drive to UniPDF Studio
  - Export from UniPDF Studio to Drive
  - Open Drive file directly without importing
  - Create new folder in Drive from app
- **Acceptance Criteria:**
  - OAuth flow completes within 5 seconds
  - File list from Drive loads within 2 seconds
  - Upload to Drive completes at >5 MB/s
  - Error handling for quota exceeded or permission denied
  - Disconnect Google Drive option with data retention choice

**FR-3.7.8: Team Workspaces**
- **Requirement:** Users shall be able to create shared team workspaces (premium feature)
- **Workspace Features:**
  - Invite team members via email
  - Shared folder accessible to all team members
  - Role-based permissions (Admin, Editor, Viewer)
  - Team activity feed (who did what, when)
  - Centralized billing and storage quota
- **Admin Controls:**
  - Add/remove team members
  - Change member roles
  - Set default permissions for new files
  - View team usage statistics
  - Transfer workspace ownership
- **Acceptance Criteria:**
  - Support teams of 5-100 members
  - Invitation email sent within 1 minute
  - Real-time activity feed updates
  - Team storage separate from personal storage
  - Workspace settings page for admins

### 3.8 User Interface Requirements

**Description:**  
Specifications for the visual design, layout, and interaction patterns of the application interface.

**Priority:** Critical  
**Risk:** Low

#### Functional Requirements

**FR-3.8.1: Application Layout**
- **Requirement:** The interface shall follow a professional, desktop-application-inspired layout
- **Layout Structure:**
  - **Top Bar**: Logo, file name, user account menu, save/download buttons
  - **Toolbar**: Horizontally arranged editing tools (text, draw, annotate, etc.)
  - **Left Sidebar**: Page thumbnails, bookmarks, navigation
  - **Main Canvas**: Document display and editing area
  - **Right Sidebar**: Comments, layers, properties panel
  - **Bottom Bar**: Page navigation, zoom controls, status information
- **Responsive Behavior:**
  - Desktop: Full layout with all panels
  - Tablet: Collapsible sidebars, touch-optimized controls
  - Mobile: Simplified layout, essential tools only
- **Acceptance Criteria:**
  - Clean, uncluttered interface
  - Consistent spacing and alignment
  - All UI elements accessible within 3 clicks
  - No horizontal scrolling on standard screens
  - Minimum supported resolution: 1280×720

**FR-3.8.2: Toolbar Design**
- **Requirement:** Provide an icon-based toolbar with organized tool groups
- **Tool Groups:**
  - **File Operations**: New, open, save, download, print
  - **Edit Tools**: Text, draw, shapes, images, forms
  - **Annotation Tools**: Highlight, underline, comment, sticky note
  - **Page Operations**: Add, delete, rearrange, rotate
  - **View Controls**: Zoom, fit, pan, grid, rulers
- **Toolbar Behavior:**
  - Icon + tooltip on hover
  - Active tool highlighted
  - Dropdown menus for tool variants (e.g., shape types)
  - Customizable toolbar (show/hide tools)
  - Keyboard shortcut display in tooltips
- **Acceptance Criteria:**
  - Icons clear and recognizable (24×24px minimum)
  - Tooltips appear within 500ms of hover
  - Consistent icon style (outline or filled, not mixed)
  - Tool activation response time: <100ms
  - Toolbar can be collapsed to maximize canvas space

**FR-3.8.3: Sidebar Panels**
- **Requirement:** Provide collapsible sidebars for navigation and properties
- **Left Sidebar Tabs:**
  - **Thumbnails**: Visual page previews with page numbers
  - **Bookmarks**: Document outline/table of contents
  - **Search**: Find text within document
- **Right Sidebar Tabs:**
  - **Comments**: All annotations and discussions
  - **Layers**: Layer hierarchy and visibility controls
  - **Properties**: Selected object properties editor
  - **AI Assistant**: AI chat and tools
- **Sidebar Behavior:**
  - Collapse/expand with animation
  - Resizable width (drag border)
  - Remember collapsed state per session
  - Tab switching with smooth transition
- **Acceptance Criteria:**
  - Thumbnail generation completes within 2 seconds for 50-page PDF
  - Sidebar width adjustable from 200px to 600px
  - Collapse/expand animation: 200ms
  - Thumbnail click navigates to page instantly

**FR-3.8.4: Theme Support**
- **Requirement:** The application shall support light and dark color themes
- **Themes:**
  - **Light Theme**: White background, dark text (default)
  - **Dark Theme**: Dark gray background, light text
  - **Auto**: Match system preference
- **Theme Application:**
  - Affects entire interface (toolbar, sidebars, canvas background)
  - Smooth transition animation when switching
  - Theme preference saved per user
- **Acceptance Criteria:**
  - Theme toggle button in user menu
  - Theme switch completes within 300ms
  - Maintain WCAG contrast ratios (4.5:1 for text)
  - Canvas background adapts to theme (light gray vs. dark gray)

**FR-3.8.5: Keyboard Shortcuts**
- **Requirement:** Provide comprehensive keyboard shortcuts for power users
- **Essential Shortcuts:**
  - **File**: Ctrl+O (open), Ctrl+S (save), Ctrl+P (print)
  - **Edit**: Ctrl+Z (undo), Ctrl+Y (redo), Ctrl+C/V/X (copy/paste/cut)
  - **Selection**: Ctrl+A (select all), Escape (deselect)
  - **Navigation**: Page Up/Down, Home/End, Ctrl+Home/End
  - **Zoom**: Ctrl+Plus (zoom in), Ctrl+Minus (zoom out), Ctrl+0 (reset)
  - **Tools**: T (text), D (draw), S (select), H (hand/pan)
- **Shortcut Display:**
  - Keyboard shortcuts panel (? key)
  - Shortcuts shown in tooltips
  - Customizable shortcuts (premium feature)
- **Acceptance Criteria:**
  - All major actions have shortcuts
  - Shortcuts work consistently across tools
  - No conflicts with browser shortcuts
  - Visual feedback when shortcut activated

**FR-3.8.6: Drag-and-Drop Interface**
- **Requirement:** Support drag-and-drop for intuitive file and element manipulation
- **Drag-and-Drop Actions:**
  - Drop files onto canvas to upload
  - Drag pages in thumbnail view to reorder
  - Drag images from desktop to insert
  - Drag to resize text boxes, images, shapes
  - Drag to reposition elements on canvas
- **Visual Feedback:**
  - Drop zone highlight when file hovered
  - Ghost image/outline during drag
  - Snap-to-grid guides for alignment
  - Cursor change to indicate drag state
- **Acceptance Criteria:**
  - Drag response time: <16ms (60 FPS)
  - Clear visual feedback at all stages
  - Cancel drag with Escape key
  - Undo/redo for drag operations

**FR-3.8.7: Progress Indicators**
- **Requirement:** Display clear loading and progress states for all operations
- **Indicator Types:**
  - **Spinner**: Indeterminate progress (loading, processing)
  - **Progress Bar**: Determinate progress (upload, OCR, file processing)
  - **Toast Notifications**: Success/error messages (bottom-right corner)
  - **Skeleton Screens**: Placeholder content while loading
- **Use Cases:**
  - File upload: Progress bar with percentage and speed
  - OCR processing: Progress bar with current page / total pages
  - AI requests: Spinner with "AI is thinking..." message
  - File save: Spinner with "Saving..." message
- **Acceptance Criteria:**
  - Progress indicator appears within 100ms of action start
  - Accurate percentage display (updates every 500ms)
  - Option to cancel long-running operations
  - Success notification auto-dismisses after 3 seconds
  - Error notifications persist until manually dismissed

**FR-3.8.8: Accessibility Features**
- **Requirement:** The application shall meet WCAG 2.1 Level AA accessibility standards
- **Accessibility Features:**
  - Keyboard navigation for all functions (tab order)
  - ARIA labels for screen readers
  - Focus indicators (visible outline on focused elements)
  - Sufficient color contrast (4.5:1 for text, 3:1 for UI elements)
  - Alternative text for icons and images
  - Skip navigation links
  - Resizable text (up to 200% without breaking layout)
  - No flashing elements (seizure prevention)
- **Screen Reader Support:**
  - Descriptive labels for all interactive elements
  - Status announcements for dynamic content changes
  - Document structure exposed (headings, landmarks)
- **Acceptance Criteria:**
  - Pass automated accessibility testing (axe, WAVE)
  - Manual testing with screen readers (NVDA, JAWS, VoiceOver)
  - All functionality accessible via keyboard only
  - No keyboard traps

**FR-3.8.9: Responsive Design**
- **Requirement:** The interface shall adapt to different screen sizes and devices
- **Breakpoints:**
  - **Desktop**: ≥1280px (full layout)
  - **Tablet**: 768px - 1279px (collapsible sidebars)
  - **Mobile**: <768px (simplified layout, limited features)
- **Responsive Behaviors:**
  - Toolbar collapses to hamburger menu on mobile
  - Sidebars become modal panels on mobile
  - Touch-friendly button sizes on tablet/mobile (minimum 44×44px)
  - Canvas uses full screen width on mobile
  - Pinch-to-zoom support on touch devices
- **Acceptance Criteria:**
  - Smooth transitions between breakpoints
  - No horizontal scrolling at any breakpoint
  - Core functionality available on all devices
  - Touch targets minimum 44×44px (Apple guidelines)
  - Test on iOS Safari, Chrome Android, Firefox Android

### 3.9 Export and Sharing Options

**Description:**  
Capabilities for exporting edited documents in various formats and sharing via multiple channels.

**Priority:** High  
**Risk:** Low

#### Functional Requirements

**FR-3.9.1: PDF Download**
- **Requirement:** Users shall be able to download edited PDFs to their device
- **Download Options:**
  - Save with current filename or specify new name
  - Download as flattened PDF (all layers merged)
  - Download with editable layers preserved
  - Include or exclude annotations
  - Optimize for web (linearized) or print (high quality)
- **File Naming:**
  - Default: original_name_edited.pdf
  - Custom filename with sanitization (remove invalid characters)
  - Auto-append timestamp option
- **Acceptance Criteria:**
  - Download initiates within 500ms of button click
  - Large files (>50MB) show progress indicator
  - Downloaded PDF opens correctly in all major PDF readers
  - No quality loss in flattened version
  - File size optimization option reduces size by 20-50%

**FR-3.9.2: Multi-Format Export**
- **Requirement:** The system shall export documents in multiple formats
- **Export Formats:**
  - **Microsoft Word (.docx)**: Editable document with formatting
  - **Plain Text (.txt)**: Raw text content only
  - **HTML (.html)**: Web page with CSS styling
  - **Markdown (.md)**: Formatted text for documentation
  - **Images (.png, .jpg)**: One image per page
  - **SVG (.svg)**: Vector graphics (for single-page diagrams)
- **Export Settings:**
  - **DOCX**: Preserve styles, images, tables
  - **Images**: Resolution (72, 150, 300 DPI), quality (low/med/high)
  - **HTML**: Include CSS (inline or external), embed images or link
  - **Text**: UTF-8 encoding, line breaks (Windows/Unix)
- **Acceptance Criteria:**
  - Export completes within 10 seconds for 50-page document
  - Format conversion accuracy: 90%+ for layouts
  - All formats downloadable as single file or ZIP (for images)
  - Preview exported content before download (for DOCX, HTML)

**FR-3.9.3: Email Integration**
- **Requirement:** Users shall be able to send documents via email directly from the app
- **Email Features:**
  - Pre-filled email form with subject and body
  - Attach current document (PDF or other format)
  - Multiple recipients (To, CC, BCC)
  - Email templates for common scenarios
- **Email Sending:**
  - Use SendGrid, AWS SES, or similar service
  - From address: noreply@unipdfstudio.com
  - Rate limiting: 10 emails per hour per user (free tier)
- **Input:** Recipient email(s), subject, message body
- **Processing:** Attach file, send via email service
- **Output:** Success confirmation or error message
- **Acceptance Criteria:**
  - Email sends within 5 seconds
  - Attachment size limit: 25MB
  - Email validation (reject invalid addresses)
  - Confirmation message: "Email sent successfully to [recipient]"
  - Delivery status tracking (sent, delivered, bounced)

**FR-3.9.4: Shareable Link Generation**
- **Requirement:** Users shall be able to create shareable links for documents
- **Link Types:**
  - **Public Link**: Anyone with link can access (no login required)
  - **Private Link**: Requires login to view
  - **One-Time Link**: Expires after first view
- **Link Settings:**
  - Expiration date (custom date/time)
  - Password protection (optional)
  - Permission level (view, comment, edit)
  - Allow download (yes/no)
  - Track views and downloads
- **Link Format:** `https://unipdfstudio.com/share/[unique-id]`
- **Acceptance Criteria:**
  - Link generates within 1 second
  - Short, memorable URLs (8-12 characters)
  - Copy to clipboard button
  - QR code generation for easy mobile access
  - Revoke link anytime from dashboard
  - View analytics (number of views, locations, timestamps)

**FR-3.9.5: QR Code Generation**
- **Requirement:** The system shall generate QR codes for mobile-friendly document access
- **QR Code Features:**
  - Encode shareable link in QR code
  - Customizable QR code size (150px to 1000px)
  - Color customization (foreground/background)
  - Logo embedding (center logo for branding)
  - Error correction level (Low, Medium, High)
- **Use Cases:**
  - Print QR code on materials for mobile access
  - Display QR code in presentations
  - Email QR code for contactless sharing
- **Acceptance Criteria:**
  - QR code generates within 500ms
  - Download QR code as PNG, SVG, or PDF
  - QR code scannable by all major mobile camera apps
  - Test on iOS Camera, Android Camera, third-party apps
  - Customization preview before download

**FR-3.9.6: Print Functionality**
- **Requirement:** Users shall be able to print documents directly from the browser
- **Print Options:**
  - Print all pages or specific page range
  - Print with or without annotations
  - Page orientation (portrait/landscape)
  - Paper size (Letter, A4, Legal, custom)
  - Print quality (draft, normal, high)
  - Scale to fit page option
  - Two-sided (duplex) printing
- **Print Preview:**
  - Show preview before printing
  - Adjust margins, headers, footers
  - Page numbering for multi-page prints
- **Acceptance Criteria:**
  - Print dialog opens within 1 second
  - Preview accurately reflects final print output
  - Support browser print dialog (Ctrl+P)
  - Maintain page quality and formatting
  - Optional: Generate print-optimized PDF instead of direct print

**FR-3.9.7: Batch Export**
- **Requirement:** Users shall be able to export multiple documents simultaneously
- **Batch Operations:**
  - Select multiple files from cloud storage
  - Apply same export settings to all files
  - Export all to same format (e.g., all to DOCX)
  - Download as ZIP archive with organized structure
- **Processing:**
  - Queue management for batch jobs
  - Process files in parallel (up to 5 concurrent)
  - Progress indicator showing completed/remaining files
- **Acceptance Criteria:**
  - Support up to 50 files per batch
  - Total batch time: <30 seconds for 10 small files
  - Individual file errors don't stop batch (continue with remaining)
  - Detailed report of successful and failed exports
  - Resume batch after interruption

**FR-3.9.8: Cloud Service Integration**
- **Requirement:** Users shall be able to export directly to cloud storage services
- **Supported Services:**
  - Google Drive (primary)
  - Dropbox (future)
  - OneDrive (future)
- **Export Workflow:**
  - Select "Export to Google Drive" option
  - Choose destination folder in Drive
  - Specify filename and format
  - Confirm and initiate export
- **Acceptance Criteria:**
  - OAuth authentication for cloud services
  - Upload speed: >5 MB/s
  - Show upload progress
  - Confirm with "File saved to Google Drive" message
  - Open exported file in Drive option (direct link)

---

## 4. External Interface Requirements

### 4.1 User Interfaces

**Description:**  
This section defines the visual and interaction requirements for all user-facing interfaces in UniPDF Studio.

#### UI-4.1.1: Main Application Interface

**Screen Layout:**
```
┌─────────────────────────────────────────────────────────────────┐
│ [Logo] UniPDF Studio    document.pdf ▼    [Save] [Download] [👤]│ ← Top Bar
├─────────────────────────────────────────────────────────────────┤
│ [📄][✏️][🖍][🖼][📝][🔗][📌] ... [↩️][↪️][🔍]                   │ ← Toolbar
├────┬────────────────────────────────────────────────────────┬───┤
│📑  │                                                        │💬 │
│    │                                                        │   │
│[1] │                                                        │   │
│[2] │          MAIN CANVAS (PDF DISPLAY)                     │   │
│[3] │                                                        │   │
│... │                                                        │   │
│    │                                                        │   │
│    │                                                        │   │
└────┴────────────────────────────────────────────────────────┴───┘
     [◀] Page 1 of 50 [▶]     [➖] 100% [➕]     Status: Saved
     ← Left Sidebar    Main Canvas              Right Sidebar →
                       ↑ Bottom Bar
```

**Interface Elements:**

**Top Bar (60px height):**
- **Left Section**:
  - Application logo (40×40px, clickable to home)
  - Document title (editable on click)
  - File menu dropdown (Open, Recent, New)
- **Center Section**:
  - Auto-save indicator ("Saving..." / "Saved" with timestamp)
- **Right Section**:
  - Save button (Ctrl+S)
  - Download button with format dropdown
  - Share button
  - User profile menu (avatar, settings, logout)

**Toolbar (50px height):**
- **File Group**: New, Open, Save, Download, Print
- **Edit Group**: Select, Text, Draw, Erase
- **Annotate Group**: Highlight, Underline, Comment, Sticky Note
- **Insert Group**: Image, Shape, Text Box, Form Field, Link
- **Page Group**: Add Page, Delete Page, Rotate, Reorder
- **View Group**: Zoom In/Out, Fit Width, Fit Page, Grid, Ruler
- **Action Group**: Undo, Redo, Find
- **AI Group**: Summarize, Chat, Rewrite

**Left Sidebar (250-600px width, collapsible):**
- **Tabs**:
  - Thumbnails: 4-column grid of page previews (150×200px each)
  - Bookmarks: Hierarchical tree view
  - Search: Text search input + results list
- **Controls**: Collapse/expand button, resize handle

**Main Canvas (fills remaining space):**
- White/gray background (theme-dependent)
- Centered PDF page rendering
- Zoom-responsive (scale from 10% to 500%)
- Pan mode with hand cursor
- Selection overlays for editable elements

**Right Sidebar (300-500px width, collapsible):**
- **Tabs**:
  - Comments: Thread view of all annotations
  - Layers: Hierarchical layer list with visibility toggles
  - Properties: Context-sensitive property editor
  - AI Assistant: Chat interface with message history
- **Controls**: Collapse/expand button, resize handle

**Bottom Bar (40px height):**
- **Left Section**: Page navigation (prev/next, go to page)
- **Center Section**: Page indicator (Page X of Y)
- **Right Section**: Zoom controls, fit options, status messages

**Design Specifications:**
- **Colors**:
  - Primary: #3B82F6 (blue)
  - Secondary: #8B5CF6 (purple)
  - Success: #10B981 (green)
  - Warning: #F59E0B (orange)
  - Error: #EF4444 (red)
  - Neutral: #6B7280 (gray)
  
- **Typography**:
  - Font family: Inter, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif
  - Sizes: 12px (small), 14px (body), 16px (large), 20px (heading)
  - Line height: 1.5
  
- **Spacing**:
  - Base unit: 4px
  - Common gaps: 8px, 12px, 16px, 24px, 32px
  
- **Shadows**:
  - Subtle: 0 1px 3px rgba(0,0,0,0.1)
  - Medium: 0 4px 6px rgba(0,0,0,0.1)
  - Strong: 0 10px 25px rgba(0,0,0,0.15)

**Responsive Breakpoints:**
- **Desktop** (≥1280px): Full layout with all panels
- **Tablet** (768-1279px): Collapsible sidebars, touch-optimized buttons
- **Mobile** (<768px): Simplified layout, hamburger menu, modal sidebars

#### UI-4.1.2: File Upload Interface

**Upload Screen Layout:**
```
┌─────────────────────────────────────────┐
│                                         │
│         📄 Drag & Drop Files Here       │
│                                         │
│              or click to browse         │
│                                         │
│    Supported: PDF, DOCX, Images, TXT    │
│          Max size: 100MB per file       │
│                                         │
└─────────────────────────────────────────┘
```

**Upload Progress:**
```
Uploading document.pdf
[████████████████░░░░] 80% - 4.2 MB/s
[Cancel]
```

**Elements:**
- Dashed border with pulsing animation on hover
- File type icons displayed
- Progress bar with percentage and speed
- Cancel button
- Success checkmark or error icon upon completion

#### UI-4.1.3: Authentication Screens

**Login Screen:**
```
┌───────────────────────────────┐
│       UniPDF Studio           │
│                               │
│  Email:    [____________]     │
│  Password: [____________]     │
│                               │
│  [ ] Remember me              │
│                               │
│       [Log In]                │
│                               │
│   or continue with:           │
│   [Google] [GitHub]           │
│                               │
│  Forgot password? | Sign up   │
└───────────────────────────────┘
```

**Registration Screen:**
```
┌───────────────────────────────┐
│     Create Your Account       │
│                               │
│  Name:     [____________]     │
│  Email:    [____________]     │
│  Password: [____________]     │
│           [🔒 Strong]         │
│                               │
│  [✓] I agree to Terms         │
│                               │
│       [Sign Up]               │
│                               │
│  Already have account? Log in │
└───────────────────────────────┘
```

**Elements:**
- Centered card layout (400px width)
- Input fields with validation indicators
- Password strength meter
- Social login buttons with branded colors
- Clear error messages below fields
- Link to alternate action (login/signup toggle)

#### UI-4.1.4: Modal Dialogs

**Standard Modal Template:**
```
┌─────────────────────────────────┐
│  Title                      [×] │
├─────────────────────────────────┤
│                                 │
│  Content area                   │
│  (text, forms, previews)        │
│                                 │
├─────────────────────────────────┤
│              [Cancel] [Confirm] │
└─────────────────────────────────┘
```

**Modal Types:**
- **Confirmation**: Yes/No or Cancel/Confirm actions
- **Form**: Input fields with validation and submit
- **Preview**: Large content display with navigation
- **Settings**: Tabbed interface for configuration

**Modal Behaviors:**
- Backdrop overlay (semi-transparent black, 40% opacity)
- Click outside or Escape to close (with confirmation if unsaved changes)
- Focus trap (Tab cycles through modal elements only)
- Smooth fade-in animation (200ms)

#### UI-4.1.5: Toast Notifications

**Notification Positions:**
- Top-right corner (default)
- Bottom-right corner (alternative)
- Top-center (important system messages)

**Notification Types:**
```
✓ Success: "Document saved successfully"    (Green, auto-dismiss 3s)
ℹ Info:    "Processing started..."          (Blue, auto-dismiss 5s)
⚠ Warning: "Approaching storage limit"      (Orange, persist)
✗ Error:   "Failed to upload file"          (Red, persist)
```

**Elements:**
- Icon indicating type
- Message text (max 100 characters)
- Optional action button
- Close button (×)
- Progress indicator for long operations

#### UI-4.1.6: Context Menus

**Right-Click Menu:**
```
┌─────────────────┐
│ Cut     Ctrl+X  │
│ Copy    Ctrl+C  │
│ Paste   Ctrl+V  │
├─────────────────┤
│ Delete          │
│ Duplicate       │
├─────────────────┤
│ Properties...   │
└─────────────────┘
```

**Menu Characteristics:**
- Appears at cursor position
- Maximum 12 items (scroll if more)
- Keyboard navigation (arrow keys, Enter to select)
- Dismiss on click outside or Escape
- Disabled items shown in gray

### 4.2 Hardware Interfaces

**Description:**  
UniPDF Studio is a web-based application with minimal direct hardware interaction. The following hardware interfaces are accessed through browser APIs.

#### HW-4.2.1: Input Devices

**Mouse/Trackpad:**
- **Standard Operations**:
  - Left click: Select, activate tools
  - Right click: Context menu
  - Double click: Edit mode (text, rename)
  - Click + drag: Pan canvas, resize elements, draw
  - Scroll wheel: Vertical scroll, zoom (with Ctrl modifier)
  - Middle click: Pan mode toggle

**Keyboard:**
- **Text Input**: Direct text entry into text fields and text boxes
- **Shortcuts**: Command execution (see Section 3.8.5)
- **Modifiers**: Ctrl/Cmd, Shift, Alt for enhanced actions
- **Navigation**: Arrow keys, Page Up/Down, Home/End

**Touch Screen (Tablet/Mobile):**
- **Gestures**:
  - Tap: Select, activate (equivalent to click)
  - Long press: Context menu (equivalent to right-click)
  - Drag: Pan canvas, reorder elements
  - Pinch: Zoom in/out
  - Two-finger scroll: Pan vertically/horizontally
  - Swipe: Navigate pages (left/right)

**Stylus/Digital Pen:**
- **Drawing**: Pressure sensitivity for pen tool (if supported by device)
- **Precision**: Fine-grained positioning for annotations
- **Palm Rejection**: Ignore palm contact during stylus use

#### HW-4.2.2: Display Interfaces

**Screen Requirements:**
- **Minimum Resolution**: 1280×720 pixels
- **Recommended Resolution**: 1920×1080 pixels (Full HD)
- **Optimal Resolution**: 2560×1440 pixels or higher (2K/4K)
- **Color Depth**: 24-bit color (16.7 million colors) minimum
- **Aspect Ratio**: 16:9, 16:10, or 4:3 supported

**Display Adaptations:**
- **High DPI Displays**: Retina/HiDPI support with 2x/3x scaling
- **Color Profiles**: sRGB color space (standard web)
- **Refresh Rate**: Optimized for 60Hz (animations at 60 FPS)

#### HW-4.2.3: Storage Interfaces

**Local Storage (Browser):**
- **LocalStorage API**: Store user preferences, session data (max 5-10MB)
- **IndexedDB**: Cache document thumbnails, recent files (max 50MB)
- **Temporary Storage**: Downloaded files via browser download manager

**File System Access:**
- **File Upload**: Access via `<input type="file">` HTML element
- **File Download**: Trigger via blob URLs and download attribute
- **Drag-and-Drop**: File API for dropped files

**No Direct Access:**
- Application does not directly write to disk (browser security model)
- All file operations mediated through browser APIs

#### HW-4.2.4: Network Interfaces

**Internet Connection:**
- **Required**: Active internet connection for all features
- **Minimum Bandwidth**: 5 Mbps download, 1 Mbps upload
- **Recommended Bandwidth**: 20 Mbps download, 5 Mbps upload
- **Latency**: <200ms for optimal real-time collaboration
- **Protocols**: HTTPS (TLS 1.3), WebSocket (WSS)

**Offline Mode (Future):**
- Limited functionality with cached documents
- Service Worker for offline asset caching
- Queue operations for sync when connection restored

#### HW-4.2.5: Printing Interfaces

**Printer Access:**
- **Method**: Browser print dialog (`window.print()`)
- **Supported**: Any printer available to user's operating system
- **Formats**: PDF rendering sent to printer via browser
- **Settings**: Paper size, orientation, duplex controlled through browser dialog

**No Direct Communication:**
- Application does not communicate directly with printer hardware
- All printing handled through browser print subsystem

### 4.3 Software Interfaces

**Description:**  
UniPDF Studio interfaces with various external software systems, libraries, and APIs to provide its functionality.

#### SW-4.3.1: Frontend Technologies

**Web Browser APIs:**
- **Canvas API**: For rendering PDF pages
  - Methods: `getContext('2d')`, `drawImage()`, `fillText()`
  - Purpose: Display and manipulate PDF content visually
  
- **File API**: For handling file uploads and downloads
  - Interfaces: `File`, `FileReader`, `Blob`, `FileList`
  - Purpose: Read uploaded files, create downloadable files
  
- **Web Storage API**: For client-side data persistence
  - LocalStorage: User preferences, recent files list
  - SessionStorage: Temporary session data
  - IndexedDB: Document cache, thumbnails
  
- **Fetch API / XMLHttpRequest**: For server communication
  - Methods: GET, POST, PUT, DELETE
  - Headers: Authorization, Content-Type, Accept
  
- **WebSocket API**: For real-time collaboration
  - Events: `onopen`, `onmessage`, `onerror`, `onclose`
  - Purpose: Bidirectional communication for live updates

**React Framework (v18+):**
- **Version**: 18.2.0 or higher
- **Purpose**: Frontend UI component library
- **Key Features Used**:
  - Hooks: useState, useEffect, useContext, useRef
  - Context API: Global state management
  - Suspense: Lazy loading components
  - Error Boundaries: Graceful error handling

**TailwindCSS (v3+):**
- **Version**: 3.3.0 or higher
- **Purpose**: Utility-first CSS framework for styling
- **Custom Configuration**: Extended theme for UniPDF brand colors
- **Plugins**: Forms, typography, aspect-ratio

**PDF.js (Mozilla):**
- **Version**: 3.11.0 or higher
- **Purpose**: PDF rendering in browser canvas
- **API Used**:
  - `getDocument()`: Load PDF from URL or buffer
  - `getPage()`: Retrieve individual page
  - `render()`: Render page to canvas
  - Text extraction: `getTextContent()`

**Fabric.js:**
- **Version**: 5.3.0 or higher
- **Purpose**: Canvas manipulation for drawing and annotations
- **Features Used**:
  - Object manipulation (move, resize, rotate)
  - Freehand drawing
  - Shape creation
  - Layer management

#### SW-4.3.2: Backend Technologies

**Node.js Runtime:**
- **Version**: 18 LTS or higher
- **Purpose**: Server-side JavaScript execution environment
- **Modules**: fs, path, crypto, stream

**Express.js Framework:**
- **Version**: 4.18.0 or higher
- **Purpose**: Web application framework for REST API
- **Middleware Used**:
  - `express.json()`: JSON body parsing
  - `cors()`: Cross-origin resource sharing
  - `helmet()`: Security headers
  - `compression()`: Response compression
  - `express-rate-limit()`: Rate limiting

**PDF Manipulation Libraries:**

**pdf-lib:**
- **Version**: 1.17.0 or higher
- **Purpose**: Create and modify PDFs in JavaScript
- **Operations**:
  - Merge/split PDFs
  - Add pages, remove pages
  - Embed images and fonts
  - Modify metadata
  - Form field manipulation

**PDFKit:**
- **Version**: 0.13.0 or higher
- **Purpose**: Generate PDFs from scratch
- **Use Cases**:
  - Create PDFs from HTML/text
  - Add watermarks and page numbers
  - Generate reports and exports

**HummusJS (Optional):**
- **Version**: Latest
- **Purpose**: High-performance PDF manipulation
- **Use Cases**: Large file processing, compression

#### SW-4.3.3: Database Interfaces

**MongoDB:**
- **Version**: 6.0 or higher
- **Driver**: mongodb npm package v5.0+
- **Connection**: MongoDB Atlas (cloud) or self-hosted
- **Connection String**: `mongodb+srv://[username]:[password]@[cluster].mongodb.net/[dbname]`
- **Collections**:
  - `users`: User account information
  - `documents`: Document metadata and cloud storage references
  - `sessions`: Active user sessions
  - `comments`: Document annotations and comments
  - `versions`: Document version history

**Database Operations:**
- **CRUD Operations**: Create, Read, Update, Delete via MongoDB driver
- **Indexing**: Compound indexes on frequently queried fields
- **Aggregation**: Complex queries using aggregation pipeline
- **Transactions**: Multi-document ACID transactions for critical operations

**Alternative: Firebase Firestore:**
- **Version**: Firebase SDK v9+
- **Purpose**: NoSQL cloud database (alternative to MongoDB)
- **API**: Firestore JavaScript SDK
- **Operations**: Collection queries, real-time listeners, batch writes

#### SW-4.3.4: Third-Party API Integrations

**Firebase Services:**
- **Firebase Authentication**:
  - Version: Firebase JS SDK v9.15+
  - Purpose: User authentication and session management
  - Methods: Email/password, Google OAuth, GitHub OAuth
  - API Endpoints:
    - `createUserWithEmailAndPassword()`
    - `signInWithEmailAndPassword()`
    - `signInWithPopup()` for OAuth
    - `signOut()`
  
- **Firebase Cloud Storage**:
  - Purpose: Store user-uploaded PDF files
  - API Methods:
    - `ref()`: Create storage reference
    - `uploadBytes()`: Upload file
    - `getDownloadURL()`: Get file URL
    - `deleteObject()`: Remove file
  - Storage Rules: User can only access their own files

**OpenAI API:**
- **Version**: v1 API (GPT-4, GPT-3.5-turbo)
- **Purpose**: AI-powered text processing
- **Endpoint**: `https://api.openai.com/v1/chat/completions`
- **Authentication**: Bearer token (API key)
- **Request Format**:
  ```json
  {
    "model": "gpt-4",
    "messages": [{"role": "user", "content": "..."}],
    "temperature": 0.7,
    "max_tokens": 1000
  }
  ```
- **Response Format**: JSON with generated text
- **Rate Limits**: 3 requests/minute (free tier), 60 requests/minute (paid)
- **Use Cases**: Summarization, chat, text rewriting

**Tesseract.js (Client-Side OCR):**
- **Version**: 4.0.0 or higher
- **Purpose**: Optical Character Recognition in browser
- **API**:
  - `createWorker()`: Initialize OCR worker
  - `worker.recognize(image)`: Extract text from image
  - `worker.terminate()`: Clean up worker
- **Languages**: Load language data files for multi-language support
- **Output**: Text with confidence scores and bounding boxes

**Google Cloud Vision API (Server-Side OCR):**
- **Version**: v1
- **Purpose**: High-accuracy OCR for premium users
- **Endpoint**: `https://vision.googleapis.com/v1/images:annotate`
- **Authentication**: Google Cloud service account key
- **Request**: Base64-encoded image, feature type (TEXT_DETECTION)
- **Response**: Detected text with confidence and geometry
- **Pricing**: Pay-per-use (first 1000 requests/month free)

**Google Drive API:**
- **Version**: v3
- **Purpose**: Integration with user's Google Drive
- **Authentication**: OAuth 2.0 with Google
- **Scopes**: `drive.file` (access to created/opened files)
- **API Endpoints**:
  - `files.list`: Browse files
  - `files.get`: Download file
  - `files.create`: Upload file
  - `files.update`: Modify file
- **Client Library**: Google APIs Client Library for JavaScript

**SendGrid Email API:**
- **Version**: v3 API
- **Purpose**: Transactional email sending
- **Endpoint**: `https://api.sendgrid.com/v3/mail/send`
- **Authentication**: API key in Authorization header
- **Use Cases**: Email verification, password reset, document sharing notifications
- **Features**: Templates, attachment support, tracking

#### SW-4.3.5: Development and Build Tools

**Package Manager:**
- **npm** (Node Package Manager) v9+ or **yarn** v1.22+
- Purpose: Dependency management

**Build Tools:**
- **Vite** (v4+) or **Webpack** (v5+): Frontend bundling
- **Babel**: JavaScript transpilation for older browsers
- **PostCSS**: CSS processing for TailwindCSS

**Testing Frameworks:**
- **Jest**: Unit testing for JavaScript
- **React Testing Library**: Component testing
- **Cypress**: End-to-end testing
- **Supertest**: API endpoint testing

**Code Quality:**
- **ESLint**: JavaScript linting
- **Prettier**: Code formatting
- **TypeScript**: Optional static typing (if using TypeScript variant)

**Version Control:**
- **Git**: Source code management
- **GitHub**: Repository hosting, CI/CD (GitHub Actions)

### 4.4 Communication Interfaces

**Description:**  
Defines the network protocols, data formats, and communication patterns used by UniPDF Studio.

#### COM-4.4.1: HTTP/HTTPS Protocol

**Primary Protocol:**
- **HTTPS (HyperText Transfer Protocol Secure)**
- **Version**: HTTP/1.1 and HTTP/2 supported
- **Port**: 443 (standard HTTPS)
- **Encryption**: TLS 1.3 (minimum TLS 1.2 supported)
- **Certificate**: Valid SSL/TLS certificate from trusted CA (Let's Encrypt, DigiCert, etc.)

**HTTP Methods Used:**
- **GET**: Retrieve resources (documents, metadata, user data)
- **POST**: Create resources (upload files, create accounts, submit forms)
- **PUT**: Update resources (edit documents, update user profile)
- **PATCH**: Partial updates (modify specific fields)
- **DELETE**: Remove resources (delete files, remove annotations)
- **OPTIONS**: CORS preflight requests

**Request Headers:**
```
Authorization: Bearer <jwt-token>
Content-Type: application/json | multipart/form-data
Accept: application/json
X-API-Key: <optional-api-key>
X-Request-ID: <unique-request-identifier>
```

**Response Headers:**
```
Content-Type: application/json | application/pdf
Cache-Control: no-cache | max-age=3600
ETag: <resource-version-identifier>
X-RateLimit-Limit: 100
X-RateLimit-Remaining: 95
X-RateLimit-Reset: 1698765432
```

**Status Codes:**
- **200 OK**: Successful request
- **201 Created**: Resource created successfully
- **204 No Content**: Successful request with no response body
- **400 Bad Request**: Invalid request parameters
- **401 Unauthorized**: Authentication required or failed
- **403 Forbidden**: Insufficient permissions
- **404 Not Found**: Resource does not exist
- **409 Conflict**: Resource conflict (e.g., file already exists)
- **413 Payload Too Large**: File size exceeds limit
- **429 Too Many Requests**: Rate limit exceeded
- **500 Internal Server Error**: Server-side error
- **503 Service Unavailable**: Server temporarily unavailable

#### COM-4.4.2: WebSocket Protocol

**Real-Time Communication:**
- **Protocol**: WSS (WebSocket Secure over TLS)
- **Endpoint**: `wss://api.unipdfstudio.com/ws`
- **Port**: 443 (same as HTTPS)
- **Purpose**: Real-time collaboration, live updates, notifications

**Connection Lifecycle:**
```javascript
// Connect
const socket = new WebSocket('wss://api.unipdfstudio.com/ws?token=<jwt>')

// Authentication
socket.send(JSON.stringify({
  type: 'auth',
  token: '<jwt-token>'
}))

// Send message
socket.send(JSON.stringify({
  type: 'edit',
  documentId: '12345',
  changes: { ... }
}))

// Receive message
socket.onmessage = (event) => {
  const data = JSON.parse(event.data)
  // Handle different message types
}

// Disconnect
socket.close()
```

**Message Types:**
- **auth**: Authentication handshake
- **join**: Join document session
- **leave**: Leave document session
- **edit**: Document edit notification
- **cursor**: User cursor position update
- **comment**: New comment added
- **presence**: User presence update (online/offline)
- **notification**: System notification
- **error**: Error message

**Message Format:**
```json
{
  "type": "edit",
  "timestamp": 1698765432000,
  "userId": "user-123",
  "documentId": "doc-456",
  "payload": {
    "action": "text-insert",
    "position": { "page": 1, "x": 100, "y": 200 },
    "content": "New text"
  }
}
```

**Connection Management:**
- **Heartbeat**: Ping/pong every 30 seconds to keep connection alive
- **Reconnection**: Automatic reconnect with exponential backoff
- **Timeout**: Close connection after 5 minutes of inactivity

#### COM-4.4.3: RESTful API Endpoints

**Base URL:** `https://api.unipdfstudio.com/v1`

**Authentication Endpoints:**
```
POST   /auth/register          - Create new user account
POST   /auth/login             - Login with credentials
POST   /auth/logout            - Logout current session
POST   /auth/refresh           - Refresh JWT token
POST   /auth/forgot-password   - Request password reset
POST   /auth/reset-password    - Reset password with token
GET    /auth/verify-email      - Verify email address
```

**User Endpoints:**
```
GET    /users/me               - Get current user profile
PUT    /users/me               - Update user profile
DELETE /users/me               - Delete user account
GET    /users/me/storage       - Get storage usage stats
```

**Document Endpoints:**
```
GET    /documents              - List user's documents
POST   /documents              - Upload new document
GET    /documents/:id          - Get document details
PUT    /documents/:id          - Update document
DELETE /documents/:id          - Delete document
GET    /documents/:id/download - Download document file
POST   /documents/:id/share    - Create shareable link
POST   /documents/merge        - Merge multiple documents
POST   /documents/:id/split    - Split document
```

**Document Operations:**
```
POST   /documents/:id/compress   - Compress document
POST   /documents/:id/encrypt    - Encrypt document
POST   /documents/:id/watermark  - Add watermark
POST   /documents/:id/ocr        - Run OCR processing
POST   /documents/:id/convert    - Convert to different format
```

**AI Endpoints:**
```
POST   /ai/summarize           - Summarize document
POST   /ai/chat                - Chat with document
POST   /ai/rewrite             - Rewrite text section
POST   /ai/extract             - Extract structured content
```

**Collaboration Endpoints:**
```
GET    /documents/:id/comments      - Get all comments
POST   /documents/:id/comments      - Add new comment
PUT    /comments/:id                - Update comment
DELETE /comments/:id                - Delete comment
GET    /documents/:id/versions      - Get version history
POST   /documents/:id/versions      - Create version snapshot
POST   /documents/:id/restore/:vid  - Restore previous version
```

**Sharing Endpoints:**
```
POST   /share/create           - Create share link
GET    /share/:token           - Access shared document
DELETE /share/:token           - Revoke share link
GET    /share/:token/analytics - Get share analytics
```

#### COM-4.4.4: Data Formats

**JSON (Primary Format):**
```json
{
  "status": "success",
  "data": {
    "id": "doc-123",
    "title": "My Document",
    "pages": 10,
    "size": 1024000,
    "createdAt": "2025-11-02T12:00:00Z"
  },
  "meta": {
    "timestamp": 1698765432000,
    "version": "1.0"
  }
}
```

**Error Response Format:**
```json
{
  "status": "error",
  "error": {
    "code": "INVALID_FILE_TYPE",
    "message": "Unsupported file format. Please upload PDF, DOCX, or image files.",
    "details": {
      "field": "file",
      "providedType": "application/zip"
    }
  }
}
```

**Multipart Form Data (File Uploads):**
```
Content-Type: multipart/form-data; boundary=----WebKitFormBoundary...

------WebKitFormBoundary...
Content-Disposition: form-data; name="file"; filename="document.pdf"
Content-Type: application/pdf

[Binary PDF data]
------WebKitFormBoundary...
Content-Disposition: form-data; name="metadata"

{"title":"My Document","tags":["work","important"]}
------WebKitFormBoundary...--
```

**Binary Data (File Downloads):**
- Content-Type: application/pdf, image/png, application/octet-stream
- Content-Disposition: attachment; filename="document.pdf"
- Transfer encoding: chunked (for large files)

#### COM-4.4.5: Security Protocols

**Authentication:**
- **JWT (JSON Web Tokens)**: Stateless authentication
- **Token Format**: `Bearer <jwt-token>` in Authorization header
- **Token Expiry**: 1 hour (access token), 30 days (refresh token)
- **Token Refresh**: Automatic refresh before expiry

**Encryption:**
- **In Transit**: TLS 1.3 encryption for all network communication
- **At Rest**: AES-256 encryption for stored files (server-side)
- **Password Hashing**: bcrypt with salt rounds ≥12

**API Rate Limiting:**
- **Free Tier**: 100 requests per hour per user
- **Premium Tier**: 1000 requests per hour per user
- **Burst Limit**: 20 requests per minute
- **Rate Limit Headers**: X-RateLimit-* headers in responses

**CORS (Cross-Origin Resource Sharing):**
- **Allowed Origins**: https://unipdfstudio.com, https://*.unipdfstudio.com
- **Allowed Methods**: GET, POST, PUT, DELETE, OPTIONS
- **Allowed Headers**: Authorization, Content-Type, X-API-Key
- **Credentials**: Include credentials (cookies, auth headers)

**Content Security Policy (CSP):**
```
Content-Security-Policy: 
  default-src 'self'; 
  script-src 'self' 'unsafe-inline' https://cdn.unipdfstudio.com; 
  style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; 
  img-src 'self' data: https:; 
  connect-src 'self' https://api.unipdfstudio.com wss://api.unipdfstudio.com;
  font-src 'self' https://fonts.gstatic.com;
```

#### COM-4.4.6: Data Transfer Optimization

**Compression:**
- **Gzip**: Enable for text-based responses (JSON, HTML, CSS, JS)
- **Brotli**: Preferred compression for supported clients
- **Compression Ratio**: Target 70-80% size reduction

**Caching:**
- **Static Assets**: Cache for 1 year with versioned filenames
- **API Responses**: Cache-Control headers for cacheable data
- **CDN**: CloudFlare or AWS CloudFront for global distribution
- **Browser Cache**: LocalStorage for frequently accessed data

**Chunked Uploads:**
- **Large Files**: Split into 5MB chunks for upload
- **Resumable Uploads**: Support pause/resume for interrupted uploads
- **Progress Tracking**: Report progress for each chunk

**Lazy Loading:**
- **Images**: Load thumbnails on demand (viewport-based)
- **Pages**: Render PDF pages as user scrolls
- **Comments**: Fetch comments when sidebar opened

**WebP Images:**
- **Thumbnails**: Convert to WebP format (60% smaller than JPEG)
- **Fallback**: Serve JPEG for browsers without WebP support

---

## 5. Non-Functional Requirements

### 5.1 Performance Requirements

**Description:**  
Defines the speed, responsiveness, throughput, and resource utilization requirements for UniPDF Studio.

#### PERF-5.1.1: Response Time Requirements

**Page Load Performance:**
- **Initial Page Load**: ≤3 seconds on 20 Mbps connection
  - First Contentful Paint (FCP): ≤1.5 seconds
  - Largest Contentful Paint (LCP): ≤2.5 seconds
  - Time to Interactive (TTI): ≤3 seconds
  
- **Subsequent Navigation**: ≤500ms for page transitions
- **Document Opening**: ≤2 seconds for documents up to 10MB
- **Tool Activation**: ≤100ms for any toolbar button click

**User Interaction Responsiveness:**
- **Text Editing**: Keystroke response ≤50ms (no lag)
- **Canvas Pan/Zoom**: 60 FPS (16.67ms per frame)
- **Drawing Tools**: 60 FPS smooth rendering
- **Undo/Redo**: ≤100ms execution time
- **Thumbnail Generation**: ≤2 seconds for 50-page document

**Backend API Response Times:**
- **Simple Queries** (get user data, list files): ≤200ms
- **Document Upload** (10MB file): ≤5 seconds
- **Document Processing** (merge, split): ≤10 seconds for 100 pages
- **OCR Processing**: 2-5 seconds per page
- **AI Operations**: 5-30 seconds depending on complexity

**Real-Time Collaboration:**
- **Change Propagation**: ≤500ms from user A to user B
- **Cursor Updates**: ≤100ms latency
- **WebSocket Connection**: Establish within 1 second

#### PERF-5.1.2: Throughput Requirements

**Concurrent Users:**
- **System Capacity**: Support 10,000 concurrent active users
- **Per-Server Capacity**: 500 concurrent users per application server instance
- **Database Connections**: Pool of 100 connections per database server

**File Processing:**
- **Upload Throughput**: Handle 100 file uploads simultaneously
- **Download Throughput**: Serve 500 concurrent downloads
- **OCR Queue**: Process 50 pages per minute (with 5 parallel workers)
- **AI Request Queue**: Handle 100 requests per minute across all users

**API Rate Limits:**
- **Authenticated Users**: 100 requests per hour per user (free tier)
- **Premium Users**: 1,000 requests per hour
- **Burst Allowance**: 20 requests per minute
- **Anonymous Users**: 10 requests per hour per IP address

#### PERF-5.1.3: Resource Utilization

**Client-Side (Browser):**
- **Memory Usage**: ≤500MB for typical document (50 pages, 20MB)
- **CPU Usage**: ≤30% on average, ≤80% during intensive operations
- **Storage (LocalStorage)**: ≤100MB for cached data
- **Network Bandwidth**: ≤50MB for initial app load (cached assets)

**Server-Side:**
- **CPU Utilization**: Target 60% average, max 85% sustained
- **Memory Usage**: ≤4GB per application server instance
- **Disk I/O**: ≤100 MB/s per server for file operations
- **Database Query Time**: ≤50ms for 95% of queries

**Scalability Metrics:**
- **Horizontal Scaling**: Add servers to handle 2x load within 5 minutes
- **Auto-Scaling**: Trigger at 75% CPU or memory utilization
- **Load Balancing**: Distribute requests evenly across servers
- **Database Scaling**: Read replicas for query distribution

#### PERF-5.1.4: File Size and Limits

**Upload Limits:**
- **Single File**: 100MB maximum
- **Batch Upload**: 50 files or 500MB total, whichever is lower
- **Concurrent Uploads**: 5 files uploading simultaneously per user

**Processing Limits:**
- **PDF Pages**: Support documents up to 1,000 pages
- **Image Resolution**: Up to 4096×4096 pixels per page
- **Merge Operation**: Combine up to 50 PDFs or 5,000 total pages
- **OCR Input**: Images up to 10,000×10,000 pixels

**Storage Quotas:**
- **Free Tier**: 5GB total storage per user
- **Basic Tier**: 50GB storage
- **Premium Tier**: 100GB storage
- **File Retention**: 30 days for unauthenticated uploads

#### PERF-5.1.5: Network Performance

**Bandwidth Optimization:**
- **Asset Compression**: Reduce static assets by 70% (gzip/brotli)
- **Image Optimization**: Use WebP format (60% smaller than JPEG)
- **CDN Usage**: Serve 95% of static content from CDN
- **Lazy Loading**: Load resources on demand (reduce initial payload by 50%)

**Latency Requirements:**
- **Server Response Time**: ≤200ms for API calls (excluding processing)
- **CDN Latency**: ≤50ms for cached assets
- **Database Query Latency**: ≤30ms for indexed queries
- **WebSocket Latency**: ≤100ms for real-time updates

**Data Transfer:**
- **Upload Speed**: Support up to 10 MB/s (on 100 Mbps connection)
- **Download Speed**: Serve files at 20 MB/s per user
- **Chunked Uploads**: 5MB chunks for resumable uploads
- **Progressive Download**: Stream large PDFs (don't wait for full download)

### 5.2 Security Requirements

**Description:**  
Defines security measures to protect user data, prevent unauthorized access, and ensure system integrity.

#### SEC-5.2.1: Authentication Security

**Password Requirements:**
- **Minimum Length**: 8 characters
- **Complexity**: 
  - At least 1 uppercase letter
  - At least 1 lowercase letter
  - At least 1 number
  - At least 1 special character (!@#$%^&*)
- **Password Strength Meter**: Real-time feedback (weak/medium/strong)
- **Common Password Check**: Reject passwords from common password lists
- **Password History**: Prevent reuse of last 5 passwords

**Password Storage:**
- **Hashing Algorithm**: bcrypt with minimum 12 salt rounds
- **No Plain Text**: Never store passwords in plain text
- **Secure Comparison**: Use timing-safe comparison to prevent timing attacks

**Multi-Factor Authentication (MFA):**
- **Optional 2FA**: Time-based one-time passwords (TOTP) via authenticator apps
- **Backup Codes**: Generate 10 single-use recovery codes
- **Trusted Devices**: Option to trust devices for 30 days

**Session Management:**
- **JWT Tokens**: Signed with HS256 or RS256 algorithm
- **Access Token Expiry**: 1 hour
- **Refresh Token Expiry**: 30 days
- **Token Revocation**: Invalidate all tokens on password change
- **Session Limit**: Maximum 5 active sessions per user

**Account Lockout:**
- **Failed Login Attempts**: Lock account after 5 consecutive failures
- **Lockout Duration**: 15 minutes (or until password reset)
- **CAPTCHA**: Require CAPTCHA after 3 failed attempts
- **Notification**: Email user about account lockout

#### SEC-5.2.2: Authorization and Access Control

**Role-Based Access Control (RBAC):**
- **User Roles**:
  - Free User: Basic features, 5GB storage
  - Premium User: Advanced features, 100GB storage
  - Admin: System administration privileges
  
**Document Permissions:**
- **Owner**: Full control (read, write, delete, share)
- **Editor**: Read and modify content, add comments
- **Commenter**: Read and add comments only
- **Viewer**: Read-only access, can download

**Permission Enforcement:**
- **Server-Side Validation**: All permissions checked on backend
- **Least Privilege Principle**: Users only get minimum required permissions
- **Permission Inheritance**: Shared documents inherit permissions from owner
- **Audit Trail**: Log all permission changes

**API Security:**
- **Token Validation**: Verify JWT signature and expiry on every request
- **Scope-Based Access**: Tokens contain specific scopes (read:documents, write:documents)
- **API Key Rotation**: Require API key refresh every 90 days (for integrations)

#### SEC-5.2.3: Data Encryption

**Encryption in Transit:**
- **TLS Version**: TLS 1.3 (minimum TLS 1.2)
- **Cipher Suites**: Strong ciphers only (AES-256-GCM, ChaCha20-Poly1305)
- **Certificate**: Valid SSL certificate from trusted CA
- **HSTS**: HTTP Strict Transport Security enabled (max-age=31536000)
- **Perfect Forward Secrecy**: Ephemeral key exchange (ECDHE)

**Encryption at Rest:**
- **File Encryption**: AES-256 encryption for stored files
- **Database Encryption**: Encrypt sensitive fields (passwords, tokens, personal data)
- **Key Management**: Use AWS KMS, Google Cloud KMS, or similar for key storage
- **Encryption Key Rotation**: Rotate keys annually

**End-to-End Encryption (Future):**
- **Client-Side Encryption**: Encrypt files before upload (user-controlled keys)
- **Zero-Knowledge**: Server cannot decrypt user files
- **Key Management**: User-managed encryption keys

#### SEC-5.2.4: Input Validation and Sanitization

**File Upload Security:**
- **File Type Validation**: 
  - Check MIME type and file extension
  - Verify file headers (magic bytes)
  - Reject executable files (.exe, .sh, .bat)
  
- **Virus Scanning**: Scan uploads with ClamAV or similar (optional)
- **File Size Limits**: Enforce maximum file size (100MB)
- **Content Inspection**: Parse PDF/DOCX to detect embedded malware

**Input Sanitization:**
- **XSS Prevention**: 
  - Sanitize all user input before display
  - Use React's built-in XSS protection (JSX auto-escaping)
  - Content Security Policy (CSP) headers
  
- **SQL Injection Prevention**:
  - Use parameterized queries (prepared statements)
  - Never concatenate user input into queries
  - ORM/ODM with built-in protection (Mongoose for MongoDB)
  
- **Command Injection Prevention**:
  - Avoid executing shell commands with user input
  - Use libraries instead of system calls where possible
  - Whitelist allowed values for system operations

**Filename Sanitization:**
- Remove special characters (null bytes, path traversal attempts)
- Limit filename length (255 characters)
- Prevent directory traversal (../, ..\, etc.)

#### SEC-5.2.5: Security Headers

**HTTP Security Headers:**
```
Strict-Transport-Security: max-age=31536000; includeSubDomains; preload
X-Content-Type-Options: nosniff
X-Frame-Options: DENY
X-XSS-Protection: 1; mode=block
Referrer-Policy: strict-origin-when-cross-origin
Permissions-Policy: geolocation=(), microphone=(), camera=()
Content-Security-Policy: default-src 'self'; script-src 'self' 'unsafe-inline'; ...
```

**Cookie Security:**
- **Flags**: HttpOnly, Secure, SameSite=Strict
- **No Sensitive Data**: Never store sensitive data in cookies
- **Session Cookies**: Expire on browser close

#### SEC-5.2.6: Third-Party Security

**API Key Management:**
- **Environment Variables**: Store API keys in .env files (never in code)
- **Secret Management**: Use AWS Secrets Manager, HashiCorp Vault, or similar
- **Key Rotation**: Rotate third-party API keys every 90 days
- **Access Logging**: Log all third-party API calls

**OAuth Security:**
- **PKCE**: Use Proof Key for Code Exchange for OAuth flows
- **State Parameter**: Prevent CSRF attacks in OAuth callbacks
- **Token Storage**: Store OAuth tokens securely (encrypted in database)
- **Scope Limitation**: Request minimum required scopes

**Dependency Security:**
- **Vulnerability Scanning**: Use npm audit, Snyk, or Dependabot
- **Regular Updates**: Update dependencies monthly
- **Lock Files**: Use package-lock.json or yarn.lock
- **Security Advisories**: Monitor GitHub security advisories

#### SEC-5.2.7: Logging and Monitoring

**Security Logging:**
- **Failed Login Attempts**: Log IP, timestamp, username
- **Permission Denials**: Log unauthorized access attempts
- **File Access**: Log who accessed which files and when
- **API Calls**: Log all API requests (sanitize sensitive data)

**Intrusion Detection:**
- **Rate Limiting**: Detect and block brute-force attacks
- **Anomaly Detection**: Alert on unusual patterns (sudden spike in requests)
- **IP Blocking**: Temporarily block IPs with suspicious activity
- **SIEM Integration**: Send logs to Security Information and Event Management system

**Audit Trail:**
- **User Actions**: Track document edits, deletions, sharing
- **Admin Actions**: Log all administrative operations
- **Retention**: Keep logs for 90 days (longer for compliance)
- **Tamper-Proof**: Store logs in append-only storage

### 5.3 Privacy Requirements

**Description:**  
Ensures user privacy and compliance with data protection regulations.

#### PRIV-5.3.1: Data Collection

**Minimal Data Collection:**
- **Required Data**: Email, name, password (hashed)
- **Optional Data**: Profile picture, organization name
- **Usage Data**: Anonymous analytics (page views, feature usage)
- **No Tracking**: No third-party tracking scripts (Google Analytics optional with consent)

**User Consent:**
- **Cookie Consent**: Banner for cookie usage (EU Cookie Law)
- **Privacy Policy**: Clear, accessible privacy policy
- **Terms of Service**: User must agree before account creation
- **Email Preferences**: Opt-in for marketing emails (transactional emails always sent)

**Data Minimization:**
- Only collect data necessary for service functionality
- Delete unnecessary data after processing (e.g., temporary files)
- Anonymous analytics (no personally identifiable information)

#### PRIV-5.3.2: GDPR Compliance

**Right to Access:**
- **Data Export**: Users can download all their data (JSON format)
- **Data Transparency**: Show users what data is stored about them
- **Access Time**: Provide data export within 30 days of request

**Right to Rectification:**
- **Profile Editing**: Users can update their personal information
- **Data Correction**: Mechanism to report and correct inaccurate data

**Right to Erasure (Right to be Forgotten):**
- **Account Deletion**: Users can delete their account
- **Data Removal**: Delete all user data within 30 days of account deletion
- **Backup Retention**: Explain backup retention policy (backups deleted after 90 days)
- **Third-Party Notification**: Inform third parties if data was shared

**Right to Data Portability:**
- **Export Format**: JSON, CSV, or PDF for user data
- **Machine-Readable**: Data in structured, commonly used format
- **Include All Data**: Documents, metadata, comments, annotations

**Right to Object:**
- **Marketing Opt-Out**: Easy unsubscribe from marketing emails
- **Analytics Opt-Out**: Option to disable analytics tracking
- **Processing Objection**: Allow users to object to specific data processing

**Data Protection Officer (DPO):**
- Designate DPO for GDPR compliance (if processing large amounts of EU data)
- Contact information provided in privacy policy

#### PRIV-5.3.3: CCPA Compliance (California Consumer Privacy Act)

**Disclosure Requirements:**
- **Privacy Notice**: Explain what data is collected and why
- **Data Sharing**: Disclose if data is sold or shared (UniPDF does NOT sell data)
- **Categories of Data**: List categories of personal information collected

**Consumer Rights:**
- **Right to Know**: Users can request what data is collected
- **Right to Delete**: Users can request deletion of their data
- **Right to Opt-Out**: Opt-out of data sale (N/A if no data selling)
- **Non-Discrimination**: No discrimination for exercising privacy rights

**Verification:**
- Verify user identity before providing data or deleting account
- Two-step verification process for sensitive requests

#### PRIV-5.3.4: HIPAA Compliance (for healthcare documents - optional)

**Note**: HIPAA compliance required only if targeting healthcare organizations

**Protected Health Information (PHI):**
- Encrypt PHI at rest and in transit
- Access controls for PHI documents
- Audit logs for PHI access

**Business Associate Agreement (BAA):**
- Sign BAA with healthcare clients
- Ensure subcontractors (cloud providers) are HIPAA-compliant

#### PRIV-5.3.5: Data Retention and Deletion

**Retention Periods:**
- **Active Accounts**: Retain data indefinitely while account is active
- **Inactive Accounts**: Notify after 2 years of inactivity, delete after 3 years
- **Deleted Accounts**: Remove data within 30 days
- **Backups**: Retain backups for 90 days (for disaster recovery)
- **Logs**: Retain logs for 90 days (longer for compliance)

**Automated Deletion:**
- **Temporary Files**: Delete unauthenticated uploads after 24 hours
- **Session Data**: Clear session data after 30 days of inactivity
- **Expired Links**: Delete expired share links and associated analytics
- **Trash/Recycle Bin**: Permanently delete files 30 days after moving to trash

**Secure Deletion:**
- Overwrite deleted files (not just mark as deleted)
- Use secure deletion methods for sensitive data
- Delete from all backups and replicas

### 5.4 Reliability Requirements

**Description:**  
Ensures the system is dependable, fault-tolerant, and recovers gracefully from failures.

#### REL-5.4.1: System Uptime

**Availability Target:**
- **SLA**: 99.9% uptime (43.8 minutes downtime per month)
- **Maintenance Windows**: Scheduled during low-traffic hours (2-4 AM UTC)
- **Notification**: 7-day advance notice for planned maintenance
- **Status Page**: Public status page showing real-time system health

**Uptime Measurement:**
- **Monitoring Tools**: UptimeRobot, Pingdom, or custom monitoring
- **Health Checks**: Automated health checks every 1 minute
- **Alerting**: Alert on-call engineers within 1 minute of downtime

#### REL-5.4.2: Fault Tolerance

**Redundancy:**
- **Server Redundancy**: Minimum 2 application servers (active-active)
- **Database Redundancy**: Primary + 2 replicas (master-slave replication)
- **Load Balancer**: Redundant load balancers with failover
- **CDN**: Global CDN with automatic failover to alternate POPs

**Graceful Degradation:**
- **AI Service Failure**: Disable AI features, core functionality remains
- **OCR Service Failure**: Queue requests for retry, notify user
- **Storage Service Failure**: Read-only mode until restored
- **Database Failure**: Failover to replica within 30 seconds

**Circuit Breaker Pattern:**
- Detect repeated failures to third-party services
- Temporarily disable failing service to prevent cascading failures
- Retry with exponential backoff
- Automatically re-enable when service recovers

#### REL-5.4.3: Data Integrity

**Data Validation:**
- **Input Validation**: Validate all user input before processing
- **Checksums**: Verify file integrity using MD5/SHA-256 checksums
- **Version Control**: Track changes with version history
- **Atomic Operations**: Database transactions for multi-step operations

**Backup Strategy:**
- **Frequency**: Daily full backups, hourly incremental backups
- **Retention**: Keep daily backups for 30 days, weekly for 90 days
- **Geo-Redundancy**: Store backups in multiple geographic regions
- **Backup Testing**: Test restore process monthly

**Data Consistency:**
- **ACID Compliance**: Use transactions for critical operations
- **Eventual Consistency**: Acceptable for non-critical data (analytics)
- **Conflict Resolution**: Last-write-wins for concurrent edits (with version history)

#### REL-5.4.4: Error Handling

**User-Facing Errors:**
- **Clear Messages**: Non-technical error messages for users
- **Actionable Guidance**: Suggest corrective actions
- **Error Codes**: Unique error codes for support troubleshooting
- **No Sensitive Data**: Never expose stack traces or internal details to users

**System Errors:**
- **Logging**: Log all errors with context (stack trace, request ID, user ID)
- **Error Tracking**: Use Sentry, Rollbar, or similar for error aggregation
- **Alerting**: Alert on critical errors (email, Slack, PagerDuty)
- **Error Rate Threshold**: Alert if error rate exceeds 1% of requests

**Recovery Mechanisms:**
- **Retry Logic**: Automatic retry for transient failures (network, timeout)
- **Exponential Backoff**: Increase wait time between retries (1s, 2s, 4s, 8s...)
- **Max Retries**: Limit to 5 retry attempts
- **Fallback**: Provide alternative functionality when primary fails

#### REL-5.4.5: Disaster Recovery

**Disaster Recovery Plan (DRP):**
- **Recovery Time Objective (RTO)**: 4 hours (maximum downtime)
- **Recovery Point Objective (RPO)**: 1 hour (maximum data loss)
- **Disaster Scenarios**: Server failure, database corruption, datacenter outage, cyberattack

**Backup and Restore:**
- **Database Restore**: Test restore procedures quarterly
- **File Storage Restore**: Restore from backup within 2 hours
- **Configuration Backup**: Version-controlled infrastructure as code

**Business Continuity:**
- **Failover Region**: Secondary region for disaster recovery
- **Data Replication**: Real-time replication to secondary region
- **Runbooks**: Documented procedures for common failure scenarios
- **Incident Response Team**: Designated team with 24/7 on-call rotation

### 5.5 Availability Requirements

**Description:**  
Ensures the system is accessible to users when needed.

#### AVAIL-5.5.1: Service Availability

**Target Availability:**
- **Production**: 99.9% uptime (8.76 hours downtime per year)
- **Development/Staging**: 95% uptime (acceptable for testing)

**Monitoring:**
- **Synthetic Monitoring**: Simulate user interactions every 5 minutes
- **Real User Monitoring (RUM)**: Track actual user experience
- **Geographic Monitoring**: Check availability from multiple locations

**Alerting Thresholds:**
- **Critical Alert**: Service down (0% availability)
- **Warning Alert**: Degraded performance (response time >5 seconds)
- **Info Alert**: Non-critical service degradation

#### AVAIL-5.5.2: Planned Maintenance

**Maintenance Schedule:**
- **Frequency**: Monthly maintenance window (if needed)
- **Duration**: Maximum 2 hours
- **Timing**: Off-peak hours (2-4 AM UTC, typically Sunday/Monday)
- **Notification**: Email users 7 days in advance, show banner 24 hours before

**Zero-Downtime Deployments:**
- **Blue-Green Deployment**: Switch traffic between two identical environments
- **Rolling Updates**: Update servers one at a time
- **Database Migrations**: Non-blocking migrations (add columns, not remove)

#### AVAIL-5.5.3: Scalability

**Horizontal Scaling:**
- **Application Servers**: Auto-scale from 2 to 20 instances
- **Scaling Triggers**: CPU >75%, Memory >80%, Request queue >100
- **Scale-Up Time**: Add instances within 5 minutes
- **Scale-Down Time**: Remove instances after 15 minutes of low usage

**Database Scaling:**
- **Read Replicas**: Add replicas for read-heavy workloads
- **Sharding**: Partition data across multiple databases (future)
- **Connection Pooling**: Reuse database connections efficiently

**CDN Scaling:**
- **Global Distribution**: 200+ edge locations worldwide
- **Automatic Scaling**: CDN handles traffic spikes automatically
- **DDoS Protection**: CDN provides DDoS mitigation

### 5.6 Maintainability Requirements

**Description:**  
Ensures the system can be easily maintained, updated, and debugged.

#### MAINT-5.6.1: Code Quality

**Coding Standards:**
- **Style Guide**: Follow Airbnb JavaScript Style Guide or Standard.js
- **Linting**: ESLint for JavaScript, Pylint for Python (if used)
- **Formatting**: Prettier for consistent code formatting
- **Type Safety**: TypeScript encouraged (or JSDoc for type hints)

**Code Review:**
- **Peer Review**: All code changes reviewed by at least one other developer
- **Pull Request Template**: Standardized PR description template
- **Automated Checks**: Linting, tests must pass before merge
- **Review Guidelines**: Check for security, performance, readability

**Code Documentation:**
- **Function Comments**: JSDoc comments for all public functions
- **README Files**: README in each major directory explaining purpose
- **API Documentation**: OpenAPI/Swagger spec for REST API
- **Architecture Diagrams**: System architecture and data flow diagrams

#### MAINT-5.6.2: Testing Requirements

**Test Coverage:**
- **Unit Tests**: Minimum 70% code coverage
- **Integration Tests**: Test API endpoints and database operations
- **End-to-End Tests**: Test critical user flows (upload, edit, download)
- **Regression Tests**: Prevent reintroduction of fixed bugs

**Testing Frameworks:**
- **Unit Testing**: Jest (JavaScript), pytest (Python)
- **E2E Testing**: Cypress, Playwright, or Selenium
- **API Testing**: Supertest, Postman collections
- **Performance Testing**: Apache JMeter, k6

**Continuous Testing:**
- **Pre-Commit**: Run linting and unit tests before commit
- **CI Pipeline**: Run all tests on every push to repository
- **Test Environments**: Separate dev, staging, production environments
- **Test Data**: Use fixtures and mocks for consistent testing

#### MAINT-5.6.3: Deployment and CI/CD

**Continuous Integration:**
- **Version Control**: Git with GitHub, GitLab, or Bitbucket
- **Branching Strategy**: GitFlow or Trunk-Based Development
- **Build Pipeline**: Automated builds on every commit
- **Artifact Storage**: Store build artifacts (Docker images, bundles)

**Continuous Deployment:**
- **Automated Deployment**: Deploy to staging on merge to main branch
- **Manual Approval**: Require approval for production deployments
- **Rollback Capability**: One-click rollback to previous version
- **Deployment Frequency**: Deploy to production at least weekly

**Infrastructure as Code (IaC):**
- **Tools**: Terraform, AWS CloudFormation, or Pulumi
- **Version Control**: IaC definitions in Git repository
- **Environment Parity**: Dev, staging, prod use same IaC templates
- **Automated Provisioning**: Spin up new environments programmatically

#### MAINT-5.6.4: Monitoring and Observability

**Application Monitoring:**
- **Performance Monitoring**: Track response times, throughput, errors
- **Resource Monitoring**: CPU, memory, disk, network usage
- **Custom Metrics**: Feature usage, document operations, AI requests
- **Dashboards**: Grafana, DataDog, or CloudWatch dashboards

**Logging:**
- **Structured Logging**: JSON format with consistent fields
- **Log Levels**: DEBUG, INFO, WARN, ERROR, FATAL
- **Centralized Logging**: ELK stack (Elasticsearch, Logstash, Kibana) or similar
- **Log Retention**: 90 days for application logs, 30 days for access logs

**Tracing:**
- **Distributed Tracing**: OpenTelemetry or Jaeger for request tracing
- **Request IDs**: Unique ID for each request (for correlation across services)
- **Performance Profiling**: Identify slow database queries, API calls

**Alerting:**
- **Alert Channels**: Email, Slack, PagerDuty for critical alerts
- **Alert Severity**: Info, Warning, Critical
- **On-Call Rotation**: 24/7 on-call schedule for critical alerts
- **Alert Fatigue**: Tune alerts to reduce false positives

#### MAINT-5.6.5: Documentation

**Technical Documentation:**
- **Architecture Documentation**: System design, component diagrams
- **API Documentation**: OpenAPI/Swagger with examples
- **Database Schema**: Entity-relationship diagrams, field descriptions
- **Deployment Guide**: Step-by-step deployment instructions
- **Troubleshooting Guide**: Common issues and solutions

**User Documentation:**
- **User Guide**: Comprehensive guide for all features
- **Tutorial Videos**: Screen recordings showing how to use features
- **FAQ**: Frequently asked questions
- **Knowledge Base**: Searchable articles for help

**Change Log:**
- **Release Notes**: Document changes in each release
- **Breaking Changes**: Clearly mark breaking changes
- **Migration Guides**: Help users upgrade to new versions

### 5.7 Portability Requirements

**Description:**  
Ensures the system can be adapted to different environments and platforms.

#### PORT-5.7.1: Browser Compatibility

**Supported Browsers:**
- **Google Chrome**: Version 100+ (primary target)
- **Mozilla Firefox**: Version 95+
- **Apple Safari**: Version 15+ (macOS, iOS)
- **Microsoft Edge**: Version 100+ (Chromium-based)
- **Opera**: Version 85+

**Unsupported Browsers:**
- Internet Explorer (all versions)
- Safari < 15
- Old Android browsers (< Android 10)

**Progressive Enhancement:**
- Core functionality works on all supported browsers
- Advanced features (WebGL, WebAssembly) degrade gracefully
- Polyfills for missing browser features

#### PORT-5.7.2: Platform Independence

**Operating System Support:**
- **Desktop**: Windows 10+, macOS 10.15+, Linux (Ubuntu 20.04+)
- **Mobile**: iOS 15+, Android 10+
- **Tablet**: iPadOS 15+, Android tablets

**Device Support:**
- **Desktop/Laptop**: Full functionality
- **Tablet**: 90% functionality (touch-optimized)
- **Mobile**: 70% functionality (simplified UI)

**No Platform-Specific Code:**
- Avoid browser-specific hacks or workarounds
- Use standard web APIs (W3C standards)
- Test on all supported platforms

#### PORT-5.7.3: Cloud Provider Portability

**Containerization:**
- **Docker**: All services containerized with Dockerfile
- **Docker Compose**: Local development environment setup
- **Kubernetes**: Orchestration with standard Kubernetes manifests

**Cloud-Agnostic Architecture:**
- **Abstraction Layer**: Abstract cloud services (S3, CloudStorage, Azure Blob)
- **Environment Variables**: Configure cloud provider via environment variables
- **Terraform Modules**: Multi-cloud infrastructure as code

**Supported Cloud Providers:**
- **Primary**: AWS (Amazon Web Services)
- **Alternative**: Google Cloud Platform (GCP)
- **Alternative**: Microsoft Azure
- **Alternative**: Self-hosted on VPS (DigitalOcean, Linode)

**Database Portability:**
- Use standard MongoDB protocol (works with Atlas, self-hosted, DocumentDB)
- Avoid provider-specific features
- Database migrations in version control

#### PORT-5.7.4: Data Export and Import

**Export Formats:**
- **User Data**: JSON, CSV
- **Documents**: PDF, DOCX, TXT, Markdown, images
- **Bulk Export**: ZIP archive of all user data

**Import Capabilities:**
- Import documents from local files
- Import from Google Drive, Dropbox (via API)
- Batch import multiple files

**API for Integration:**
- REST API for third-party integrations
- Webhooks for event notifications (future)
- OAuth for secure third-party access

### 5.8 Usability Requirements

**Description:**  
Ensures the system is easy to learn, use, and navigate.

#### USAB-5.8.1: Learnability

**Onboarding:**
- **Welcome Tour**: Interactive tutorial on first login (5 steps)
- **Tooltips**: Contextual help on hover (all toolbar icons)
- **Empty States**: Helpful messages when no documents present
- **Sample Document**: Pre-loaded sample PDF to explore features

**Learning Curve:**
- **Basic Features**: Usable within 5 minutes (upload, view, download)
- **Intermediate Features**: Learnable within 30 minutes (edit, annotate, merge)
- **Advanced Features**: Learnable within 2 hours (AI, collaboration, forms)

**Documentation:**
- **In-App Help**: ? icon in toolbar opens help panel
- **Keyboard Shortcut Guide**: Press ? key to show all shortcuts
- **Video Tutorials**: 2-minute videos for each major feature
- **Contextual Help**: Help links in complex dialogs

#### USAB-5.8.2: Efficiency of Use

**Keyboard Shortcuts:**
- All major actions accessible via keyboard
- Shortcuts displayed in tooltips and menus
- Customizable shortcuts (premium feature)

**Batch Operations:**
- Select multiple pages for deletion, rotation, extraction
- Bulk file upload (drag multiple files)
- Apply same operation to multiple documents

**Recent Files:**
- Quick access to last 10 opened documents
- Search recent files by name
- Pin frequently used files to top

**Templates:**
- Save frequently used settings as templates
- Watermark templates, header/footer templates
- Form field templates

#### USAB-5.8.3: Error Prevention

**Confirmation Dialogs:**
- Confirm before destructive actions (delete document, remove all pages)
- Preview before applying (compress, convert format)
- Warn about data loss (closing unsaved document)

**Input Validation:**
- Real-time validation for form fields (email format, password strength)
- Disable submit button until form is valid
- Clear error messages below invalid fields

**Undo Capability:**
- Undo/redo for all editing actions
- "Restore this version" for version history
- Recover deleted files from trash (30-day retention)

**Auto-Save:**
- Automatically save every 30 seconds during editing
- Show "Saving..." indicator
- Never lose work due to browser crash

#### USAB-5.8.4: Accessibility (WCAG 2.1 Level AA)

**Keyboard Navigation:**
- All functionality accessible via keyboard
- Logical tab order
- Skip navigation links
- Focus indicators clearly visible

**Screen Reader Support:**
- ARIA labels for all interactive elements
- Status announcements for dynamic content
- Descriptive alt text for images and icons
- Semantic HTML (headings, landmarks, lists)

**Visual Accessibility:**
- Color contrast: 4.5:1 for text, 3:1 for UI elements
- Resizable text (up to 200% without breaking layout)
- No reliance on color alone (use icons + text)
- Dark mode for reduced eye strain

**Motor Accessibility:**
- Large click targets (minimum 44×44px)
- No time-based interactions (or adjustable timeout)
- Drag-and-drop alternatives (keyboard shortcuts)

**Cognitive Accessibility:**
- Simple, clear language (avoid jargon)
- Consistent navigation and layout
- Minimize distractions (no auto-playing content)
- Clear progress indicators for multi-step processes

#### USAB-5.8.5: User Satisfaction

**Performance Perception:**
- Skeleton screens while loading (perceived faster than spinners)
- Optimistic UI updates (show changes immediately, sync in background)
- Progress indicators for long operations

**Visual Design:**
- Modern, clean interface (minimal clutter)
- Consistent design system (colors, typography, spacing)
- Professional aesthetics (instills trust)
- Delightful micro-interactions (smooth animations)

**Feedback and Help:**
- In-app feedback widget (report bugs, suggest features)
- Live chat support (premium users)
- Email support (response within 24 hours)
- Community forum for peer help

**Customization:**
- Theme selection (light/dark)
- Toolbar customization (show/hide tools)
- Default settings (auto-save frequency, default zoom level)
- Language selection (English, Spanish, French, German, etc.)

---

## 6. Technical Architecture

### 6.1 Technology Stack

**Description:**  
Complete technology stack for UniPDF Studio, covering frontend, backend, database, and supporting services.

#### TECH-6.1.1: Frontend Stack

**Core Framework:**
- **React** v18.2+
  - Component-based architecture
  - Hooks for state management
  - Context API for global state
  - Suspense and lazy loading

**State Management:**
- **React Context** for light state management
- **Redux Toolkit** (optional) for complex state
- **React Query** for server state management and caching

**Styling:**
- **TailwindCSS** v3.3+
  - Utility-first CSS framework
  - Custom configuration for brand colors
  - Responsive design utilities
  - Dark mode support

**PDF Rendering:**
- **PDF.js** v3.11+ (Mozilla)
  - Canvas-based PDF rendering
  - Text layer extraction
  - Annotation support

**Canvas Manipulation:**
- **Fabric.js** v5.3+
  - Drawing and shape tools
  - Object manipulation (move, resize, rotate)
  - Layer management

**UI Components:**
- **Headless UI** or **Radix UI** for accessible components
- **React Icons** for icon library
- **React Toastify** for notifications
- **React Modal** for dialog boxes

**File Handling:**
- **File API** (native browser)
- **react-dropzone** for drag-and-drop uploads
- **axios** or **fetch** for file transfers

**Build Tools:**
- **Vite** v4+ (recommended) or **Create React App**
- **Babel** for transpilation
- **PostCSS** for CSS processing
- **ESLint** + **Prettier** for code quality

#### TECH-6.1.2: Backend Stack

**Runtime:**
- **Node.js** v18 LTS or v20 LTS
  - JavaScript runtime environment
  - Non-blocking I/O for scalability
  - NPM ecosystem

**Web Framework:**
- **Express.js** v4.18+
  - Lightweight, flexible web framework
  - Middleware architecture
  - Routing system

**PDF Processing:**
- **pdf-lib** v1.17+ - Create and modify PDFs
- **PDFKit** v0.13+ - Generate PDFs
- **HummusJS** (optional) - High-performance PDF manipulation
- **pdf-parse** - Extract text from PDFs

**OCR Processing:**
- **Tesseract.js** v4.0+ (client-side)
- **node-tesseract-ocr** v2.2+ (server-side)
- **Google Cloud Vision API** (premium)

**File Processing:**
- **Multer** - File upload middleware
- **Sharp** - Image processing and optimization
- **mammoth** - DOCX to HTML conversion
- **html-pdf** or **puppeteer** - HTML to PDF conversion

**Authentication:**
- **Passport.js** - Authentication middleware
  - Local strategy (email/password)
  - OAuth strategies (Google, GitHub)
- **jsonwebtoken** - JWT generation and verification
- **bcrypt** - Password hashing

**Validation:**
- **Joi** or **express-validator** - Request validation
- **validator.js** - String validation utilities

**Email:**
- **Nodemailer** with SendGrid or AWS SES
- **email-templates** for HTML email templates

**Task Queue:**
- **Bull** - Redis-based queue for background jobs
- **node-cron** - Scheduled tasks

#### TECH-6.1.3: Database and Storage

**Primary Database:**
- **MongoDB** v6.0+
  - Document-oriented NoSQL database
  - Flexible schema for PDF metadata
  - GridFS for large file storage (optional)
  - Atlas (cloud-hosted) or self-hosted

**MongoDB Driver:**
- **mongoose** v7.0+ - Object Document Mapping (ODM)
  - Schema definition
  - Validation
  - Middleware hooks

**Caching Layer:**
- **Redis** v7.0+
  - Session storage
  - API response caching
  - Rate limiting counters
  - Job queue (with Bull)

**File Storage:**
- **Firebase Cloud Storage** (primary)
  - Scalable object storage
  - CDN integration
  - Direct browser upload

**Alternative Storage:**
- **AWS S3** - Amazon object storage
- **Google Cloud Storage** - GCP object storage
- **MinIO** - Self-hosted S3-compatible storage

#### TECH-6.1.4: Cloud Services and APIs

**Authentication:**
- **Firebase Authentication**
  - Email/password auth
  - Google OAuth
  - Session management

**AI Services:**
- **OpenAI API** (GPT-4, GPT-3.5-turbo)
  - Text summarization
  - Chat completions
  - Text generation
  
**Alternative AI:**
- **Anthropic Claude API**
- **Hugging Face Inference API**
- **Cohere API**

**OCR Services:**
- **Google Cloud Vision API** (premium)
- **AWS Textract** (alternative)
- **Azure Computer Vision** (alternative)

**Cloud Storage Integration:**
- **Google Drive API** v3
- **Dropbox API** v2 (future)
- **OneDrive API** (future)

**Email Service:**
- **SendGrid API** (primary)
- **AWS SES** (alternative)
- **Mailgun** (alternative)

**Payment Processing (future):**
- **Stripe API** - Subscription management
- **PayPal API** (alternative)

#### TECH-6.1.5: DevOps and Infrastructure

**Containerization:**
- **Docker** v24+
  - Application containerization
  - Multi-stage builds
  - Docker Compose for local development

**Orchestration:**
- **Kubernetes** v1.27+ (production)
  - Container orchestration
  - Auto-scaling
  - Load balancing
  - Health checks

**CI/CD:**
- **GitHub Actions** (primary)
  - Automated testing
  - Build and deployment
  - Code quality checks
  
**Alternative CI/CD:**
- **GitLab CI/CD**
- **Jenkins**
- **CircleCI**

**Infrastructure as Code:**
- **Terraform** v1.5+ - Multi-cloud provisioning
- **AWS CloudFormation** (if using AWS)
- **Pulumi** (alternative)

**Monitoring and Logging:**
- **Prometheus** + **Grafana** - Metrics and dashboards
- **ELK Stack** (Elasticsearch, Logstash, Kibana) - Log aggregation
- **Sentry** - Error tracking
- **DataDog** or **New Relic** (commercial alternatives)

**CDN:**
- **CloudFlare** (primary)
- **AWS CloudFront** (alternative)
- **Fastly** (alternative)

**DNS and Domains:**
- **CloudFlare DNS** or **AWS Route 53**
- Domain registrar: Namecheap, GoDaddy, Google Domains

### 6.2 Backend Architecture

**Description:**  
Backend system architecture following modern best practices.

#### ARCH-6.2.1: System Architecture Diagram

```
┌─────────────────────────────────────────────────────────────┐
│                        Internet                             │
└──────────────────────┬──────────────────────────────────────┘
                       │
                       ▼
          ┌────────────────────────┐
          │   Load Balancer        │ (NGINX / CloudFlare)
          │   + SSL Termination    │
          └────────┬───────────────┘
                   │
      ┌────────────┴────────────┐
      │                         │
      ▼                         ▼
┌──────────────┐       ┌──────────────┐
│  App Server  │       │  App Server  │  (Node.js + Express)
│  Instance 1  │◄─────►│  Instance 2  │  (Auto-scaling)
└──────┬───────┘       └──────┬───────┘
       │                      │
       └──────────┬───────────┘
                  │
       ┌──────────┴───────────┬─────────────┐
       │                      │             │
       ▼                      ▼             ▼
┌─────────────┐      ┌──────────────┐  ┌─────────────┐
│  MongoDB    │      │    Redis     │  │   Storage   │
│  (Primary)  │      │   (Cache)    │  │  (Firebase  │
│  + Replicas │      │  + Sessions  │  │   / S3)     │
└─────────────┘      └──────────────┘  └─────────────┘
       │
       ▼
┌─────────────┐
│  Backup     │
│  Storage    │
└─────────────┘

External Services:
├─ Firebase Auth
├─ OpenAI API
├─ Google Vision API
├─ SendGrid Email
└─ Google Drive API
```

#### ARCH-6.2.2: Layered Architecture

**1. Presentation Layer (API Routes)**
```
/routes
├── auth.routes.js       - Authentication endpoints
├── user.routes.js       - User management
├── document.routes.js   - Document CRUD
├── ai.routes.js         - AI features
├── share.routes.js      - Sharing and collaboration
└── index.js             - Route aggregation
``` 

**2. Business Logic Layer (Services)**
```
/services
├── auth.service.js      - Authentication logic
├── document.service.js  - Document operations
├── pdf.service.js       - PDF manipulation
├── ocr.service.js       - OCR processing
├── ai.service.js        - AI integration
├── storage.service.js   - File storage operations
├── email.service.js     - Email sending
└── collaboration.service.js - Real-time features
```

**3. Data Access Layer (Models)**
```
/models
├── User.js              - User schema and methods
├── Document.js          - Document schema
├── Comment.js           - Comment schema
├── Version.js           - Version history schema
├── Share.js             - Share link schema
└── Session.js           - Session schema
```

**4. Middleware Layer**
```
/middleware
├── auth.middleware.js   - JWT verification
├── validate.middleware.js - Request validation
├── upload.middleware.js - File upload handling
├── rateLimit.middleware.js - Rate limiting
├── error.middleware.js  - Error handling
└── logger.middleware.js - Request logging
```

**5. Utility Layer**
```
/utils
├── jwt.util.js          - Token generation/verification
├── hash.util.js         - Password hashing
├── email.util.js        - Email templates
├── file.util.js         - File operations
└── validation.util.js   - Custom validators
```

#### ARCH-6.2.3: API Design Pattern

**RESTful API Structure:**
```javascript
// Example: Document endpoints
GET    /api/v1/documents              // List all documents
POST   /api/v1/documents              // Create document
GET    /api/v1/documents/:id          // Get specific document
PUT    /api/v1/documents/:id          // Update document
DELETE /api/v1/documents/:id          // Delete document
GET    /api/v1/documents/:id/download // Download document

// Nested resources
GET    /api/v1/documents/:id/comments // Get document comments
POST   /api/v1/documents/:id/comments // Add comment
PUT    /api/v1/comments/:commentId    // Update comment
DELETE /api/v1/comments/:commentId    // Delete comment

// Actions (non-REST endpoints)
POST   /api/v1/documents/:id/merge    // Merge documents
POST   /api/v1/documents/:id/split    // Split document
POST   /api/v1/documents/:id/compress // Compress document
```

**Request/Response Format:**
```javascript
// Standard success response
{
  "success": true,
  "data": {
    "id": "doc-123",
    "title": "My Document",
    "pages": 10
  },
  "message": "Document retrieved successfully"
}

// Standard error response
{
  "success": false,
  "error": {
    "code": "DOCUMENT_NOT_FOUND",
    "message": "Document not found",
    "details": {
      "documentId": "doc-123"
    }
  }
}

// Paginated response
{
  "success": true,
  "data": [...],
  "pagination": {
    "page": 1,
    "limit": 20,
    "total": 150,
    "pages": 8
  }
}
```

#### ARCH-6.2.4: Authentication Flow

**JWT Authentication Flow:**
```
1. User Registration:
   POST /auth/register
   → Validate input
   → Hash password (bcrypt)
   → Create user in database
   → Send verification email
   → Return success message

2. Email Verification:
   GET /auth/verify-email?token=...
   → Verify token
   → Mark email as verified
   → Return success message

3. User Login:
   POST /auth/login
   → Validate credentials
   → Compare password hash
   → Generate JWT access token (1h expiry)
   → Generate JWT refresh token (30d expiry)
   → Store refresh token in database
   → Return tokens

4. Protected Request:
   GET /documents (with Authorization: Bearer <token>)
   → Verify JWT signature
   → Check expiry
   → Extract user ID from token
   → Fetch user from database
   → Attach user to request object
   → Continue to route handler

5. Token Refresh:
   POST /auth/refresh (with refresh token)
   → Verify refresh token
   → Check if token exists in database
   → Generate new access token
   → Return new access token

6. Logout:
   POST /auth/logout
   → Remove refresh token from database
   → Return success message
```

#### ARCH-6.2.5: File Upload Flow

**Multipart File Upload:**
```
1. Client initiates upload:
   POST /documents
   Content-Type: multipart/form-data
   
2. Multer middleware intercepts:
   → Validate file type (MIME type + extension)
   → Check file size (< 100MB)
   → Generate unique filename
   → Save to temporary storage (/tmp)
   
3. Controller processes file:
   → Extract metadata (filename, size, type)
   → Upload to cloud storage (Firebase/S3)
   → Get public URL or signed URL
   → Create document record in database
   → Delete temp file
   → Return document info to client
   
4. Error handling:
   → If validation fails: 400 Bad Request
   → If upload fails: 500 Internal Server Error
   → If quota exceeded: 413 Payload Too Large
   → Clean up temp files in all cases
```

#### ARCH-6.2.6: Background Job Processing

**Task Queue with Bull:**
```javascript
// Job producer (in controller)
const ocrQueue = require('./queues/ocrQueue');

async function processOCR(documentId) {
  await ocrQueue.add('process-ocr', {
    documentId,
    userId: req.user.id
  });
  
  return res.json({
    success: true,
    message: 'OCR processing started'
  });
}

// Job consumer (in worker.js)
ocrQueue.process('process-ocr', async (job) => {
  const { documentId, userId } = job.data;
  
  // Update progress
  job.progress(10);
  
  // Fetch document
  const document = await Document.findById(documentId);
  
  job.progress(30);
  
  // Run OCR
  const text = await ocrService.extractText(document.fileUrl);
  
  job.progress(70);
  
  // Save results
  await Document.updateOne(
    { _id: documentId },
    { ocrText: text, ocrCompleted: true }
  );
  
  job.progress(100);
  
  // Send notification
  await emailService.sendOCRCompleteEmail(userId);
  
  return { success: true, text };
});

// Job types:
// - OCR processing
// - PDF compression
// - AI summarization
// - Email sending
// - File cleanup
// - Report generation
```

### 6.3 Frontend Architecture

**Description:**  
Frontend architecture using React and modern patterns.

#### ARCH-6.3.1: Component Structure

```
/src
├── /components
│   ├── /common          - Reusable UI components
│   │   ├── Button.jsx
│   │   ├── Input.jsx
│   │   ├── Modal.jsx
│   │   ├── Tooltip.jsx
│   │   └── Spinner.jsx
│   │
│   ├── /layout          - Page layout components
│   │   ├── Header.jsx
│   │   ├── Sidebar.jsx
│   │   ├── Toolbar.jsx
│   │   └── Footer.jsx
│   │
│   ├── /document        - Document-related components
│   │   ├── DocumentList.jsx
│   │   ├── DocumentCard.jsx
│   │   ├── DocumentViewer.jsx
│   │   ├── PageThumbnail.jsx
│   │   └── PDFCanvas.jsx
│   │
│   ├── /editor          - Editing tool components
│   │   ├── TextEditor.jsx
│   │   ├── DrawingTool.jsx
│   │   ├── AnnotationTool.jsx
│   │   ├── ShapeTool.jsx
│   │   └── ImageTool.jsx
│   │
│   ├── /ai              - AI feature components
│   │   ├── AIChat.jsx
│   │   ├── SummaryPanel.jsx
│   │   └── TextRewriter.jsx
│   │
│   └── /auth            - Authentication components
│       ├── LoginForm.jsx
│       ├── RegisterForm.jsx
│       └── PasswordReset.jsx
│
├── /pages               - Route-level pages
│   ├── HomePage.jsx
│   ├── EditorPage.jsx
│   ├── DashboardPage.jsx
│   ├── LoginPage.jsx
│   └── SettingsPage.jsx
│
├── /hooks               - Custom React hooks
│   ├── useAuth.js
│   ├── useDocument.js
│   ├── usePDFRender.js
│   └── useWebSocket.js
│
├── /context             - React context providers
│   ├── AuthContext.jsx
│   ├── DocumentContext.jsx
│   └── ThemeContext.jsx
│
├── /services            - API service layer
│   ├── api.js           - Axios instance
│   ├── authService.js
│   ├── documentService.js
│   └── aiService.js
│
├── /utils               - Utility functions
│   ├── pdfUtils.js
│   ├── fileUtils.js
│   └── formatUtils.js
│
├── /styles              - Global styles
│   ├── global.css
│   └── tailwind.config.js
│
├── App.jsx              - Root component
├── main.jsx             - Entry point
└── router.jsx           - Route configuration
```

#### ARCH-6.3.2: State Management Pattern

**Context + Hooks Pattern:**
```javascript
// AuthContext.jsx
import React, { createContext, useContext, useState, useEffect } from 'react';
import { authService } from '../services/authService';

const AuthContext = createContext();

export function AuthProvider({ children }) {
  const [user, setUser] = useState(null);
  const [loading, setLoading] = useState(true);
  
  useEffect(() => {
    // Check if user is logged in on mount
    const token = localStorage.getItem('token');
    if (token) {
      authService.validateToken(token)
        .then(user => setUser(user))
        .catch(() => localStorage.removeItem('token'))
        .finally(() => setLoading(false));
    } else {
      setLoading(false);
    }
  }, []);
  
  const login = async (email, password) => {
    const { user, token } = await authService.login(email, password);
    localStorage.setItem('token', token);
    setUser(user);
  };
  
  const logout = () => {
    localStorage.removeItem('token');
    setUser(null);
  };
  
  const value = {
    user,
    loading,
    login,
    logout,
    isAuthenticated: !!user
  };
  
  return (
    <AuthContext.Provider value={value}>
      {children}
    </AuthContext.Provider>
  );
}

// Custom hook
export function useAuth() {
  const context = useContext(AuthContext);
  if (!context) {
    throw new Error('useAuth must be used within AuthProvider');
  }
  return context;
}

// Usage in component
function Header() {
  const { user, logout, isAuthenticated } = useAuth();
  
  return (
    <header>
      {isAuthenticated ? (
        <>
          <span>Welcome, {user.name}</span>
          <button onClick={logout}>Logout</button>
        </>
      ) : (
        <Link to="/login">Login</Link>
      )}
    </header>
  );
}
```

#### ARCH-6.3.3: PDF Rendering Architecture

**PDF.js Integration:**
```javascript
// usePDFRender.js - Custom hook
import { useEffect, useRef, useState } from 'react';
import * as pdfjsLib from 'pdfjs-dist';

export function usePDFRender(fileUrl) {
  const canvasRef = useRef(null);
  const [pdf, setPdf] = useState(null);
  const [currentPage, setCurrentPage] = useState(1);
  const [numPages, setNumPages] = useState(0);
  const [loading, setLoading] = useState(true);
  
  // Load PDF
  useEffect(() => {
    if (!fileUrl) return;
    
    pdfjsLib.getDocument(fileUrl).promise
      .then(pdfDoc => {
        setPdf(pdfDoc);
        setNumPages(pdfDoc.numPages);
        setLoading(false);
      })
      .catch(error => {
        console.error('Error loading PDF:', error);
        setLoading(false);
      });
  }, [fileUrl]);
  
  // Render page
  useEffect(() => {
    if (!pdf || !canvasRef.current) return;
    
    const canvas = canvasRef.current;
    const context = canvas.getContext('2d');
    
    pdf.getPage(currentPage).then(page => {
      const viewport = page.getViewport({ scale: 1.5 });
      canvas.height = viewport.height;
      canvas.width = viewport.width;
      
      const renderContext = {
        canvasContext: context,
        viewport: viewport
      };
      
      page.render(renderContext);
    });
  }, [pdf, currentPage]);
  
  return {
    canvasRef,
    currentPage,
    numPages,
    loading,
    setCurrentPage,
    nextPage: () => setCurrentPage(p => Math.min(p + 1, numPages)),
    prevPage: () => setCurrentPage(p => Math.max(p - 1, 1))
  };
}

// PDFViewer.jsx - Component
function PDFViewer({ documentUrl }) {
  const { canvasRef, currentPage, numPages, loading, nextPage, prevPage } = 
    usePDFRender(documentUrl);
  
  if (loading) return <Spinner />;
  
  return (
    <div className="pdf-viewer">
      <canvas ref={canvasRef} />
      <div className="controls">
        <button onClick={prevPage} disabled={currentPage === 1}>
          Previous
        </button>
        <span>Page {currentPage} of {numPages}</span>
        <button onClick={nextPage} disabled={currentPage === numPages}>
          Next
        </button>
      </div>
    </div>
  );
}
```

#### ARCH-6.3.4: Real-Time Collaboration

**WebSocket Integration:**
```javascript
// useWebSocket.js
import { useEffect, useRef, useState } from 'react';

export function useWebSocket(documentId, userId) {
  const socketRef = useRef(null);
  const [connected, setConnected] = useState(false);
  const [messages, setMessages] = useState([]);
  
  useEffect(() => {
    // Connect to WebSocket
    const token = localStorage.getItem('token');
    const socket = new WebSocket(
      `wss://api.unipdfstudio.com/ws?token=${token}`
    );
    
    socket.onopen = () => {
      console.log('WebSocket connected');
      setConnected(true);
      
      // Join document room
      socket.send(JSON.stringify({
        type: 'join',
        documentId,
        userId
      }));
    };
    
    socket.onmessage = (event) => {
      const data = JSON.parse(event.data);
      setMessages(prev => [...prev, data]);
      
      // Handle different message types
      switch (data.type) {
        case 'edit':
          handleEdit(data);
          break;
        case 'cursor':
          handleCursorUpdate(data);
          break;
        case 'comment':
          handleComment(data);
          break;
      }
    };
    
    socket.onerror = (error) => {
      console.error('WebSocket error:', error);
    };
    
    socket.onclose = () => {
      console.log('WebSocket disconnected');
      setConnected(false);
      
      // Reconnect after 3 seconds
      setTimeout(() => {
        // Reconnection logic
      }, 3000);
    };
    
    socketRef.current = socket;
    
    // Cleanup
    return () => {
      if (socket.readyState === WebSocket.OPEN) {
        socket.send(JSON.stringify({
          type: 'leave',
          documentId,
          userId
        }));
        socket.close();
      }
    };
  }, [documentId, userId]);
  
  const sendMessage = (type, payload) => {
    if (socketRef.current?.readyState === WebSocket.OPEN) {
      socketRef.current.send(JSON.stringify({
        type,
        documentId,
        userId,
        payload,
        timestamp: Date.now()
      }));
    }
  };
  
  return {
    connected,
    messages,
    sendEdit: (changes) => sendMessage('edit', changes),
    sendCursor: (position) => sendMessage('cursor', position),
    sendComment: (comment) => sendMessage('comment', comment)
  };
}
```

### 6.4 Database Design

**Description:**  
MongoDB schema design for UniPDF Studio.

#### DB-6.4.1: User Collection

```javascript
// models/User.js
const mongoose = require('mongoose');
const bcrypt = require('bcrypt');

const userSchema = new mongoose.Schema({
  name: {
    type: String,
    required: true,
    trim: true
  },
  email: {
    type: String,
    required: true,
    unique: true,
    lowercase: true,
    trim: true
  },
  password: {
    type: String,
    required: true,
    minlength: 8
  },
  emailVerified: {
    type: Boolean,
    default: false
  },
  verificationToken: String,
  resetPasswordToken: String,
  resetPasswordExpires: Date,
  
  // Profile
  avatar: String,
  organization: String,
  role: {
    type: String,
    enum: ['free', 'premium', 'admin'],
    default: 'free'
  },
  
  // Storage
  storageUsed: {
    type: Number,
    default: 0  // in bytes
  },
  storageQuota: {
    type: Number,
    default: 5 * 1024 * 1024 * 1024  // 5GB
  },
  
  // Preferences
  preferences: {
    theme: {
      type: String,
      enum: ['light', 'dark', 'auto'],
      default: 'light'
    },
    language: {
      type: String,
      default: 'en'
    },
    emailNotifications: {
      type: Boolean,
      default: true
    }
  },
  
  // OAuth
  googleId: String,
  githubId: String,
  
  // Timestamps
  lastLogin: Date,
  createdAt: {
    type: Date,
    default: Date.now
  },
  updatedAt: {
    type: Date,
    default: Date.now
  }
}, {
  timestamps: true
});

// Hash password before saving
userSchema.pre('save', async function(next) {
  if (!this.isModified('password')) return next();
  
  const salt = await bcrypt.genSalt(12);
  this.password = await bcrypt.hash(this.password, salt);
  next();
});

// Compare password method
userSchema.methods.comparePassword = async function(candidatePassword) {
  return await bcrypt.compare(candidatePassword, this.password);
};

// Hide password in JSON
userSchema.methods.toJSON = function() {
  const user = this.toObject();
  delete user.password;
  delete user.verificationToken;
  delete user.resetPasswordToken;
  return user;
};

module.exports = mongoose.model('User', userSchema);
```

#### DB-6.4.2: Document Collection

```javascript
// models/Document.js
const mongoose = require('mongoose');

const documentSchema = new mongoose.Schema({
  title: {
    type: String,
    required: true,
    trim: true
  },
  owner: {
    type: mongoose.Schema.Types.ObjectId,
    ref: 'User',
    required: true,
    index: true
  },
  
  // File info
  filename: String,
  originalFilename: String,
  fileUrl: {
    type: String,
    required: true
  },
  fileSize: {
    type: Number,
    required: true  // in bytes
  },
  mimeType: String,
  
  // PDF metadata
  pages: {
    type: Number,
    default: 1
  },
  pdfVersion: String,
  author: String,
  subject: String,
  keywords: [String],
  
  // Processing status
  status: {
    type: String,
    enum: ['processing', 'ready', 'error'],
    default: 'processing'
  },
  
  // OCR
  ocrCompleted: {
    type: Boolean,
    default: false
  },
  ocrText: String,
  ocrLanguage: String,
  
  // AI processing
  summary: String,
  summaryGeneratedAt: Date,
  
  // Organization
  folder: String,
  tags: [String],
  starred: {
    type: Boolean,
    default: false
  },
  
  // Collaboration
  sharedWith: [{
    user: {
      type: mongoose.Schema.Types.ObjectId,
      ref: 'User'
    },
    permission: {
      type: String,
      enum: ['view', 'comment', 'edit'],
      default: 'view'
    },
    sharedAt: {
      type: Date,
      default: Date.now
    }
  }],
  
  // Version control
  currentVersion: {
    type: Number,
    default: 1
  },
  
  // Timestamps
  lastModified: {
    type: Date,
    default: Date.now
  },
  lastAccessed: Date,
  createdAt: {
    type: Date,
    default: Date.now
  },
  updatedAt: {
    type: Date,
    default: Date.now
  }
}, {
  timestamps: true
});

// Indexes
documentSchema.index({ owner: 1, createdAt: -1 });
documentSchema.index({ owner: 1, title: 'text' });
documentSchema.index({ tags: 1 });

// Update storage used when document is saved/deleted
documentSchema.post('save', async function() {
  const User = mongoose.model('User');
  const totalSize = await mongoose.model('Document')
    .aggregate([
      { $match: { owner: this.owner } },
      { $group: { _id: null, total: { $sum: '$fileSize' } } }
    ]);
  
  await User.updateOne(
    { _id: this.owner },
    { storageUsed: totalSize[0]?.total || 0 }
  );
});

module.exports = mongoose.model('Document', documentSchema);
```

#### DB-6.4.3: Comment Collection

```javascript
// models/Comment.js
const mongoose = require('mongoose');

const commentSchema = new mongoose.Schema({
  document: {
    type: mongoose.Schema.Types.ObjectId,
    ref: 'Document',
    required: true,
    index: true
  },
  author: {
    type: mongoose.Schema.Types.ObjectId,
    ref: 'User',
    required: true
  },
  
  // Comment content
  text: {
    type: String,
    required: true
  },
  
  // Location in document
  page: {
    type: Number,
    required: true
  },
  position: {
    x: Number,
    y: Number
  },
  
  // Threading
  parentComment: {
    type: mongoose.Schema.Types.ObjectId,
    ref: 'Comment'
  },
  replies: [{
    type: mongoose.Schema.Types.ObjectId,
    ref: 'Comment'
  }],
  
  // Status
  resolved: {
    type: Boolean,
    default: false
  },
  resolvedBy: {
    type: mongoose.Schema.Types.ObjectId,
    ref: 'User'
  },
  resolvedAt: Date,
  
  // Mentions
  mentions: [{
    type: mongoose.Schema.Types.ObjectId,
    ref: 'User'
  }],
  
  // Timestamps
  createdAt: {
    type: Date,
    default: Date.now
  },
  updatedAt: {
    type: Date,
    default: Date.now
  }
}, {
  timestamps: true
});

// Index
commentSchema.index({ document: 1, page: 1 });

module.exports = mongoose.model('Comment', commentSchema);
```

#### DB-6.4.4: Version Collection

```javascript
// models/Version.js
const mongoose = require('mongoose');

const versionSchema = new mongoose.Schema({
  document: {
    type: mongoose.Schema.Types.ObjectId,
    ref: 'Document',
    required: true,
    index: true
  },
  versionNumber: {
    type: Number,
    required: true
  },
  
  // File snapshot
  fileUrl: {
    type: String,
    required: true
  },
  fileSize: Number,
  
  // Version info
  description: String,
  author: {
    type: mongoose.Schema.Types.ObjectId,
    ref: 'User',
    required: true
  },
  
  // Changes
  changesSummary: String,
  
  createdAt: {
    type: Date,
    default: Date.now
  }
});

// Compound index
versionSchema.index({ document: 1, versionNumber: -1 });

module.exports = mongoose.model('Version', versionSchema);
```

#### DB-6.4.5: Share Link Collection

```javascript
// models/Share.js
const mongoose = require('mongoose');
const crypto = require('crypto');

const shareSchema = new mongoose.Schema({
  document: {
    type: mongoose.Schema.Types.ObjectId,
    ref: 'Document',
    required: true,
    index: true
  },
  owner: {
    type: mongoose.Schema.Types.ObjectId,
    ref: 'User',
    required: true
  },
  
  // Share link
  token: {
    type: String,
    unique: true,
    default: () => crypto.randomBytes(8).toString('hex')
  },
  
  // Permissions
  permission: {
    type: String,
    enum: ['view', 'comment', 'edit'],
    default: 'view'
  },
  allowDownload: {
    type: Boolean,
    default: true
  },
  
  // Security
  password: String,  // hashed
  expiresAt: Date,
  oneTime: {
    type: Boolean,
    default: false
  },
  used: {
    type: Boolean,
    default: false
  },
  
  // Analytics
  viewCount: {
    type: Number,
    default: 0
  },
  lastAccessed: Date,
  accessLog: [{
    ip: String,
    userAgent: String,
    timestamp: {
      type: Date,
      default: Date.now
    }
  }],
  
  // Status
  active: {
    type: Boolean,
    default: true
  },
  
  createdAt: {
    type: Date,
    default: Date.now
  }
});

// Check if link is valid
shareSchema.methods.isValid = function() {
  if (!this.active) return false;
  if (this.oneTime && this.used) return false;
  if (this.expiresAt && this.expiresAt < new Date()) return false;
  return true;
};

module.exports = mongoose.model('Share', shareSchema);
```

### 6.5 API Design

**Description:**  
Complete REST API specification with OpenAPI/Swagger documentation.

#### API-6.5.1: API Versioning

**URL Structure:**
```
https://api.unipdfstudio.com/v1/{resource}
```

**Version Strategy:**
- **Current Version**: v1
- **Deprecation Policy**: Maintain old versions for 12 months after new release
- **Version Header**: Accept-Version: v1 (optional, defaults to latest)

#### API-6.5.2: Authentication Endpoints

```yaml
/auth/register:
  post:
    summary: Register new user
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              name:
                type: string
              email:
                type: string
                format: email
              password:
                type: string
                minLength: 8
    responses:
      201:
        description: User created successfully
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                message:
                  type: string
                data:
                  type: object
                  properties:
                    userId:
                      type: string
      400:
        description: Invalid input
      409:
        description: Email already exists

/auth/login:
  post:
    summary: Login user
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              email:
                type: string
              password:
                type: string
    responses:
      200:
        description: Login successful
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                data:
                  type: object
                  properties:
                    accessToken:
                      type: string
                    refreshToken:
                      type: string
                    user:
                      $ref: '#/components/schemas/User'
      401:
        description: Invalid credentials

/auth/refresh:
  post:
    summary: Refresh access token
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              refreshToken:
                type: string
    responses:
      200:
        description: Token refreshed
        content:
          application/json:
            schema:
              type: object
              properties:
                accessToken:
                  type: string
```

#### API-6.5.3: Document Endpoints

```yaml
/documents:
  get:
    summary: List user's documents
    security:
      - bearerAuth: []
    parameters:
      - name: page
        in: query
        schema:
          type: integer
          default: 1
      - name: limit
        in: query
        schema:
          type: integer
          default: 20
      - name: sort
        in: query
        schema:
          type: string
          enum: [createdAt, title, size]
      - name: order
        in: query
        schema:
          type: string
          enum: [asc, desc]
      - name: search
        in: query
        schema:
          type: string
    responses:
      200:
        description: List of documents
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                data:
                  type: array
                  items:
                    $ref: '#/components/schemas/Document'
                pagination:
                  $ref: '#/components/schemas/Pagination'
  
  post:
    summary: Upload new document
    security:
      - bearerAuth: []
    requestBody:
      required: true
      content:
        multipart/form-data:
          schema:
            type: object
            properties:
              file:
                type: string
                format: binary
              title:
                type: string
              folder:
                type: string
              tags:
                type: array
                items:
                  type: string
    responses:
      201:
        description: Document uploaded successfully
      413:
        description: File too large
      415:
        description: Unsupported file type

/documents/{id}:
  get:
    summary: Get document details
    security:
      - bearerAuth: []
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
    responses:
      200:
        description: Document details
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Document'
      404:
        description: Document not found
  
  put:
    summary: Update document
    security:
      - bearerAuth: []
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              title:
                type: string
              tags:
                type: array
                items:
                  type: string
              folder:
                type: string
    responses:
      200:
        description: Document updated
      404:
        description: Document not found
  
  delete:
    summary: Delete document
    security:
      - bearerAuth: []
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
    responses:
      204:
        description: Document deleted
      404:
        description: Document not found

/documents/{id}/download:
  get:
    summary: Download document
    security:
      - bearerAuth: []
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
      - name: format
        in: query
        schema:
          type: string
          enum: [pdf, docx, txt, html, png, jpg]
          default: pdf
    responses:
      200:
        description: File download
        content:
          application/pdf:
            schema:
              type: string
              format: binary
```

#### API-6.5.4: Rate Limiting

**Rate Limit Configuration:**
```javascript
// Express rate limiting middleware
const rateLimit = require('express-rate-limit');

// General API rate limit
const apiLimiter = rateLimit({
  windowMs: 15 * 60 * 1000, // 15 minutes
  max: 100, // 100 requests per window
  message: {
    success: false,
    error: {
      code: 'RATE_LIMIT_EXCEEDED',
      message: 'Too many requests, please try again later'
    }
  },
  standardHeaders: true, // Return rate limit info in headers
  legacyHeaders: false
});

// Strict rate limit for expensive operations
const strictLimiter = rateLimit({
  windowMs: 60 * 60 * 1000, // 1 hour
  max: 10, // 10 requests per hour
  message: 'AI request limit exceeded'
});

// Apply to routes
app.use('/api/v1', apiLimiter);
app.use('/api/v1/ai', strictLimiter);
```

**Rate Limit Headers:**
```
X-RateLimit-Limit: 100
X-RateLimit-Remaining: 95
X-RateLimit-Reset: 1698765432
```

---

## 7. Data Requirements

### 7.1 Data Models

**Description:**  
Defines the data entities, relationships, and constraints for UniPDF Studio.

#### DATA-7.1.1: Entity Relationship Diagram

```
┌──────────────┐         ┌──────────────┐         ┌──────────────┐
│     USER     │────────<│   DOCUMENT   │>────────│   VERSION    │
│              │  owns   │              │  has    │              │
│ - _id        │         │ - _id        │         │ - _id        │
│ - email      │         │ - title      │         │ - versionNum │
│ - password   │         │ - owner (FK) │         │ - document   │
│ - name       │         │ - fileUrl    │         │ - fileUrl    │
│ - role       │         │ - fileSize   │         │ - author (FK)│
│ - storage    │         │ - pages      │         │ - createdAt  │
└──────┬───────┘         │ - status     │         └──────────────┘
       │                 │ - ocrText    │
       │                 └──────┬───────┘
       │                        │
       │                        │ has
       │                        ▼
       │                 ┌──────────────┐
       │                 │   COMMENT    │
       │                 │              │
       │                 │ - _id        │
       └─────────────────│ - document   │
         authors         │ - author (FK)│
                         │ - text       │
                         │ - page       │
                         │ - position   │
                         │ - resolved   │
                         └──────────────┘
                                │
                         ┌──────┴──────┐
                         │             │
                  ┌──────▼───────┐ ┌──▼──────────┐
                  │    SHARE     │ │  SESSION    │
                  │              │ │             │
                  │ - _id        │ │ - _id       │
                  │ - document   │ │ - user (FK) │
                  │ - token      │ │ - token     │
                  │ - permission │ │ - expiresAt │
                  │ - expiresAt  │ └─────────────┘
                  │ - viewCount  │
                  └──────────────┘
```

#### DATA-7.1.2: Data Dictionary

**User Entity:**
| Field | Type | Constraints | Description |
|-------|------|-------------|-------------|
| _id | ObjectId | Primary Key, Auto-generated | Unique user identifier |
| email | String | Required, Unique, Email format | User's email address |
| password | String | Required, Min 8 chars, Hashed | User password (bcrypt) |
| name | String | Required | User's display name |
| role | Enum | ['free', 'premium', 'admin'] | User subscription tier |
| storageUsed | Number | Default 0 | Storage consumed (bytes) |
| storageQuota | Number | Default 5GB | Storage limit (bytes) |
| emailVerified | Boolean | Default false | Email verification status |
| preferences | Object | Optional | User preferences (theme, language) |
| createdAt | Date | Auto-generated | Account creation timestamp |
| updatedAt | Date | Auto-generated | Last update timestamp |

**Document Entity:**
| Field | Type | Constraints | Description |
|-------|------|-------------|-------------|
| _id | ObjectId | Primary Key, Auto-generated | Unique document identifier |
| title | String | Required | Document title |
| owner | ObjectId | Foreign Key (User), Indexed | Document owner reference |
| filename | String | Required | Stored filename (UUID) |
| originalFilename | String | Required | Original upload filename |
| fileUrl | String | Required | Cloud storage URL |
| fileSize | Number | Required | File size in bytes |
| mimeType | String | Required | MIME type (application/pdf) |
| pages | Number | Default 1 | Number of pages |
| status | Enum | ['processing', 'ready', 'error'] | Processing status |
| ocrCompleted | Boolean | Default false | OCR processing flag |
| ocrText | String | Optional | Extracted text content |
| summary | String | Optional | AI-generated summary |
| tags | Array[String] | Optional | User-defined tags |
| folder | String | Optional | Folder path |
| sharedWith | Array[Object] | Optional | Sharing permissions |
| createdAt | Date | Auto-generated | Creation timestamp |
| updatedAt | Date | Auto-generated | Last modification timestamp |

**Comment Entity:**
| Field | Type | Constraints | Description |
|-------|------|-------------|-------------|
| _id | ObjectId | Primary Key | Unique comment identifier |
| document | ObjectId | Foreign Key (Document), Indexed | Parent document |
| author | ObjectId | Foreign Key (User) | Comment author |
| text | String | Required | Comment content |
| page | Number | Required | Page number (1-indexed) |
| position | Object | Optional | {x, y} coordinates |
| parentComment | ObjectId | Optional | Parent for threading |
| resolved | Boolean | Default false | Resolution status |
| mentions | Array[ObjectId] | Optional | Mentioned users |
| createdAt | Date | Auto-generated | Creation timestamp |

**Version Entity:**
| Field | Type | Constraints | Description |
|-------|------|-------------|-------------|
| _id | ObjectId | Primary Key | Unique version identifier |
| document | ObjectId | Foreign Key (Document), Indexed | Parent document |
| versionNumber | Number | Required | Sequential version number |
| fileUrl | String | Required | Snapshot file URL |
| fileSize | Number | Required | Snapshot file size |
| author | ObjectId | Foreign Key (User) | Version creator |
| description | String | Optional | Version description |
| createdAt | Date | Auto-generated | Version creation time |

**Share Link Entity:**
| Field | Type | Constraints | Description |
|-------|------|-------------|-------------|
| _id | ObjectId | Primary Key | Unique share identifier |
| document | ObjectId | Foreign Key (Document), Indexed | Shared document |
| owner | ObjectId | Foreign Key (User) | Share creator |
| token | String | Unique, Auto-generated | Share link token |
| permission | Enum | ['view', 'comment', 'edit'] | Access level |
| password | String | Optional, Hashed | Link password |
| expiresAt | Date | Optional | Expiration date |
| allowDownload | Boolean | Default true | Download permission |
| viewCount | Number | Default 0 | Access counter |
| active | Boolean | Default true | Link status |
| createdAt | Date | Auto-generated | Creation timestamp |

### 7.2 Data Storage

**Description:**  
Storage strategy for different types of data.

#### STOR-7.2.1: Database Storage (MongoDB)

**Use Cases:**
- User accounts and profiles
- Document metadata
- Comments and annotations
- Version history metadata
- Share links and permissions
- Session data (alternatively in Redis)

**Storage Configuration:**
```javascript
// MongoDB connection
const mongoose = require('mongoose');

mongoose.connect(process.env.MONGODB_URI, {
  useNewUrlParser: true,
  useUnifiedTopology: true,
  maxPoolSize: 10,  // Connection pool size
  serverSelectionTimeoutMS: 5000,
  socketTimeoutMS: 45000,
});

// Collections
db.users          // User accounts
db.documents      // Document metadata
db.comments       // Comments and annotations
db.versions       // Version history
db.shares         // Share links
db.sessions       // Active sessions
```

**Indexes:**
```javascript
// User indexes
db.users.createIndex({ email: 1 }, { unique: true });
db.users.createIndex({ createdAt: -1 });

// Document indexes
db.documents.createIndex({ owner: 1, createdAt: -1 });
db.documents.createIndex({ owner: 1, title: "text" });  // Text search
db.documents.createIndex({ tags: 1 });
db.documents.createIndex({ "sharedWith.user": 1 });

// Comment indexes
db.comments.createIndex({ document: 1, page: 1 });
db.comments.createIndex({ document: 1, createdAt: -1 });

// Version indexes
db.versions.createIndex({ document: 1, versionNumber: -1 });

// Share indexes
db.shares.createIndex({ token: 1 }, { unique: true });
db.shares.createIndex({ document: 1 });
db.shares.createIndex({ expiresAt: 1 }, { expireAfterSeconds: 0 });  // TTL index
```

**Database Sizing:**
```
Expected data volume (per 1000 users):
- Users: ~500 KB (500 bytes per user)
- Documents (metadata): ~50 MB (50 KB per document × 1000 docs)
- Comments: ~20 MB (500 comments × 40 KB avg)
- Versions: ~10 MB (metadata only, files in object storage)
- Share links: ~5 MB

Total database size: ~85 MB per 1000 users
Scaling: ~850 MB for 10,000 users, ~8.5 GB for 100,000 users
```

#### STOR-7.2.2: Object Storage (Firebase/S3)

**Use Cases:**
- PDF files
- Uploaded images
- Processed documents
- Document versions (snapshots)
- Thumbnails and previews
- Exported files (temporary)

**Storage Structure:**
```
/storage
├── /users
│   └── /{userId}
│       ├── /documents
│       │   └── /{documentId}
│       │       ├── original.pdf
│       │       ├── processed.pdf
│       │       └── /thumbnails
│       │           ├── page-1.jpg
│       │           ├── page-2.jpg
│       │           └── ...
│       ├── /versions
│       │   └── /{documentId}
│       │       ├── v1.pdf
│       │       ├── v2.pdf
│       │       └── ...
│       └── /exports
│           └── temp-{timestamp}.docx  (deleted after 24h)
│
└── /public
    └── /shared
        └── /{shareToken}.pdf  (temporary links)
```

**File Naming Convention:**
```javascript
// Generate unique filename
const crypto = require('crypto');

function generateFilename(userId, originalFilename) {
  const ext = path.extname(originalFilename);
  const timestamp = Date.now();
  const randomStr = crypto.randomBytes(8).toString('hex');
  return `users/${userId}/documents/${timestamp}-${randomStr}${ext}`;
}

// Example: users/user123/documents/1698765432000-a1b2c3d4e5f6g7h8.pdf
```

**Storage Quotas:**
```
Free tier:     5 GB
Basic tier:   50 GB
Premium tier: 100 GB

Enforcement:
- Check before upload: currentUsage + fileSize <= quota
- Reject if quota exceeded
- Update user.storageUsed after successful upload
```

**Lifecycle Policies:**
```javascript
// Temporary files auto-deletion
// Firebase Cloud Storage lifecycle rules
{
  "lifecycle": {
    "rule": [
      {
        "action": { "type": "Delete" },
        "condition": {
          "age": 1,  // days
          "matchesPrefix": ["users/*/exports/"]
        }
      },
      {
        "action": { "type": "Delete" },
        "condition": {
          "age": 7,
          "matchesPrefix": ["public/shared/"]
        }
      }
    ]
  }
}
```

#### STOR-7.2.3: Cache Storage (Redis)

**Use Cases:**
- Session management
- API response caching
- Rate limiting counters
- Job queue (Bull)
- Real-time presence data
- Temporary data (OTP codes, reset tokens)

**Cache Configuration:**
```javascript
const Redis = require('ioredis');

const redis = new Redis({
  host: process.env.REDIS_HOST,
  port: 6379,
  password: process.env.REDIS_PASSWORD,
  db: 0,
  retryStrategy: (times) => {
    const delay = Math.min(times * 50, 2000);
    return delay;
  }
});

// Key namespacing
const KEYS = {
  session: (sessionId) => `session:${sessionId}`,
  rateLimit: (userId) => `ratelimit:${userId}`,
  cache: (key) => `cache:${key}`,
  presence: (documentId) => `presence:${documentId}`,
  queue: 'bull:jobs'
};
```

**Cache Strategies:**
```javascript
// Cache-aside pattern
async function getDocument(documentId) {
  // Try cache first
  const cached = await redis.get(KEYS.cache(`document:${documentId}`));
  if (cached) {
    return JSON.parse(cached);
  }
  
  // Cache miss: fetch from database
  const document = await Document.findById(documentId);
  
  // Store in cache (TTL: 1 hour)
  await redis.setex(
    KEYS.cache(`document:${documentId}`),
    3600,
    JSON.stringify(document)
  );
  
  return document;
}

// Invalidate cache on update
async function updateDocument(documentId, updates) {
  const document = await Document.findByIdAndUpdate(documentId, updates);
  
  // Invalidate cache
  await redis.del(KEYS.cache(`document:${documentId}`));
  
  return document;
}
```

**Rate Limiting:**
```javascript
// Rate limit using Redis
async function checkRateLimit(userId, limit = 100, window = 3600) {
  const key = KEYS.rateLimit(userId);
  const current = await redis.incr(key);
  
  if (current === 1) {
    await redis.expire(key, window);  // Set expiry on first request
  }
  
  return {
    allowed: current <= limit,
    remaining: Math.max(0, limit - current),
    resetAt: Date.now() + window * 1000
  };
}
```

#### STOR-7.2.4: Client-Side Storage

**LocalStorage (Persistent):**
```javascript
// User preferences
localStorage.setItem('theme', 'dark');
localStorage.setItem('language', 'en');
localStorage.setItem('recentFiles', JSON.stringify([...]));

// Authentication token
localStorage.setItem('accessToken', token);
```

**SessionStorage (Session-only):**
```javascript
// Temporary editing state
sessionStorage.setItem('editorState', JSON.stringify({
  zoom: 1.5,
  currentPage: 5,
  selectedTool: 'text'
}));
```

**IndexedDB (Large Data):**
```javascript
// Store document thumbnails
const db = await openDB('UniPDFCache', 1, {
  upgrade(db) {
    db.createObjectStore('thumbnails', { keyPath: 'documentId' });
  }
});

// Store thumbnail
await db.put('thumbnails', {
  documentId: 'doc-123',
  pages: [
    { page: 1, dataUrl: 'data:image/jpeg;base64,...' },
    { page: 2, dataUrl: 'data:image/jpeg;base64,...' }
  ]
});

// Retrieve thumbnail
const cached = await db.get('thumbnails', 'doc-123');
```

### 7.3 Data Processing

**Description:**  
Data transformation, validation, and processing workflows.

#### PROC-7.3.1: File Upload Processing

**Upload Workflow:**
```javascript
// 1. Receive file upload
app.post('/documents', 
  authenticate,
  upload.single('file'),  // Multer middleware
  async (req, res) => {
    try {
      // 2. Validate file
      const validation = validateFile(req.file);
      if (!validation.valid) {
        return res.status(400).json({ error: validation.error });
      }
      
      // 3. Check storage quota
      const user = req.user;
      if (user.storageUsed + req.file.size > user.storageQuota) {
        return res.status(413).json({ error: 'Storage quota exceeded' });
      }
      
      // 4. Upload to cloud storage
      const fileUrl = await storageService.upload(
        req.file.path,
        `users/${user.id}/documents/${req.file.filename}`
      );
      
      // 5. Extract PDF metadata
      const metadata = await pdfService.extractMetadata(req.file.path);
      
      // 6. Generate thumbnails (async job)
      await thumbnailQueue.add({
        filePath: req.file.path,
        documentId: newDocId
      });
      
      // 7. Create database record
      const document = await Document.create({
        title: req.body.title || req.file.originalname,
        owner: user.id,
        filename: req.file.filename,
        originalFilename: req.file.originalname,
        fileUrl,
        fileSize: req.file.size,
        mimeType: req.file.mimetype,
        pages: metadata.pages,
        status: 'processing'
      });
      
      // 8. Update user storage
      await User.updateOne(
        { _id: user.id },
        { $inc: { storageUsed: req.file.size } }
      );
      
      // 9. Clean up temp file
      fs.unlinkSync(req.file.path);
      
      // 10. Queue OCR if needed
      if (metadata.isScanned) {
        await ocrQueue.add({ documentId: document.id });
      }
      
      // 11. Return response
      res.status(201).json({
        success: true,
        data: document
      });
      
    } catch (error) {
      console.error('Upload error:', error);
      res.status(500).json({ error: 'Upload failed' });
    }
  }
);
```

#### PROC-7.3.2: PDF Processing Pipeline

**Thumbnail Generation:**
```javascript
// Worker: Generate thumbnails for all pages
thumbnailQueue.process(async (job) => {
  const { filePath, documentId } = job.data;
  
  const pdf = await pdfjsLib.getDocument(filePath).promise;
  const numPages = pdf.numPages;
  const thumbnails = [];
  
  for (let i = 1; i <= numPages; i++) {
    job.progress((i / numPages) * 100);
    
    const page = await pdf.getPage(i);
    const viewport = page.getViewport({ scale: 0.2 });  // Small thumbnail
    
    // Render to canvas
    const canvas = createCanvas(viewport.width, viewport.height);
    const context = canvas.getContext('2d');
    
    await page.render({
      canvasContext: context,
      viewport: viewport
    }).promise;
    
    // Convert to JPEG
    const buffer = canvas.toBuffer('image/jpeg', { quality: 0.8 });
    
    // Upload thumbnail
    const thumbnailUrl = await storageService.upload(
      buffer,
      `users/${userId}/documents/${documentId}/thumbnails/page-${i}.jpg`
    );
    
    thumbnails.push({
      page: i,
      url: thumbnailUrl
    });
  }
  
  // Update document with thumbnail URLs
  await Document.updateOne(
    { _id: documentId },
    { thumbnails, status: 'ready' }
  );
  
  return { thumbnails };
});
```

**OCR Processing:**
```javascript
// Worker: Extract text from scanned PDF
ocrQueue.process(async (job) => {
  const { documentId } = job.data;
  
  const document = await Document.findById(documentId);
  const filePath = await downloadFile(document.fileUrl);
  
  const pdf = await pdfjsLib.getDocument(filePath).promise;
  const numPages = pdf.numPages;
  const extractedText = [];
  
  for (let i = 1; i <= numPages; i++) {
    job.progress((i / numPages) * 100);
    
    const page = await pdf.getPage(i);
    const viewport = page.getViewport({ scale: 2.0 });
    
    // Render page to image
    const canvas = createCanvas(viewport.width, viewport.height);
    const context = canvas.getContext('2d');
    await page.render({ canvasContext: context, viewport }).promise;
    
    // Run OCR on image
    const { data: { text } } = await Tesseract.recognize(
      canvas.toBuffer(),
      'eng',
      { logger: m => console.log(m) }
    );
    
    extractedText.push({
      page: i,
      text: text
    });
  }
  
  // Store OCR results
  await Document.updateOne(
    { _id: documentId },
    {
      ocrText: extractedText.map(p => p.text).join('\n\n'),
      ocrCompleted: true,
      ocrPages: extractedText
    }
  );
  
  // Clean up
  fs.unlinkSync(filePath);
  
  return { pages: numPages, textLength: extractedText.length };
});
```

#### PROC-7.3.3: AI Processing

**Text Summarization:**
```javascript
async function summarizeDocument(documentId, length = 'medium') {
  const document = await Document.findById(documentId);
  
  // Extract text (from ocrText or PDF text layer)
  let text = document.ocrText;
  if (!text) {
    text = await pdfService.extractText(document.fileUrl);
  }
  
  // Truncate if too long (token limits)
  const maxTokens = 12000;  // GPT-4 context limit
  if (text.length > maxTokens * 4) {  // Rough estimate: 1 token ≈ 4 chars
    text = text.substring(0, maxTokens * 4);
  }
  
  // Determine summary length
  const lengthPrompts = {
    short: 'in 2-3 sentences',
    medium: 'in 1 paragraph',
    long: 'in 2-3 paragraphs with bullet points'
  };
  
  // Call OpenAI API
  const response = await openai.chat.completions.create({
    model: 'gpt-4',
    messages: [
      {
        role: 'system',
        content: 'You are a helpful assistant that summarizes documents.'
      },
      {
        role: 'user',
        content: `Summarize the following document ${lengthPrompts[length]}:\n\n${text}`
      }
    ],
    temperature: 0.7,
    max_tokens: 500
  });
  
  const summary = response.choices[0].message.content;
  
  // Store summary
  await Document.updateOne(
    { _id: documentId },
    {
      summary,
      summaryGeneratedAt: new Date()
    }
  );
  
  return summary;
}
```

#### PROC-7.3.4: Data Validation

**Input Validation Middleware:**
```javascript
const { body, param, validationResult } = require('express-validator');

// Validation rules
const documentValidation = {
  create: [
    body('title')
      .trim()
      .isLength({ min: 1, max: 255 })
      .withMessage('Title must be 1-255 characters'),
    body('tags')
      .optional()
      .isArray()
      .withMessage('Tags must be an array'),
    body('tags.*')
      .trim()
      .isLength({ min: 1, max: 50 })
      .withMessage('Each tag must be 1-50 characters'),
    body('folder')
      .optional()
      .trim()
      .isLength({ max: 255 })
      .withMessage('Folder path too long')
  ],
  
  update: [
    param('id')
      .isMongoId()
      .withMessage('Invalid document ID'),
    body('title')
      .optional()
      .trim()
      .isLength({ min: 1, max: 255 }),
    body('tags')
      .optional()
      .isArray()
  ]
};

// Validation error handler
function handleValidationErrors(req, res, next) {
  const errors = validationResult(req);
  if (!errors.isEmpty()) {
    return res.status(400).json({
      success: false,
      error: {
        code: 'VALIDATION_ERROR',
        message: 'Invalid input',
        details: errors.array()
      }
    });
  }
  next();
}

// Usage
app.post('/documents',
  authenticate,
  documentValidation.create,
  handleValidationErrors,
  createDocument
);
```

**File Type Validation:**
```javascript
const fileType = require('file-type');
const { fromBuffer } = fileType;

async function validateFile(file) {
  // Check file size
  const MAX_SIZE = 100 * 1024 * 1024;  // 100MB
  if (file.size > MAX_SIZE) {
    return {
      valid: false,
      error: 'File size exceeds 100MB limit'
    };
  }
  
  // Check MIME type (from headers)
  const allowedMimeTypes = [
    'application/pdf',
    'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
    'image/jpeg',
    'image/png',
    'image/tiff',
    'text/plain',
    'text/html'
  ];
  
  if (!allowedMimeTypes.includes(file.mimetype)) {
    return {
      valid: false,
      error: 'Unsupported file type'
    };
  }
  
  // Verify file type by reading file headers (magic bytes)
  const buffer = fs.readFileSync(file.path);
  const type = await fromBuffer(buffer);
  
  // PDF: %PDF-
  // DOCX: PK (ZIP archive)
  // JPEG: FF D8 FF
  // PNG: 89 50 4E 47
  
  if (file.mimetype === 'application/pdf') {
    const pdfHeader = buffer.slice(0, 4).toString();
    if (!pdfHeader.startsWith('%PDF')) {
      return {
        valid: false,
        error: 'File is not a valid PDF'
      };
    }
  }
  
  return { valid: true };
}
```

### 7.4 Data Retention

**Description:**  
Policies for data lifecycle management, retention, and deletion.

#### RET-7.4.1: Data Retention Policies

**User Data:**
```
Active Accounts:
- Retained indefinitely while account is active
- User can delete account anytime
- Automated deletion after 3 years of inactivity

Deleted Accounts:
- Grace period: 30 days (account recovery possible)
- After 30 days: Permanent deletion
- Backups: Removed from backups after 90 days
```

**Documents:**
```
Active Documents:
- Retained while user account is active
- User can delete anytime

Deleted Documents (Trash):
- Moved to trash (soft delete)
- Retained for 30 days
- Automatically purged after 30 days
- User can restore from trash during 30-day period

Unauthenticated Uploads:
- Automatically deleted after 24 hours
- No trash period
- Immediate permanent deletion
```

**Versions:**
```
Document Versions:
- Free tier: Store last 10 versions
- Premium tier: Unlimited versions
- Versions older than 90 days: Eligible for archival/deletion
- When document is deleted: All versions deleted
```

**Comments and Annotations:**
```
Active Comments:
- Retained with parent document
- Deleted when document is deleted

Resolved Comments:
- Archived after 90 days
- Can be restored if needed
```

**Share Links:**
```
Active Links:
- Retained until expiry date or manual revocation
- Expired links: Deleted after 7 days
- Analytics data: Retained for 90 days after link deletion
```

**Logs and Analytics:**
```
Application Logs:
- Retained for 90 days
- Archived to cold storage after 30 days
- Deleted after 90 days

Access Logs:
- Retained for 30 days
- Deleted after 30 days

Error Logs:
- Retained for 180 days (for debugging)
- Deleted after 180 days

Analytics Data:
- Aggregated data retained for 2 years
- Individual events deleted after 90 days
```

#### RET-7.4.2: Automated Cleanup Jobs

**Scheduled Cleanup Tasks:**
```javascript
const cron = require('node-cron');

// Run daily at 2 AM UTC
cron.schedule('0 2 * * *', async () => {
  console.log('Running daily cleanup job...');
  
  // 1. Delete expired temporary files
  await cleanupTempFiles();
  
  // 2. Delete expired share links
  await cleanupExpiredLinks();
  
  // 3. Purge trash (files deleted > 30 days ago)
  await purgeTrash();
  
  // 4. Delete old logs
  await cleanupLogs();
  
  // 5. Archive old versions (> 90 days)
  await archiveOldVersions();
  
  console.log('Daily cleanup completed');
});

async function cleanupTempFiles() {
  const cutoffDate = new Date(Date.now() - 24 * 60 * 60 * 1000);  // 24 hours ago
  
  // Find temp files older than 24 hours
  const tempFiles = await Document.find({
    owner: null,  // Unauthenticated uploads
    createdAt: { $lt: cutoffDate }
  });
  
  for (const file of tempFiles) {
    // Delete from storage
    await storageService.delete(file.fileUrl);
    
    // Delete from database
    await Document.deleteOne({ _id: file._id });
  }
  
  console.log(`Deleted ${tempFiles.length} temporary files`);
}

async function purgeTrash() {
  const cutoffDate = new Date(Date.now() - 30 * 24 * 60 * 60 * 1000);  // 30 days ago
  
  // Find soft-deleted documents older than 30 days
  const trashedDocs = await Document.find({
    deletedAt: { $exists: true, $lt: cutoffDate }
  });
  
  for (const doc of trashedDocs) {
    // Delete all versions
    await Version.deleteMany({ document: doc._id });
    
    // Delete all comments
    await Comment.deleteMany({ document: doc._id });
    
    // Delete file from storage
    await storageService.delete(doc.fileUrl);
    
    // Delete thumbnails
    for (const thumb of doc.thumbnails || []) {
      await storageService.delete(thumb.url);
    }
    
    // Permanently delete from database
    await Document.deleteOne({ _id: doc._id });
  }
  
  console.log(`Purged ${trashedDocs.length} documents from trash`);
}

async function cleanupExpiredLinks() {
  const now = new Date();
  
  // Find expired links
  const expiredLinks = await Share.find({
    active: true,
    expiresAt: { $lt: now }
  });
  
  for (const link of expiredLinks) {
    // Mark as inactive (keep for analytics for 7 days)
    await Share.updateOne(
      { _id: link._id },
      { active: false, deactivatedAt: now }
    );
  }
  
  // Delete inactive links older than 7 days
  const deleteDate = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000);
  await Share.deleteMany({
    active: false,
    deactivatedAt: { $lt: deleteDate }
  });
  
  console.log(`Deactivated ${expiredLinks.length} expired share links`);
}
```

#### RET-7.4.3: User Data Export

**GDPR-Compliant Data Export:**
```javascript
async function exportUserData(userId) {
  const user = await User.findById(userId);
  const documents = await Document.find({ owner: userId });
  const comments = await Comment.find({ author: userId });
  const shares = await Share.find({ owner: userId });
  
  // Compile all user data
  const exportData = {
    user: {
      id: user._id,
      name: user.name,
      email: user.email,
      createdAt: user.createdAt,
      role: user.role,
      storageUsed: user.storageUsed,
      preferences: user.preferences
    },
    documents: documents.map(doc => ({
      id: doc._id,
      title: doc.title,
      filename: doc.originalFilename,
      fileSize: doc.fileSize,
      pages: doc.pages,
      createdAt: doc.createdAt,
      downloadUrl: doc.fileUrl  // Signed URL for download
    })),
    comments: comments.map(comment => ({
      id: comment._id,
      documentTitle: comment.document.title,
      text: comment.text,
      page: comment.page,
      createdAt: comment.createdAt
    })),
    shareLinks: shares.map(share => ({
      id: share._id,
      documentTitle: share.document.title,
      token: share.token,
      permission: share.permission,
      viewCount: share.viewCount,
      createdAt: share.createdAt
    })),
    exportDate: new Date(),
    format: 'JSON'
  };
  
  // Generate ZIP with data + actual files
  const archive = archiver('zip');
  
  // Add JSON data
  archive.append(
    JSON.stringify(exportData, null, 2),
    { name: 'user_data.json' }
  );
  
  // Add all document files
  for (const doc of documents) {
    const fileStream = await storageService.getStream(doc.fileUrl);
    archive.append(fileStream, { name: `documents/${doc.originalFilename}` });
  }
  
  await archive.finalize();
  
  return archive;  // Return ZIP stream
}

// API endpoint
app.get('/users/me/export', authenticate, async (req, res) => {
  const archive = await exportUserData(req.user.id);
  
  res.setHeader('Content-Type', 'application/zip');
  res.setHeader('Content-Disposition', 'attachment; filename=user_data.zip');
  
  archive.pipe(res);
});
```

#### RET-7.4.4: Account Deletion

**Complete Data Removal:**
```javascript
async function deleteUserAccount(userId, password) {
  const user = await User.findById(userId);
  
  // Verify password
  const valid = await user.comparePassword(password);
  if (!valid) {
    throw new Error('Invalid password');
  }
  
  // 1. Delete all documents
  const documents = await Document.find({ owner: userId });
  for (const doc of documents) {
    // Delete file from storage
    await storageService.delete(doc.fileUrl);
    
    // Delete thumbnails
    for (const thumb of doc.thumbnails || []) {
      await storageService.delete(thumb.url);
    }
    
    // Delete versions
    const versions = await Version.find({ document: doc._id });
    for (const version of versions) {
      await storageService.delete(version.fileUrl);
    }
    await Version.deleteMany({ document: doc._id });
    
    // Delete comments
    await Comment.deleteMany({ document: doc._id });
    
    // Delete share links
    await Share.deleteMany({ document: doc._id });
    
    // Delete document
    await Document.deleteOne({ _id: doc._id });
  }
  
  // 2. Delete comments authored by user (on other documents)
  await Comment.deleteMany({ author: userId });
  
  // 3. Remove user from document sharing
  await Document.updateMany(
    { 'sharedWith.user': userId },
    { $pull: { sharedWith: { user: userId } } }
  );
  
  // 4. Delete sessions
  await Session.deleteMany({ user: userId });
  
  // 5. Invalidate tokens (add to blacklist)
  await TokenBlacklist.create({ userId, timestamp: Date.now() });
  
  // 6. Delete user account
  await User.deleteOne({ _id: userId });
  
  // 7. Send confirmation email
  await emailService.sendAccountDeletedEmail(user.email);
  
  console.log(`Account ${userId} deleted successfully`);
}

// API endpoint
app.delete('/users/me', authenticate, async (req, res) => {
  try {
    await deleteUserAccount(req.user.id, req.body.password);
    res.json({
      success: true,
      message: 'Account deleted successfully'
    });
  } catch (error) {
    res.status(400).json({
      success: false,
      error: error.message
    });
  }
});
```

## 8. Future Enhancements

**Description:**  
Planned features and improvements for future releases (Phase 2 and beyond).

### 8.1 Mobile Applications

**Native Mobile Apps:**
- iOS app (Swift/SwiftUI)
- Android app (Kotlin/Jetpack Compose)
- Offline mode with sync
- Mobile-optimized UI
- Camera integration for document scanning
- Biometric authentication (Face ID, fingerprint)

**Features:**
- View and annotate PDFs on mobile
- Take photos and convert to PDF
- Sign documents with finger/stylus
- Scan business cards with OCR
- Share documents via mobile

### 8.2 Advanced Collaboration

**Real-Time Features:**
- Live cursor tracking with user avatars
- Voice/video calls within app
- Screen sharing for collaborative review
- Presence indicators (online/offline/away)
- Typing indicators for comments

**Team Management:**
- Organization accounts with SSO
- Role-based permissions (viewer, editor, admin)
- Approval workflows
- Activity dashboard for admins
- Team usage analytics

### 8.3 AI Enhancements

**Advanced AI Features:**
- AI-powered document generation from prompts
- Intelligent form field detection and extraction
- Automatic table of contents generation
- Smart document categorization and tagging
- Language translation (translate PDFs to 50+ languages)
- Meeting notes summarization with action items

**AI Assistants:**
- Document comparison (highlight differences between versions)
- Contract analysis (identify key terms, risks)
- Resume screening and ranking
- Invoice data extraction

### 8.4 Integration Ecosystem

**Third-Party Integrations:**
- Slack integration (notifications, document sharing)
- Microsoft Teams integration
- Zapier automation
- Google Workspace integration (Docs, Sheets)
- Dropbox sync
- OneDrive sync
- Box integration

**API and Webhooks:**
- Public REST API for developers
- Webhooks for events (document uploaded, comment added, etc.)
- JavaScript SDK for embedding editor
- WordPress plugin
- Chrome extension for instant PDF editing

### 8.5 Advanced PDF Features

**Professional Tools:**
- Redaction tools (permanent content removal)
- Bates numbering (legal document numbering)
- PDF/A conversion (archival format)
- Digital signatures with certificate validation
- Form creation wizard with logic/calculations
- 3D PDF support (CAD models)

**Accessibility:**
- Automated accessibility checker (PDF/UA compliance)
- Tag structure editor
- Alt text generator for images (AI-powered)
- Reading order optimization
- Screen reader testing mode

### 8.6 Business Features

**Enterprise:**
- Custom branding (white-label)
- On-premise deployment option
- SSO with SAML/LDAP
- Advanced security (audit logs, compliance reports)
- API rate limit customization
- Dedicated account manager

**Pricing Tiers:**
- Business tier: Unlimited storage, priority support
- Enterprise tier: Custom features, SLA guarantees

### 8.7 Performance Optimizations

**Speed Improvements:**
- WebAssembly for PDF rendering (3-5x faster)
- Progressive Web App (PWA) with offline support
- Edge computing for OCR (process at CDN edge)
- Predictive prefetching (load next page before viewing)

**Scalability:**
- Microservices architecture (split monolith)
- Kubernetes auto-scaling
- Database sharding for high traffic
- Global CDN with regional caching

### 8.8 New Document Formats

**Additional Formats:**
- Excel/CSV editing within PDF
- PowerPoint to PDF with animations preserved
- Ebook formats (EPUB, MOBI)
- Vector graphics (SVG, EPS, AI)
- CAD files (DWG, DXF) - view only

### 8.9 Advanced Analytics

**User Analytics:**
- Document engagement metrics (time spent, pages viewed)
- Popular documents dashboard
- Team productivity reports
- Storage usage trends
- Feature usage heatmap

**Document Insights:**
- Reading level analysis (Flesch-Kincaid score)
- Sentiment analysis
- Keyword extraction and trending topics
- Compliance checking (GDPR, HIPAA mentions)

### 8.10 Security Enhancements

**Advanced Security:**
- End-to-end encryption (user-controlled keys)
- Hardware security key support (YubiKey)
- IP whitelisting for enterprise
- Geofencing (restrict access by location)
- Watermarking with user ID tracking
- DRM (Digital Rights Management)

## 9. Appendices

### 9.1 Glossary

| Term | Definition |
|------|------------|
| **API** | Application Programming Interface - allows software to communicate |
| **bcrypt** | Password hashing algorithm with salt |
| **Canvas** | HTML5 element for rendering graphics programmatically |
| **CCPA** | California Consumer Privacy Act - data privacy law |
| **CDN** | Content Delivery Network - distributed server system |
| **CORS** | Cross-Origin Resource Sharing - security mechanism |
| **CRUD** | Create, Read, Update, Delete - basic data operations |
| **DPI** | Dots Per Inch - image resolution measurement |
| **Fabric.js** | JavaScript library for canvas manipulation |
| **Firebase** | Google's backend-as-a-service platform |
| **GDPR** | General Data Protection Regulation - EU privacy law |
| **HIPAA** | Health Insurance Portability and Accountability Act |
| **JWT** | JSON Web Token - authentication token format |
| **Middleware** | Software layer between components |
| **MongoDB** | NoSQL document-oriented database |
| **OAuth** | Open Authorization - authentication protocol |
| **OCR** | Optical Character Recognition - text extraction from images |
| **PDF.js** | Mozilla's JavaScript PDF renderer |
| **Redis** | In-memory data structure store (cache/database) |
| **REST** | Representational State Transfer - API architecture |
| **SLA** | Service Level Agreement - guaranteed uptime |
| **SSL/TLS** | Secure Sockets Layer/Transport Layer Security - encryption |
| **Tesseract** | Open-source OCR engine |
| **UUID** | Universally Unique Identifier |
| **WCAG** | Web Content Accessibility Guidelines |
| **WebSocket** | Protocol for bidirectional real-time communication |

### 9.2 Use Case Diagrams

**Primary Use Cases:**

```
Student Use Case:
┌─────────────┐
│   Student   │
└──────┬──────┘
       │
       ├─────> Upload scanned notes
       │
       ├─────> Run OCR to make searchable
       │
       ├─────> Highlight and annotate
       │
       ├─────> Merge multiple PDFs
       │
       └─────> Export to DOCX for editing

Business Professional Use Case:
┌─────────────────┐
│  Professional   │
└────────┬────────┘
         │
         ├─────> Upload contract PDF
         │
         ├─────> Add comments and highlights
         │
         ├─────> Share with team (view-only)
         │
         ├─────> Add password protection
         │
         └─────> Download signed PDF

Content Team Use Case:
┌──────────────┐
│ Content Team │
└──────┬───────┘
       │
       ├─────> Upload marketing PDF
       │
       ├─────> Collaborate in real-time
       │
       ├─────> Insert branded images
       │
       ├─────> Add watermark
       │
       └─────> Export for print (high DPI)
```

### 9.3 Workflow Diagrams

**Document Upload Workflow:**
```
[User] ──> [Select File] ──> [Upload to Server]
                                    │
                              [Validate File]
                                    │
                         ┌──────────┴──────────┐
                         │                     │
                    [Valid]               [Invalid]
                         │                     │
                  [Upload to Cloud]    [Return Error]
                         │                     │
                  [Extract Metadata]           │
                         │                     │
                  [Create DB Record] <─────────┘
                         │
                  [Generate Thumbnails]
                         │
                    [Check if Scanned]
                         │
                   ┌─────┴─────┐
                   │           │
              [Scanned]   [Digital]
                   │           │
              [Queue OCR]     │
                   │           │
                   └─────┬─────┘
                         │
                  [Return Success]
                         │
                     [Display]
```

**Real-Time Collaboration Flow:**
```
[User A] ──> [Opens Document] ──> [Joins WebSocket Room]
                                           │
                                    [Server notifies]
                                           │
[User B] ──> [Opens Same Doc] ──> [Joins WebSocket Room]
                                           │
                                    [Both users connected]
                                           │
[User A] ──> [Makes Edit] ──────> [Send via WebSocket]
                                           │
                                    [Server broadcasts]
                                           │
                                    [User B receives]
                                           │
                                    [Update User B's UI]
```

**AI Summarization Workflow:**
```
[User] ──> [Click "Summarize"] ──> [Extract Text from PDF]
                                            │
                                    [Check Text Length]
                                            │
                              ┌─────────────┴─────────────┐
                              │                           │
                       [Too Long]                  [Acceptable]
                              │                           │
                      [Truncate Text]                     │
                              │                           │
                              └─────────────┬─────────────┘
                                            │
                                    [Call OpenAI API]
                                            │
                                    [Receive Summary]
                                            │
                                    [Store in Database]
                                            │
                                    [Display to User]
                                            │
                                    [Show Word Count]
```

---

**End of Software Requirements Specification (SRS)**

**Document Version:** 1.0  
**Last Updated:** November 2, 2025  
**Status:** Draft - Awaiting Approval  
**Next Steps:** Review by stakeholders, implementation planning
